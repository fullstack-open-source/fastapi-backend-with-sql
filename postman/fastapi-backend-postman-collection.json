{
	"info": {
		"_postman_id": "99442cde-80f5-48ae-a63b-5ff67029472c",
		"name": "FastApi - Backend",
		"description": "# ğŸš€ Node.js Backend API\n\n> **Enterprise-Grade Node.js Backend API with Advanced Features** \n  \n\nNode.js Backend is a comprehensive, production-ready RESTful API built with Express.js, featuring JWT authentication, role-based access control, real-time activity logging, advanced security middleware, and comprehensive monitoring capabilities.\n\n**Repository**: [https://github.com/fullstack-open-source/nodejs-backend-with-sql](https://github.com/fullstack-open-source/nodejs-backend-with-sql)\n\n## ğŸ“‹ Table of Contents\n\n- [ğŸš€ Features](#-features)\n    \n- [ğŸ—ï¸ Architecture](#ï¸-architecture)\n    \n    - [System Architecture](#system-architecture)\n        \n    - [Request Flow](#request-flow)\n        \n    - [Middleware Stack](#middleware-stack)\n        \n    - [Database Architecture](#database-architecture)\n        \n    - [Module Structure](#module-structure)\n        \n- [ğŸ“¦ Installation &amp; Setup](#-installation--setup)\n    \n    - [Prerequisites](#prerequisites)\n        \n    - [Quick Start](#quick-start)\n        \n    - [Development Setup](#development-setup)\n        \n    - [Production Setup](#production-setup)\n        \n    - [Docker Setup](#docker-setup)\n        \n- [ğŸ”„ Complete Project Workflow](#-complete-project-workflow)\n    \n    - [Service Connection Architecture](#service-connection-architecture)\n        \n    - [Service Startup Order](#service-startup-order)\n        \n    - [Connection Flow](#connection-flow)\n        \n\n## ğŸš€ Features\n\n### ğŸ¯ Core Capabilities\n\n- **RESTful API**: Comprehensive REST API with Express.js framework\n    \n- **JWT Authentication**: Secure token-based authentication system\n    \n- **Role-Based Access Control**: Flexible permission system with groups and permissions\n    \n- **Activity Logging**: Comprehensive audit trail with detailed metadata\n    \n- **File Upload**: Google Cloud Storage integration for media files\n    \n- **Email & SMS**: Twilio and Nodemailer integration for notifications\n    \n- **Error Tracking**: Sentry integration for production monitoring and error tracking\n    \n- **API Documentation**: Auto-generated Swagger/OpenAPI documentation\n    \n- **Request Queue**: Rate limiting and request queuing for traffic management\n    \n- **Worker Pool**: CPU-intensive task processing with worker threads\n    \n- **Docker Ready**: Production-ready containerization with multi-stage builds\n    \n- **PM2 Support**: Process management with cluster mode for high availability\n    \n\n### ğŸ”§ Technical Features\n\n- **Express.js 4.18+**: Modern web framework for building APIs\n    \n- **PostgreSQL 16+**: Robust relational database with advanced features\n    \n- **Prisma ORM**: Type-safe database access with connection pooling\n    \n- **Redis**: Caching and session management for improved performance\n    \n- **JWT**: Secure token-based authentication and authorization\n    \n- **Winston**: Professional logging system with file rotation\n    \n- **Helmet**: Security headers for protection against common vulnerabilities\n    \n- **Rate Limiting**: Request throttling to prevent abuse\n    \n- **Compression**: Response compression for optimized bandwidth usage\n    \n- **CORS**: Cross-origin resource sharing with whitelist validation\n    \n- **Swagger**: Interactive API documentation with Swagger UI\n    \n- **Nginx Reverse Proxy**: Production-ready reverse proxy configuration\n    \n\n## ğŸ—ï¸ Architecture\n\n### System Architecture\n\nThe system follows a layered architecture with clear separation of concerns:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        External Proxy                         â”‚\nâ”‚                    (api.example.com)                          â”‚\nâ”‚                    SSL/TLS Termination                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Internal Nginx Proxy                        â”‚\nâ”‚                    (Port 9080:80)                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Security Layer:                                         â”‚  â”‚\nâ”‚  â”‚  - Rate Limiting (200 req/min per IP)                    â”‚  â”‚\nâ”‚  â”‚  - Request Size Validation (15MB max)                     â”‚  â”‚\nâ”‚  â”‚  - Attack Pattern Detection                               â”‚  â”‚\nâ”‚  â”‚  - Content Security Policy                               â”‚  â”‚\nâ”‚  â”‚  - DDoS Protection                                        â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Express.js Application                      â”‚\nâ”‚                    (Port 3000)                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Middleware Stack:                                       â”‚  â”‚\nâ”‚  â”‚  1. Sentry Request Handler                                â”‚  â”‚\nâ”‚  â”‚  2. Helmet (Security Headers)                            â”‚  â”‚\nâ”‚  â”‚  3. CORS (Cross-Origin)                                   â”‚  â”‚\nâ”‚  â”‚  4. Body Parser (JSON/URL-encoded)                       â”‚  â”‚\nâ”‚  â”‚  5. Compression                                           â”‚  â”‚\nâ”‚  â”‚  6. Morgan (Request Logging)                              â”‚  â”‚\nâ”‚  â”‚  7. Request Logger (Custom)                               â”‚  â”‚\nâ”‚  â”‚  8. Rate Limiter                                          â”‚  â”‚\nâ”‚  â”‚  9. Security Middleware (Custom)                          â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Application Modules:                                    â”‚  â”‚\nâ”‚  â”‚  - Authentication (JWT, OTP, Login)                      â”‚  â”‚\nâ”‚  â”‚  - Profile Management                                    â”‚  â”‚\nâ”‚  â”‚  - Permissions (Groups, Permissions)                     â”‚  â”‚\nâ”‚  â”‚  - Dashboard (Analytics)                                 â”‚  â”‚\nâ”‚  â”‚  - Activity Logging                                       â”‚  â”‚\nâ”‚  â”‚  - File Upload (GCS)                                      â”‚  â”‚\nâ”‚  â”‚  - Health Monitoring                                      â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â–¼                          â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   PostgreSQL Database    â”‚   â”‚   Redis Cache            â”‚\nâ”‚   (Prisma ORM)           â”‚   â”‚   (Sessions, Cache)      â”‚\nâ”‚   - User Data            â”‚   â”‚   - Session Storage      â”‚\nâ”‚   - Permissions          â”‚   â”‚   - OTP Cache            â”‚\nâ”‚   - Activity Logs        â”‚   â”‚   - Rate Limiting        â”‚\nâ”‚   - Groups               â”‚   â”‚   - Temporary Data       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚\n                â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Google Cloud Storage   â”‚\nâ”‚   (Media & Static Files) â”‚\nâ”‚   - User Uploads         â”‚\nâ”‚   - Generated Content    â”‚\nâ”‚   - Static Assets        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### Request Flow\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º External Proxy (api.example.com)\n   â”‚\n   â”œâ”€â–º Internal Nginx (Port 9080)\n   â”‚   â”œâ”€â–º Security Checks (Rate Limiting, Attack Detection)\n   â”‚   â”œâ”€â–º Request Size Validation\n   â”‚   â”œâ”€â–º Content Security Policy Headers\n   â”‚   â””â”€â–º Proxy to Express (http://api:3000)\n   â”‚\n   â”œâ”€â–º Express Middleware Stack\n   â”‚   â”œâ”€â–º Sentry Request Handler\n   â”‚   â”‚   â””â”€â–º Request Context Capture\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Helmet\n   â”‚   â”‚   â””â”€â–º Security Headers\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º CORS\n   â”‚   â”‚   â””â”€â–º Origin Validation\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Body Parser\n   â”‚   â”‚   â”œâ”€â–º JSON Parsing (15MB limit)\n   â”‚   â”‚   â””â”€â–º URL-encoded Parsing\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Compression\n   â”‚   â”‚   â””â”€â–º Response Compression\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Morgan + Request Logger\n   â”‚   â”‚   â””â”€â–º Request Logging\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Rate Limiter\n   â”‚   â”‚   â””â”€â–º Request Throttling (200/min)\n   â”‚   â”‚\n   â”‚   â””â”€â–º Security Middleware\n   â”‚       â”œâ”€â–º Input Sanitization\n   â”‚       â”œâ”€â–º SQL Injection Detection\n   â”‚       â”œâ”€â–º XSS Detection\n   â”‚       â””â”€â–º Command Injection Detection\n   â”‚\n   â”œâ”€â–º Route Handler\n   â”‚   â”œâ”€â–º JWT Authentication (if required)\n   â”‚   â”œâ”€â–º Permission Check (if required)\n   â”‚   â”œâ”€â–º Request Validation\n   â”‚   â”œâ”€â–º Business Logic\n   â”‚   â”œâ”€â–º Database Operations (Prisma)\n   â”‚   â””â”€â–º Response Formatting\n   â”‚\n   â”œâ”€â–º Activity Logging\n   â”‚   â””â”€â–º Log to Database\n   â”‚\n   â””â”€â–º Response\n       â”œâ”€â–º Error Handling (if any)\n       â”œâ”€â–º Sentry Error Capture (if error)\n       â”œâ”€â–º Security Headers\n       â””â”€â–º Client Response\n\n ```\n\n### Middleware Stack\n\nThe middleware stack processes requests in a specific order to ensure security, performance, and reliability:\n\n1. **Sentry Request Handler** - Captures request context for error tracking and performance monitoring\n    \n2. **Helmet** - Sets security headers including X-Content-Type-Options, X-Frame-Options, and X-XSS-Protection\n    \n3. **CORS** - Handles cross-origin requests with whitelist validation for allowed origins\n    \n4. **Body Parser** - Parses JSON and URL-encoded request bodies with 15MB size limit\n    \n5. **Compression** - Compresses responses using gzip algorithm for bandwidth optimization\n    \n6. **Morgan + Request Logger** - Logs HTTP requests with detailed metadata including IP, method, path, and response time\n    \n7. **Rate Limiter** - Throttles requests to 200 requests per minute per IP address\n    \n8. **Security Middleware** - Sanitizes input data and detects attack patterns including SQL injection, XSS, and command injection\n    \n9. **Route Handlers** - Application-specific logic execution\n    \n10. **Error Handler** - Catches and formats errors with appropriate status codes\n    \n11. **Sentry Error Handler** - Captures errors for monitoring and alerting\n    \n\n### Database Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    PostgreSQL Database                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  User Model                                           â”‚   â”‚\nâ”‚  â”‚  - user_id (UUID, Primary Key)                        â”‚   â”‚\nâ”‚  â”‚  - email, phone_number, user_name                     â”‚   â”‚\nâ”‚  â”‚  - password, auth_type                                â”‚   â”‚\nâ”‚  â”‚  - is_email_verified, is_phone_verified              â”‚   â”‚\nâ”‚  â”‚  - status, is_active, is_verified                    â”‚   â”‚\nâ”‚  â”‚  - profile_picture_url, bio                           â”‚   â”‚\nâ”‚  â”‚  - Relationships: UserGroup[], ActivityLog[]          â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Permission Model                                     â”‚   â”‚\nâ”‚  â”‚  - permission_id (UUID, Primary Key)                 â”‚   â”‚\nâ”‚  â”‚  - name, codename (unique)                           â”‚   â”‚\nâ”‚  â”‚  - description, category                              â”‚   â”‚\nâ”‚  â”‚  - Relationships: GroupPermission[]                   â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Group Model                                          â”‚   â”‚\nâ”‚  â”‚  - group_id (UUID, Primary Key)                       â”‚   â”‚\nâ”‚  â”‚  - name, codename (unique)                           â”‚   â”‚\nâ”‚  â”‚  - description, is_system, is_active                 â”‚   â”‚\nâ”‚  â”‚  - Relationships: GroupPermission[], UserGroup[]      â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  GroupPermission Model (Many-to-Many)                 â”‚   â”‚\nâ”‚  â”‚  - id (UUID, Primary Key)                            â”‚   â”‚\nâ”‚  â”‚  - group_id (FK â†’ Group)                             â”‚   â”‚\nâ”‚  â”‚  - permission_id (FK â†’ Permission)                   â”‚   â”‚\nâ”‚  â”‚  - Unique constraint: (group_id, permission_id)       â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  UserGroup Model (Many-to-Many)                       â”‚   â”‚\nâ”‚  â”‚  - id (UUID, Primary Key)                            â”‚   â”‚\nâ”‚  â”‚  - user_id (FK â†’ User)                               â”‚   â”‚\nâ”‚  â”‚  - group_id (FK â†’ Group)                             â”‚   â”‚\nâ”‚  â”‚  - assigned_at, assigned_by_user_id                  â”‚   â”‚\nâ”‚  â”‚  - Unique constraint: (user_id, group_id)             â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  ActivityLog Model                                    â”‚   â”‚\nâ”‚  â”‚  - log_id (UUID, Primary Key)                        â”‚   â”‚\nâ”‚  â”‚  - user_id (FK â†’ User, nullable)                     â”‚   â”‚\nâ”‚  â”‚  - level, message, action, module                    â”‚   â”‚\nâ”‚  â”‚  - ip_address, user_agent, device, browser, os       â”‚   â”‚\nâ”‚  â”‚  - endpoint, method, status_code                      â”‚   â”‚\nâ”‚  â”‚  - request_id, session_id                             â”‚   â”‚\nâ”‚  â”‚  - metadata, error_details (JSONB)                    â”‚   â”‚\nâ”‚  â”‚  - duration_ms, created_at                           â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### Module Structure\n\n```\nNodeJs Backend API\nâ”œâ”€â”€ ğŸ“ api/                              # Main application directory\nâ”‚   â”œâ”€â”€ ğŸ“„ server.js                     # Express server entry point\nâ”‚   â”œâ”€â”€ ğŸ“„ Dockerfile                    # Multi-stage Docker build\nâ”‚   â”œâ”€â”€ ğŸ“„ ecosystem.config.js           # PM2 configuration\nâ”‚   â”œâ”€â”€ ğŸ“„ package.json                  # Dependencies and scripts\nâ”‚   â”œâ”€â”€ ğŸ“„ start.sh                      # Container startup script\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ router/                       # API route handlers\nâ”‚   â”‚   â”œâ”€â”€ ğŸ” authenticate/              # Authentication routes\nâ”‚   â”‚   â”‚   â”œâ”€â”€ authenticate.js          # Login, OTP, token management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ profile.js               # User profile management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ models.js                # Request validation schemas\nâ”‚   â”‚   â”‚   â”œâ”€â”€ query.js                 # Database queries\nâ”‚   â”‚   â”‚   â””â”€â”€ utils.js                 # Helper functions\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“Š dashboard/                # Dashboard routes\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Analytics and statistics\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ”‘ permissions/              # Permission management\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Groups, permissions, users\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“ activity/                 # Activity logging\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Activity log endpoints\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“¤ upload/                   # File upload\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Media upload endpoints\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â””â”€â”€ â¤ï¸ health/                   # Health monitoring\nâ”‚   â”‚       â”œâ”€â”€ api.js                   # Health check endpoints\nâ”‚   â”‚       â””â”€â”€ test-sentry.js           # Sentry test endpoint\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ src/                          # Source code modules\nâ”‚   â”‚   â”œâ”€â”€ ğŸ” authenticate/             # Authentication logic\nâ”‚   â”‚   â”‚   â”œâ”€â”€ authenticate.js          # JWT validation\nâ”‚   â”‚   â”‚   â”œâ”€â”€ checkpoint.js            # User authentication\nâ”‚   â”‚   â”‚   â”œâ”€â”€ models.js                # User models\nâ”‚   â”‚   â”‚   â””â”€â”€ otp_cache.js             # OTP management\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“Š activity/                 # Activity logging\nâ”‚   â”‚   â”‚   â””â”€â”€ activityLog.js          # Activity log service\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ’¾ cache/                    # Caching layer\nâ”‚   â”‚   â”‚   â””â”€â”€ cache.js                # Redis cache utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ âš™ï¸ config/                   # Configuration\nâ”‚   â”‚   â”‚   â””â”€â”€ swagger.js               # Swagger/OpenAPI config\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ—„ï¸ db/                       # Database layer\nâ”‚   â”‚   â”‚   â”œâ”€â”€ prisma.js                # Prisma client setup\nâ”‚   â”‚   â”‚   â”œâ”€â”€ index.js                 # Database utilities\nâ”‚   â”‚   â”‚   â””â”€â”€ postgres/                # PostgreSQL utilities\nâ”‚   â”‚   â”‚       â”œâ”€â”€ postgres.js          # Connection pool\nâ”‚   â”‚   â”‚       â””â”€â”€ initTriggers.js      # Database triggers\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“§ email/                    # Email service\nâ”‚   â”‚   â”‚   â”œâ”€â”€ email.js                 # Email sending\nâ”‚   â”‚   â”‚   â””â”€â”€ template.js              # Email templates\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‹ enum/                     # Enumerations\nâ”‚   â”‚   â”‚   â””â”€â”€ enum.js                  # Application enums\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“ logger/                   # Logging system\nâ”‚   â”‚   â”‚   â””â”€â”€ logger.js                # Winston logger\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ›¡ï¸ middleware/               # Express middleware\nâ”‚   â”‚   â”‚   â”œâ”€â”€ errorHandler.js          # Global error handler\nâ”‚   â”‚   â”‚   â”œâ”€â”€ permissionMiddleware.js   # Permission checking\nâ”‚   â”‚   â”‚   â”œâ”€â”€ requestLogger.js         # Request logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ requestQueue.js          # Request queuing\nâ”‚   â”‚   â”‚   â””â”€â”€ securityMiddleware.js    # Security checks\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ”‘ permissions/               # Permission system\nâ”‚   â”‚   â”‚   â””â”€â”€ permissions.js            # Permission utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“¤ response/                  # Response handlers\nâ”‚   â”‚   â”‚   â”œâ”€â”€ success.js               # Success responses\nâ”‚   â”‚   â”‚   â”œâ”€â”€ error.js                 # Error responses\nâ”‚   â”‚   â”‚   â””â”€â”€ map.js                   # Response mapping\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ› sentry/                    # Error tracking\nâ”‚   â”‚   â”‚   â””â”€â”€ sentry.js                # Sentry configuration\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“± sms/                       # SMS service\nâ”‚   â”‚   â”‚   â””â”€â”€ sms.js                   # Twilio integration\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ’¾ storage/                   # File storage\nâ”‚   â”‚   â”‚   â””â”€â”€ storage.js               # Google Cloud Storage\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ› ï¸ utils/                     # Utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.js                 # Debug utilities\nâ”‚   â”‚   â”‚   â””â”€â”€ workerUtils.js           # Worker pool utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â””â”€â”€ ğŸ‘· workers/                   # Worker threads\nâ”‚   â”‚       â”œâ”€â”€ workerPool.js            # Worker pool manager\nâ”‚   â”‚       â””â”€â”€ cpuTaskWorker.js         # CPU task worker\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ prisma/                        # Prisma ORM\nâ”‚   â”‚   â”œâ”€â”€ schema.prisma                # Database schema\nâ”‚   â”‚   â”œâ”€â”€ seed.js                      # Database seeding\nâ”‚   â”‚   â””â”€â”€ seed-defaults.js             # Default seed data\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ credentials/                   # Service credentials\nâ”‚   â”‚   â””â”€â”€ google-backend-master.json   # GCS credentials\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ logs/                          # Application logs\nâ”‚   â”‚   â”œâ”€â”€ errors-server.log            # Error logs\nâ”‚   â”‚   â””â”€â”€ success-server.log           # Success logs\nâ”‚   â”‚\nâ”‚   â””â”€â”€ ğŸ“ scripts/                       # Utility scripts\nâ”‚       â”œâ”€â”€ kill-port.sh                 # Port cleanup\nâ”‚       â””â”€â”€ db-sync.sh                   # Database sync\nâ”‚\nâ”œâ”€â”€ ğŸ“ nginx/                             # Nginx configuration\nâ”‚   â”œâ”€â”€ nginx.conf                        # Main nginx config\nâ”‚   â”œâ”€â”€ proxy.conf                        # Proxy settings\nâ”‚   â”œâ”€â”€ security.conf                    # Security headers\nâ”‚   â””â”€â”€ conf.d/                          # Additional configs\nâ”‚       â”œâ”€â”€ default.conf                 # Default server config\nâ”‚       â””â”€â”€ security.conf                # Security rules\nâ”‚\nâ”œâ”€â”€ ğŸ“„ docker-compose.yaml                # Docker Compose config\nâ”œâ”€â”€ ğŸ“„ reload.sh                          # Deployment script\nâ””â”€â”€ ğŸ“„ README.md                          # This file\n\n ```\n\n## ğŸ“¦ Installation & Setup\n\n### Prerequisites\n\n**System Requirements:**\n\n- **OS**: Linux (Ubuntu 20.04+), macOS, or Windows with WSL2\n    \n- **Node.js**: 18.0 or higher\n    \n- **npm**: 9.0 or higher\n    \n- **PostgreSQL**: 12+ (for production)\n    \n- **Redis**: 6+ (optional, for caching)\n    \n- **Docker**: 20.10+ (for containerized deployment)\n    \n- **Docker Compose**: 2.0+ (for multi-container orchestration)\n    \n- **Google Cloud Storage**: Account and bucket (for media files)\n    \n\n**Development Tools:**\n\n- Git 2.30+\n    \n- Code editor (VS Code recommended)\n    \n- Postman or similar API testing tool\n    \n\n### Quick Start\n\n#### Step 1: Clone Repository\n\n``` bash\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend\n\n ```\n\n#### Step 2: Setup Environment\n\n``` bash\n# Copy example environment file\ncp example.env .env\n# Edit .env file with your configuration\nnano .env\n\n ```\n\n#### Step 3: Start Services with Docker Compose\n\n``` bash\n# Create Docker network (if not exists)\ndocker network create nodejs_backend_with_postgresql_network\n# Start all services\ndocker compose up -d\n# Check service status\ndocker compose ps\n# View logs\ndocker compose logs -f api\n\n ```\n\n#### Step 4: Setup Database Schema\n\n``` bash\n# Generate Prisma Client\ndocker compose exec api npm run prisma:generate\n# Push schema to database\ndocker compose exec api npm run db:push\n# Seed database (optional)\ndocker compose exec api npm run db:seed\n\n ```\n\n#### Step 5: Access Services\n\n- **API Base**: [http://localhost:9080](http://localhost:9080)\n    \n- **API Docs**: [http://localhost:9080/api-docs](http://localhost:9080/api-docs)\n    \n- **Health Check**: [http://localhost:9080/health](http://localhost:9080/health) (no prefix) or [http://localhost:9080/{MODE}/health](http://localhost:9080/{MODE}/health)\n    \n- **API Routes**: [http://localhost:9080/{MODE}/](http://localhost:9080/{MODE}/)\\* (e.g., /prod/v1/authenticate, /dev/v1/token)\n    \n- **pgAdmin**: [http://localhost:5050](http://localhost:5050) (if enabled)\n    \n\n**Note:** Replace `{MODE}` with your configured MODE value (e.g., `prod/v1` or `dev/v1`)\n\n### API Route Prefix (MODE)\n\nAll API routes are prefixed with the `MODE` environment variable. This allows you to version your API and separate environments.\n\n**Configuration in** **`.env`****:**\n\n``` bash\nMODE=prod/v1    # For production API version 1\n# or\nMODE=dev/v1     # For development API version 1\n\n ```\n\n**API Route Examples:**\n\nIf `MODE=prod/v1`, all routes will be prefixed with `/prod/v1/`:\n\n- Health Check: `http://localhost:9080/prod/v1/health`\n    \n- Authentication: `http://localhost:9080/prod/v1/authenticate`\n    \n- Login: `http://localhost:9080/prod/v1/token`\n    \n- Profile: `http://localhost:9080/prod/v1/settings`\n    \n- Dashboard: `http://localhost:9080/prod/v1/dashboard`\n    \n- Permissions: `http://localhost:9080/prod/v1/permissions`\n    \n- Activity: `http://localhost:9080/prod/v1/activity`\n    \n\nIf `MODE=dev/v1`, all routes will be prefixed with `/dev/v1/`:\n\n- Health Check: `http://localhost:9080/dev/v1/health`\n    \n- Authentication: `http://localhost:9080/dev/v1/authenticate`\n    \n- Login: `http://localhost:9080/dev/v1/token`\n    \n- Profile: `http://localhost:9080/dev/v1/settings`\n    \n- Dashboard: `http://localhost:9080/dev/v1/dashboard`\n    \n- Permissions: `http://localhost:9080/dev/v1/permissions`\n    \n- Activity: `http://localhost:9080/dev/v1/activity`\n    \n\n**Note:** The `/health` endpoint is available without the MODE prefix for health checks:\n\n- Direct Health Check: `http://localhost:9080/health` (no prefix)\n    \n\n### Development Setup\n\n#### Step 1: System Preparation\n\n``` bash\n# Update system packages\nsudo apt update && sudo apt upgrade -y\n# Install Node.js 18+\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n# Install Docker (optional, for containerized development)\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n\n ```\n\n#### Step 2: Project Setup\n\n``` bash\n# Clone repository\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend/api\n# Install dependencies\nnpm install\n\n ```\n\n#### Step 3: Environment Configuration\n\n``` bash\n# Copy example environment file\ncp ../example.env ../.env\n# Edit .env file with your settings\nnano ../.env\n\n ```\n\n#### Step 4: Database Setup (Local PostgreSQL)\n\n``` bash\n# Install PostgreSQL\nsudo apt install postgresql postgresql-contrib -y\n# Create database and user\nsudo -u postgres psql << EOF\nCREATE DATABASE nodejs_backend;\nCREATE USER nodejs_user WITH PASSWORD 'your_password';\nGRANT ALL PRIVILEGES ON DATABASE nodejs_backend TO nodejs_user;\n\\q\nEOF\n# Update .env with local database connection\n# DATABASE_URL=postgresql://nodejs_user:your_password@localhost:5432/nodejs_backend\n\n ```\n\n#### Step 5: Prisma Setup\n\n``` bash\n# Generate Prisma Client\nnpm run prisma:generate\n# Push schema to database\nnpm run db:push\n# Open Prisma Studio (optional)\nnpm run prisma:studio\n\n ```\n\n#### Step 6: Seed Database (Optional)\n\n``` bash\n# Seed with default data\nnpm run db:seed\n\n ```\n\n#### Step 7: Start Development Server\n\n``` bash\n# Development mode with auto-reload\nnpm run dev\n# Or start directly\nnpm start\n\n ```\n\n#### Step 8: Access Application\n\n- **API Base**: [http://localhost:3000](http://localhost:3000)\n    \n- **API Docs**: [http://localhost:3000/api-docs](http://localhost:3000/api-docs)\n    \n- **Health Check**: [http://localhost:3000/health](http://localhost:3000/health) (no prefix) or [http://localhost:3000/{MODE}/health](http://localhost:3000/{MODE}/health)\n    \n- **API Routes**: [http://localhost:3000/{MODE}/](http://localhost:3000/{MODE}/)\\* (e.g., /prod/v1/authenticate, /dev/v1/token)\n    \n- **Prisma Studio**: [http://localhost:5555](http://localhost:5555) (if running)\n    \n\n**Note:** Replace `{MODE}` with your configured MODE value (e.g., `prod/v1` or `dev/v1`)\n\n### Production Setup\n\n#### Step 1: Server Preparation\n\n``` bash\n# Update system\nsudo apt update && sudo apt upgrade -y\n# Install Node.js 18+\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n# Install PM2\nnpm install -g pm2\n# Install Docker\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n\n ```\n\n#### Step 2: Clone and Setup Project\n\n``` bash\n# Clone repository\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend\n# Create production .env file\ncp example.env .env\n# Edit .env file with production settings\nnano .env\n\n ```\n\n**Important**: Update `.env` file with production values:\n\n- Set `NODE_ENV=production`\n    \n- Set `API_MODE=production`\n    \n- Set `DEBUG_MODE=false`\n    \n- Configure production database credentials\n    \n- Set strong JWT secret (generate with: `openssl rand -base64 32`)\n    \n- Configure production Redis, Sentry, and other services\n    \n\n#### Step 3: Deploy with Docker (Recommended)\n\n``` bash\n# Build and start services\ndocker compose build\ndocker compose up -d\n# Check status\ndocker compose ps\n# View logs\ndocker compose logs -f api\n# Run migrations\ndocker compose exec api npm run db:push\n\n ```\n\n#### Step 4: Or Deploy with PM2\n\n``` bash\ncd api\n# Generate Prisma Client\nnpm run prisma:generate\n# Start with PM2\nnpm run pm2:start\n# Check status\npm2 status\n# View logs\npm2 logs\n# Monitor\npm2 monit\n\n ```\n\n#### Step 5: Configure External Proxy (Nginx)\n\n``` bash\n# Install Nginx\nsudo apt install nginx -y\n# Create Nginx config\nsudo nano /etc/nginx/sites-available/api.example.com\n\n ```\n\nAdd configuration:\n\n``` nginx\nserver {\n    listen 80;\n    server_name api.example.com;\n    location / {\n        proxy_pass http://localhost:9080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n\n ```\n\n``` bash\n# Enable site\nsudo ln -s /etc/nginx/sites-available/api.example.com /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n\n ```\n\n### Docker Setup\n\n#### Step 1: Prerequisites\n\n``` bash\n# Check Docker version\ndocker --version\ndocker compose version\n# Install Docker if needed\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n\n ```\n\n#### Step 2: Docker Compose Services\n\nThe `docker-compose.yaml` includes:\n\n- **api**: Node.js application (Express server)\n    \n- **db**: PostgreSQL database\n    \n- **redis**: Redis cache and session store\n    \n- **nginx**: Internal reverse proxy\n    \n- **pgadmin**: PostgreSQL admin interface\n    \n\n#### Step 3: Build and Start Services\n\n``` bash\n# Create Docker network\ndocker network create nodejs_backend_with_postgresql_network\n# Build images\ndocker compose build\n# Start all services\ndocker compose up -d\n# View all logs\ndocker compose logs -f\n# View specific service logs\ndocker compose logs -f api\ndocker compose logs -f nginx\n\n ```\n\n#### Step 4: Service Management\n\n``` bash\n# Stop services\ndocker compose stop\n# Start services\ndocker compose start\n# Restart services\ndocker compose restart\n# Restart specific service\ndocker compose restart api\n# Stop and remove containers\ndocker compose down\n# Stop, remove containers, and volumes\ndocker compose down -v\n\n ```\n\n#### Step 5: Execute Commands in Containers\n\n``` bash\n# Run Prisma migrations\ndocker compose exec api npm run db:push\n# Generate Prisma Client\ndocker compose exec api npm run prisma:generate\n# Access container shell\ndocker compose exec api sh\n# Run database seed\ndocker compose exec api npm run db:seed\n# Access PostgreSQL\ndocker compose exec db psql -U postgres -d postgres\n\n ```\n\n#### Step 6: Health Checks\n\n``` bash\n# Check service health\ndocker compose ps\n# Test API health endpoint\ncurl http://localhost:8900/health\n# Test Nginx health endpoint\ncurl http://localhost:9080/health\n# Check database connection\ndocker compose exec api npm run prisma:studio\n\n ```\n\n#### Step 7: Network Configuration\n\n``` bash\n# Create network (if not exists)\ndocker network create nodejs_backend_with_postgresql_network\n# Verify network\ndocker network ls\n# Inspect network\ndocker network inspect nodejs_backend_with_postgresql_network\n\n ```\n\n## ğŸ”„ Complete Project Workflow\n\n### Service Connection Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Docker Network                                â”‚\nâ”‚              (nodejs_backend_with_postgresql_network)            â”‚\nâ”‚                                                                  â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚\nâ”‚  â”‚   Client     â”‚                                               â”‚\nâ”‚  â”‚  (Browser)   â”‚                                               â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚\nâ”‚         â”‚                                                        â”‚\nâ”‚         â”‚ HTTP/HTTPS (Port 9080)                                â”‚\nâ”‚         â–¼                                                        â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Nginx Service                                           â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-nginx                        â”‚   â”‚\nâ”‚  â”‚  Port: 9080:80 (host:container)                         â”‚   â”‚\nâ”‚  â”‚  Config: ./nginx/nginx.conf                             â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚         â”‚                                                        â”‚\nâ”‚         â”‚ Proxy to http://api:3000                              â”‚\nâ”‚         â–¼                                                        â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  API Service (Node.js/Express)                          â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend                              â”‚   â”‚\nâ”‚  â”‚  Port: 3000 (internal only)                             â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚  Prisma Client                                    â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Reads schema.prisma                            â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Generates type-safe queries                    â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚            â”‚ PostgreSQL Connection                              â”‚\nâ”‚            â”‚ (postgresql://postgres:postgres@                   â”‚\nâ”‚            â”‚  nodejs-backend-db:5432/postgres)                 â”‚\nâ”‚            â–¼                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  PostgreSQL Service                                     â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-db                          â”‚   â”‚\nâ”‚  â”‚  Port: 5432 (internal only)                             â”‚   â”‚\nâ”‚  â”‚  Volume: postgres_data (persistent)                    â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚  Database: postgres                                 â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - User table                                       â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Permission table                                 â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Group table                                      â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - ActivityLog table                                â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚            â–²                                                    â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚            â”‚ Redis Connection                                   â”‚\nâ”‚            â”‚ (redis://nodejs-backend-redis:6379)                â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Redis Service                                        â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-redis                     â”‚   â”‚\nâ”‚  â”‚  Port: 6379 (internal only)                          â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚  Cache Storage                                  â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - OTP cache                                    â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Session storage                              â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Rate limiting data                          â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                                  â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  pgAdmin Service (Optional)                             â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-pgadmin                     â”‚   â”‚\nâ”‚  â”‚  Port: 5050:80 (host:container)                        â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚\nâ”‚  â”‚  â”‚  Web Interface                                    â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Database management                            â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Query execution                                â”‚ â”‚   â”‚\nâ”‚  â”‚  â”‚  - Schema visualization                           â”‚ â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚\nâ”‚  â”‚         â”‚                                                â”‚   â”‚\nâ”‚  â”‚         â”‚ PostgreSQL Connection                          â”‚   â”‚\nâ”‚  â”‚         â”‚ (nodejs-backend-db:5432)                      â”‚   â”‚\nâ”‚  â”‚         â–¼                                                â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚\nâ”‚  â”‚  â”‚  Connects to PostgreSQL Service                 â”‚   â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### Service Startup Order\n\n```\n1. Docker Network\n   â””â”€â–º nodejs_backend_with_postgresql_network\n2. Database Services (Start First)\n   â”œâ”€â–º PostgreSQL (nodejs-backend-db:5432)\n   â””â”€â–º Redis (nodejs-backend-redis:6379)\n3. API Service (Waits for Database Health Checks)\n   â”œâ”€â–º Connects to PostgreSQL via Prisma\n   â””â”€â–º Connects to Redis for Cache\n4. Nginx Service (Waits for API Health Check)\n   â””â”€â–º Proxies to API (http://api:3000)\n5. pgAdmin Service (Optional, Waits for Database)\n   â””â”€â–º Connects to PostgreSQL\n\n ```\n\n### Connection Flow\n\n```\nClient Request\n    â”‚\n    â–¼\nPort 9080 (Host) â”€â”€â–º Nginx â”€â”€â–º Port 3000 â”€â”€â–º API Service\n                                         â”‚\n                                         â”œâ”€â–º PostgreSQL (Port 5432)\n                                         â””â”€â–º Redis (Port 6379)\n\n ```\n\n---\n\n## ğŸ“„ License & Open Source\n\nThis project is **open source** and **free to use** for all purposes with **no restrictions**.\n\n### ğŸ¯ Open Source License\n\nThis project is released under the **ISC License**, which means:\n\n- âœ… **Free to use** for any purpose (commercial or personal)\n    \n- âœ… **No restrictions** on usage, modification, or distribution\n    \n- âœ… **No warranty** provided\n    \n- âœ… **Attribution** is appreciated but not required\n    \n\n### ğŸ™ Technologies & Acknowledgments\n\nThis project is built with amazing open-source technologies. Special thanks to:\n\n#### Core Framework & Runtime\n\n- [<b>Node.js</b>](https://nodejs.org/) - JavaScript runtime built on Chrome's V8 engine\n    \n- [<b>Express.js</b>](https://expressjs.com/) - Fast, unopinionated web framework for Node.js\n    \n\n#### Database & ORM\n\n- [<b>PostgreSQL</b>](https://www.postgresql.org/) - Advanced open-source relational database\n    \n- [<b>Prisma</b>](https://www.prisma.io/) - Next-generation ORM for Node.js and TypeScript\n    \n- [<b>Redis</b>](https://redis.io/) - In-memory data structure store\n    \n\n#### Security & Authentication\n\n- [<b>JWT (jsonwebtoken)</b>](https://github.com/auth0/node-jsonwebtoken) - JSON Web Token implementation\n    \n- [<b>bcryptjs</b>](https://github.com/dcodeIO/bcrypt.js) - Password hashing library\n    \n- [<b>Helmet</b>](https://helmetjs.github.io/) - Security middleware for Express\n    \n\n#### Monitoring & Logging\n\n- [<b>Winston</b>](https://github.com/winstonjs/winston) - Logging library for Node.js\n    \n- [<b>Sentry</b>](https://sentry.io/) - Error tracking and performance monitoring\n    \n- [<b>Morgan</b>](https://github.com/expressjs/morgan) - HTTP request logger middleware\n    \n\n#### API Documentation\n\n- [<b>Swagger</b>](https://swagger.io/) - API documentation and testing tools\n    \n- [<b>swagger-jsdoc</b>](https://github.com/Swaagie/swagger-jsdoc) - Swagger specification generator\n    \n- [<b>swagger-ui-express</b>](https://github.com/scottie1984/swagger-ui-express) - Swagger UI for Express\n    \n\n#### Utilities & Middleware\n\n- [<b>CORS</b>](https://github.com/expressjs/cors) - Cross-Origin Resource Sharing middleware\n    \n- [<b>compression</b>](https://github.com/expressjs/compression) - Response compression middleware\n    \n- [<b>express-rate-limit</b>](https://github.com/expressjs/express-rate-limit) - Rate limiting middleware\n    \n- [<b>express-validator</b>](https://express-validator.github.io/) - Request validation middleware\n    \n- [<b>Joi</b>](https://joi.dev/) - Schema validation library\n    \n\n#### Communication Services\n\n- [<b>Nodemailer</b>](https://nodemailer.com/) - Email sending library\n    \n- [<b>Twilio</b>](https://www.twilio.com/) - Cloud communications platform\n    \n\n#### Storage\n\n- [<b>Google Cloud Storage</b>](https://cloud.google.com/storage) - Object storage service\n    \n- [<b>Multer</b>](https://github.com/expressjs/multer) - File upload middleware\n    \n\n#### Process Management\n\n- [<b>PM2</b>](https://pm2.keymetrics.io/) - Production process manager for Node.js\n    \n\n#### Containerization\n\n- [<b>Docker</b>](https://www.docker.com/) - Containerization platform\n    \n- [<b>Docker Compose</b>](https://docs.docker.com/compose/) - Multi-container Docker application tool\n    \n\n#### Web Server\n\n- [<b>Nginx</b>](https://www.nginx.com/) - High-performance web server and reverse proxy\n    \n\n### ğŸŒŸ Contributing\n\nContributions are welcome! This is an open-source project, and we encourage:\n\n- ğŸ› Bug reports\n    \n- ğŸ’¡ Feature requests\n    \n- ğŸ“ Documentation improvements\n    \n- ğŸ”§ Code contributions\n    \n- â­ Starring the repository\n    \n\n### ğŸ“ Support\n\nFor issues, questions, or contributions, please visit:\n\n- **Repository**: [https://github.com/fullstack-open-source/nodejs-backend-with-sql](https://github.com/fullstack-open-source/nodejs-backend-with-sql)\n    \n- **Issues**: Open an issue on GitHub\n    \n\n---\n\n**Made with â¤ï¸ using open-source technologies**\n\n_This project is free to use, modify, and distribute for any purpose without restrictions._",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "50285861",
		"_collection_link": "https://mrdasdeveloper-8273774.postman.co/workspace/Mrdas-Developer's-Workspace~c3439a6d-6548-421b-8c58-c3ae9bcb8cd2/collection/50285861-99442cde-80f5-48ae-a63b-5ff67029472c?action=share&source=collection_link&creator=50285861"
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "login-with-password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    // Access Token",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    // Refresh Token",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"",
									"    // Session ID",
									"    if (response.data.session_id) {",
									"        pm.environment.set(\"session_id\", response.data.session_id);",
									"        console.log(\"Session ID updated:\", response.data.session_id);",
									"    }",
									"",
									"    // Session Token",
									"    if (response.data.session_token) {",
									"        pm.environment.set(\"session_token\", response.data.session_token);",
									"        console.log(\"Session token updated:\", response.data.session_token);",
									"    }",
									"",
									"    // Token Type",
									"    if (response.data.token_type) {",
									"        pm.environment.set(\"token_type\", response.data.token_type);",
									"        console.log(\"Token type updated:\", response.data.token_type);",
									"    }",
									"",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "username",
									"value": "mrdas@gmail.com",
									"type": "text"
								},
								{
									"key": "password",
									"value": "Admin@404!!",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"login-with-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "username",
											"value": "admin@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Admin@404!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "+96555139166",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Mrdasdeveloper@2021!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "mrdas4321@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Qwer4321!",
											"type": "text"
										},
										{
											"key": "username",
											"value": "+96598379785",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"login-with-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:43:28 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "1882"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"f39942d1-3fd8-4c7f-a910-589c46cfa15b\",\n    \"message\": \"Login successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxYTFhMTcyOC05MTkwLTQ1YWUtODUyZC00ZDVmYWNiMDY2MGUiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg1IiwiZmlyc3RfbmFtZSI6ImFhIiwibGFzdF9uYW1lIjoiYWEiLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE5ODA4LCJpYXQiOjE3NjMwMTYyMDgsImp0aSI6ImU2Yzg3ZGNjLTA5NzYtNGE0Yi05MTk0LTdiZTM3Njg4OGEyYiIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjFhMWExNzI4LTkxOTAtNDVhZS04NTJkLTRkNWZhY2IwNjYwZSIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjoiYWEiLCJsYXN0X25hbWUiOiJhYSIsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg1IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg1In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOiIyMDI1LTExLTEzVDA2OjIzOjI5LjI3MzE3NyswMDowMCIsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMzoyNi4zODk4NDcrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIzOjU1LjA3Mzg4NyswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.K2Sm0FUHg8Tj2mYaa0i1Ak9lRt2sd07ZHcrh1b30MfU\",\n        \"token_type\": \"bearer\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:43:28.980740Z\"\n}"
						}
					]
				},
				{
					"name": "login-with-otp",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    // Access Token",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    // Refresh Token",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"",
									"    // Session ID",
									"    if (response.data.session_id) {",
									"        pm.environment.set(\"session_id\", response.data.session_id);",
									"        console.log(\"Session ID updated:\", response.data.session_id);",
									"    }",
									"",
									"    // Session Token",
									"    if (response.data.session_token) {",
									"        pm.environment.set(\"session_token\", response.data.session_token);",
									"        console.log(\"Session token updated:\", response.data.session_token);",
									"    }",
									"",
									"    // Token Type",
									"    if (response.data.token_type) {",
									"        pm.environment.set(\"token_type\", response.data.token_type);",
									"        console.log(\"Token type updated:\", response.data.token_type);",
									"    }",
									"",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdas@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/login-with-otp",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"login-with-otp"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "username",
											"value": "admin@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Admin@404!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "+96555139166",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Mrdasdeveloper@2021!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "mrdas4321@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Qwer4321!",
											"type": "text"
										},
										{
											"key": "username",
											"value": "+96598379785",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"login-with-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:43:28 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "1882"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"f39942d1-3fd8-4c7f-a910-589c46cfa15b\",\n    \"message\": \"Login successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxYTFhMTcyOC05MTkwLTQ1YWUtODUyZC00ZDVmYWNiMDY2MGUiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg1IiwiZmlyc3RfbmFtZSI6ImFhIiwibGFzdF9uYW1lIjoiYWEiLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE5ODA4LCJpYXQiOjE3NjMwMTYyMDgsImp0aSI6ImU2Yzg3ZGNjLTA5NzYtNGE0Yi05MTk0LTdiZTM3Njg4OGEyYiIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjFhMWExNzI4LTkxOTAtNDVhZS04NTJkLTRkNWZhY2IwNjYwZSIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjoiYWEiLCJsYXN0X25hbWUiOiJhYSIsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg1IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg1In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOiIyMDI1LTExLTEzVDA2OjIzOjI5LjI3MzE3NyswMDowMCIsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMzoyNi4zODk4NDcrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIzOjU1LjA3Mzg4NyswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.K2Sm0FUHg8Tj2mYaa0i1Ak9lRt2sd07ZHcrh1b30MfU\",\n        \"token_type\": \"bearer\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:43:28.980740Z\"\n}"
						}
					]
				},
				{
					"name": "refresh-token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    // Access Token",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    // Refresh Token",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"",
									"    // Session ID",
									"    if (response.data.session_id) {",
									"        pm.environment.set(\"session_id\", response.data.session_id);",
									"        console.log(\"Session ID updated:\", response.data.session_id);",
									"    }",
									"",
									"    // Session Token",
									"    if (response.data.session_token) {",
									"        pm.environment.set(\"session_token\", response.data.session_token);",
									"        console.log(\"Session token updated:\", response.data.session_token);",
									"    }",
									"",
									"    // Token Type",
									"    if (response.data.token_type) {",
									"        pm.environment.set(\"token_type\", response.data.token_type);",
									"        console.log(\"Token type updated:\", response.data.token_type);",
									"    }",
									"",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/refresh-token",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"refresh-token"
							]
						}
					},
					"response": []
				},
				{
					"name": "check-user-availability",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"admin@gmail.com\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/check-user-availability",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"check-user-availability"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379785\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/check-user-availability",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"check-user-availability"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Tue, 18 Nov 2025 05:44:58 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "221"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"ae60ef2a-af4a-4eb0-bc25-fffc1ce08d10\",\n    \"message\": \"User is not available\",\n    \"data\": {\n        \"available\": false,\n        \"first_name\": null,\n        \"last_name\": null\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-18T05:44:58.600406Z\"\n}"
						}
					]
				},
				{
					"name": "send-one-time-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdasdeveloper@gmail.com\",\n  \"channel\": \"email\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/send-one-time-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"send-one-time-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379784\",\n  \"channel\": \"sms\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/send-one-time-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"send-one-time-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:21:20 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "202"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"48d6631f-d79c-46cf-ba49-6c7fe2311997\",\n    \"message\": \"OTP sent successfully\",\n    \"data\": {\n        \"message\": \"OTP sent successfully\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:21:20.628884Z\"\n}"
						}
					]
				},
				{
					"name": "verify-one-time-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"+96598379782\",\n  \"channel\": \"sms\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify-one-time-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify-one-time-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379785\",\n  \"channel\": \"sms\",\n  \"otp\": \"473245\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/verify-one-time-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"verify-one-time-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 08:05:22 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "223"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"94e5ae63-f091-44c1-b25e-9eebb540b387\",\n    \"message\": \"Verify Successfully\",\n    \"data\": {\n        \"user_id\": \"+96598379785\",\n        \"message\": \"Verify Successfully\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T08:05:22.776751Z\"\n}"
						}
					]
				},
				{
					"name": "Verify Signup",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    // Access Token",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    // Refresh Token",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"",
									"    // Session ID",
									"    if (response.data.session_id) {",
									"        pm.environment.set(\"session_id\", response.data.session_id);",
									"        console.log(\"Session ID updated:\", response.data.session_id);",
									"    }",
									"",
									"    // Session Token",
									"    if (response.data.session_token) {",
									"        pm.environment.set(\"session_token\", response.data.session_token);",
									"        console.log(\"Session token updated:\", response.data.session_token);",
									"    }",
									"",
									"    // Token Type",
									"    if (response.data.token_type) {",
									"        pm.environment.set(\"token_type\", response.data.token_type);",
									"        console.log(\"Token type updated:\", response.data.token_type);",
									"    }",
									"",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdas1@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379784\",\n  \"channel\": \"sms\",\n  \"otp\": \"553916\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/verify",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"verify"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:21:51 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "2483"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"fcbd4a21-228b-44f4-948e-51d49e08f934\",\n    \"message\": \"Signup successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYyMzc0ZS1mYzNkLTQ4NGEtODE3OC1jMGZhZDg2YTA3YjYiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg0IiwiZmlyc3RfbmFtZSI6bnVsbCwibGFzdF9uYW1lIjpudWxsLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE4NTExLCJpYXQiOjE3NjMwMTQ5MTEsImp0aSI6IjZlMTI1OWUyLWRkMmMtNDNhNS05YzQzLTJmYThjZTI4NDRiMCIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjQwNjIzNzRlLWZjM2QtNDg0YS04MTc4LWMwZmFkODZhMDdiNiIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjpudWxsLCJsYXN0X25hbWUiOm51bGwsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg0IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg0In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOm51bGwsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMTo0Ny43ODc4MzgrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIxOjQ3Ljc4NzgzOCswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.m4bFg4EugMKOzGNweOH7pzj8jhnYY5bGpmJ0v1Pnvns\",\n        \"token_type\": \"bearer\",\n        \"user\": {\n            \"user_id\": \"4062374e-fc3d-484a-8178-c0fad86a07b6\",\n            \"phone_number\": {\n                \"phone\": \"+96598379784\"\n            },\n            \"user_name\": \"96598379784\",\n            \"show_kliky_watermark\": true,\n            \"ads_show_type\": \"public\",\n            \"auth_type\": \"phone\",\n            \"theme\": \"light\",\n            \"profile_accessibility\": \"public\",\n            \"user_type\": \"customer\",\n            \"language\": \"en\",\n            \"is_draft\": false,\n            \"is_active\": true,\n            \"is_verified\": true,\n            \"is_deleted\": false,\n            \"status\": \"Active\",\n            \"is_protected\": false,\n            \"is_trashed\": false,\n            \"created_at\": \"2025-11-13T06:21:47.787838+00:00\",\n            \"last_updated\": \"2025-11-13T06:21:47.787838+00:00\",\n            \"is_user\": true,\n            \"is_superuser\": false,\n            \"is_admin\": false,\n            \"is_business\": false,\n            \"is_accountant\": false,\n            \"is_developer\": false,\n            \"posts\": []\n        }\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:21:51.249808Z\"\n}"
						}
					]
				},
				{
					"name": "set-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"password\": \"Admin@404!!\",\n  \"confirm_password\": \"Admin@404!!\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/set-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"set-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "// {\n//   \"user_id\":\"klikyng3@gmail.com\",\n//   \"channel\": \"email\",  \n//   \"old_password\": \"Mrdasdeveloper@2021!!\",\n//   \"password\": \"Klikyng@2021!!\",\n//   \"confirm_password\": \"Klikyng@2021!!\"\n// }\n\n{\n  \"user_id\":\"+96598379555\",\n  \"channel\": \"sms\",  \n  \"old_password\": \"Mrdasdeveloper@2021!!\",\n  \"password\": \"Klikyng@2021!!\",\n  \"confirm_password\": \"Klikyng@2021!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/change-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"change-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "forget-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "\n{\n  \"user_id\":\"+96598379785\",\n  \"otp\":\"473245\",\n  \"password\": \"Klikyng@2021!!\",\n  \"confirm_password\": \"Klikyng@2021!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/forget-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"forget-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"if (response.access_token) {",
									"    pm.environment.set(\"access_token\", response.access_token);",
									"    console.log(\"Access token updated:\", response.access_token);",
									"}",
									"",
									"if (response.refresh_token) {",
									"    pm.environment.set(\"refresh_token\", response.refresh_token);",
									"    console.log(\"Refresh token updated:\", response.refresh_token);",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/logout",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"logout"
							]
						}
					},
					"response": []
				},
				{
					"name": "verify-email-and-phone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mahdi.mansournia@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify-email-and-phone",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify-email-and-phone"
							]
						}
					},
					"response": []
				},
				{
					"name": "token-info",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/token-info",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"token-info"
							]
						}
					},
					"response": []
				},
				{
					"name": "token-info",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"access_token\": \"{{access_token}}\",\n  \"session_token\": \"{{session_token}}\",\n  \"refresh_token\": \"{{refresh_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/token-info",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"token-info"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Authentication Router\n\n> **Complete Documentation for User Authentication Endpoints** \n  \n\nThis router handles all user authentication operations including login, registration, password management, OTP verification, and user availability checks.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    - [Token System](#token-system)\n        \n- [Endpoints](#endpoints)\n    - [Login with Password](#login-with-password)\n        \n    - [Login with OTP](#login-with-otp)\n        \n    - [Send OTP](#send-otp)\n        \n    - [Verify OTP](#verify-otp)\n        \n    - [Signup/Register](#signupregister)\n        \n    - [Set Password](#set-password)\n        \n    - [Change Password](#change-password)\n        \n    - [Forget Password](#forget-password)\n        \n    - [Refresh Token](#refresh-token)\n        \n    - [Logout](#logout)\n        \n    - [Check User Availability](#check-user-availability)\n        \n    - [Verify Email and Phone](#verify-email-and-phone)\n        \n    - [Change Email/Phone Workflow](#change-emailphone-workflow-recommended)\n        \n- [Token Management](#token-management)\n    - [Frontend Token Usage](#frontend-token-usage)\n        \n    - [Token Expiration Handling](#token-expiration-handling)\n        \n    - [Security Best Practices](#security-best-practices)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n- [Best Practices](#best-practices)\n    \n- [Environment Variables](#environment-variables)\n    \n- [Architecture](#architecture)\n    \n\n## Overview\n\nThe Authentication router provides comprehensive user authentication functionality including:\n\n- **Password-based Authentication**: Traditional email/phone + password login\n    \n- **OTP-based Authentication**: One-time password via email, SMS, or WhatsApp\n    \n- **User Registration**: Account creation with OTP verification\n    \n- **Password Management**: Set, change, and reset passwords\n    \n- **User Verification**: Email and phone number verification\n    \n- **Multi-Token System**: Access, refresh, and session tokens for secure authentication\n    \n- **Session Management**: Stateless session management with token blacklisting\n    \n\n**Base Path:** `/{MODE}/auth` or `/{MODE}/auth/logout`\n\n**Authentication:** Most endpoints do not require authentication (except password change, logout, and token-info)\n\n### Token System\n\nThe authentication system uses a multi-token approach for optimal security and performance:\n\n1. **Session Token** (Recommended for Frontend - Fastest & Most Secure)\n    \n    - **Lifespan**: 7 days (configurable via `SESSION_TOKEN_EXPIRY_MINUTES`)\n        \n    - **Purpose**: **Preferred token for API authentication** - contains full user profile\n        \n    - **Payload**: Complete user profile and permissions (no database lookup needed)\n        \n    - **Storage**: Store securely (httpOnly cookie or secure storage)\n        \n    - **Usage**: Include in `X-Session-Token` header or `Authorization: Bearer` header\n        \n    - **Benefits**:\n        - Fastest validation (no database queries)\n            \n        - Contains full user data\n            \n        - Longer lifespan (7 days vs 1 hour)\n            \n        - Optimized for client-side validation\n            \n2. **Access Token** (Alternative for API Calls)\n    \n    - **Lifespan**: 1 hour (60 minutes, configurable via `ACCESS_TOKEN_EXPIRY_MINUTES`)\n        \n    - **Purpose**: Lightweight token for API requests\n        \n    - **Payload**: Minimal - contains user_id, username, email, is_active, is_verified, jti (JWT ID)\n        \n    - **Storage**: Store in memory or secure storage\n        \n    - **Usage**: Include in `Authorization: Bearer` header\n        \n    - **Note**: Requires database lookup if full user data needed\n        \n    - **Features**: Includes JTI (JWT ID) for efficient blacklisting\n        \n3. **Refresh Token**\n    \n    - **Lifespan**: 30 days (configurable via `REFRESH_TOKEN_EXPIRY_MINUTES`)\n        \n    - **Purpose**: Use to obtain new tokens when they expire\n        \n    - **Payload**: Minimal - contains only user_id and session_id\n        \n    - **Storage**: Store securely (httpOnly cookie or secure storage)\n        \n    - **Usage**: Send to `/auth/refresh-token` endpoint when tokens expire\n        \n    - **Note**: Cannot be used for API authentication\n        \n4. **Session ID**\n    \n    - **Purpose**: Unique identifier for the session, used for logout operations\n        \n    - **Storage**: Store with tokens for logout functionality\n        \n    - **Usage**: Include in logout requests to revoke specific sessions\n        \n\n**Frontend Token Usage (Recommended - Session Token):**\n\n``` javascript\n// Store tokens after login\nconst { access_token, refresh_token, session_token, session_id } = loginResponse.data;\n// RECOMMENDED: Use session_token for API calls (fastest and most secure)\n// Option 1: X-Session-Token header (preferred method)\nfetch('/api/protected-endpoint', {\n  headers: {\n    'X-Session-Token': session_token\n  }\n});\n// Option 2: Authorization Bearer header (session_token works here too!)\nfetch('/api/protected-endpoint', {\n  headers: {\n    'Authorization': `Bearer ${session_token}`  // session_token in Bearer header\n  }\n});\n// Alternative: Use access_token with Bearer header (still supported)\nfetch('/api/protected-endpoint', {\n  headers: {\n    'Authorization': `Bearer ${access_token}`  // access_token in Bearer header\n  }\n});\n// When tokens expire, use refresh_token\nfetch('/api/auth/refresh-token', {\n  method: 'POST',\n  body: JSON.stringify({ refresh_token })\n});\n\n ```\n\n**Token Validation Priority:**  \nThe server accepts tokens in this order (first match wins):\n\n1. `X-Session-Token` header (preferred - fastest validation)\n    \n2. `Authorization: Bearer` header (accepts both session_token and access_token)\n    \n3. OAuth2 scheme (for Swagger UI)\n    \n4. `access_token` query parameter (backward compatibility)\n    \n\n**Important Notes:**\n\n- âœ… **Bearer header accepts both**: You can use `session_token` OR `access_token` in `Authorization: Bearer` header\n    \n- âœ… **X-Session-Token is preferred**: Fastest validation path when using `X-Session-Token` header\n    \n- âœ… **Flexible usage**: Use whichever method fits your frontend architecture\n    \n\n**Why Session Token is Recommended:**\n\n- âœ… **Fastest**: No database lookup needed (full user data in token)\n    \n- âœ… **Secure**: Same security as access token with blacklist checking\n    \n- âœ… **Longer lifespan**: 7 days vs 1 hour (fewer refresh operations)\n    \n- âœ… **Complete data**: Full user profile embedded in token\n    \n- âœ… **Optimized**: Server-side validation optimized for session tokens\n    \n- âœ… **Flexible**: Works with both `X-Session-Token` header and `Authorization: Bearer` header\n    \n\n## Endpoints\n\n### Login with Password\n\n**Endpoint:** `POST /{MODE}/auth/login-with-password`\n\n**Description:** Authenticate user with email/phone and password. Returns all tokens (access, refresh, session) upon successful authentication.\n\n**Note:** This is the single unified login endpoint for password-based authentication.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"username\": \"user@example.com\",\n  \"password\": \"your-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Login successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"f533589d-48d3-4b67-9430-c0b4793ac13e\",\n    \"token_type\": \"bearer\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Token Details:**\n\n- `access_token`: Use this for API authentication (60 minutes expiry, configurable)\n    \n- `refresh_token`: Use to refresh all tokens (30 days expiry, configurable)\n    \n- `session_token`: Contains full user profile (7 days expiry, configurable) - **RECOMMENDED**\n    \n- `session_id`: Unique session identifier for logout and session management\n    \n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User submits login form\n  â”œâ”€â–º User enters email/phone and password\n  â””â”€â–º Client validates form (email format, password length)\nStep 2: Client sends login request\n  POST /{MODE}/auth/login-with-password\n  Content-Type: application/x-www-form-urlencoded\n  Body: username=user@example.com&password=secret123\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates request\n    â”œâ”€â–º Check username exists â†’ âŒ 400 if missing\n    â””â”€â–º Check password exists â†’ âŒ 400 if missing\n  Step 4: Server authenticates user\n    â”œâ”€â–º Query database: Get user by email/phone\n    â”‚   â””â”€â–º âŒ 401 if user not found\n    â”œâ”€â–º Verify password (bcrypt/PBKDF2)\n    â”‚   â””â”€â–º âŒ 401 if password incorrect\n    â”œâ”€â–º Check user status\n    â”‚   â”œâ”€â–º is_active = true â†’ âŒ 401 if false\n    â”‚   â””â”€â–º is_verified = true â†’ âŒ 401 if false\n    â””â”€â–º Update last_sign_in_at timestamp\n  Step 5: Server clears user blacklist (if exists)\n    â”œâ”€â–º Clear user-level session blacklist\n    â””â”€â–º Clear user refresh token blacklist\n    (Allows re-login after previous logout)\n  Step 6: Server generates tokens\n    â”œâ”€â–º Generate session_id (UUID)\n    â”œâ”€â–º Generate access_token (60 min, includes JTI)\n    â”œâ”€â–º Generate session_token (7 days, includes full user profile)\n    â””â”€â–º Generate refresh_token (30 days, includes session_id)\n  Step 7: Server returns response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"data\": {\n        \"access_token\": \"...\",\n        \"refresh_token\": \"...\",\n        \"session_token\": \"...\",\n        \"session_id\": \"...\",\n        \"token_type\": \"bearer\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 8: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Extract tokens from response.data\nStep 9: Client stores tokens securely\n  â”œâ”€â–º Store session_token (RECOMMENDED for API calls)\n  â”‚   â””â”€â–º localStorage.setItem('session_token', token)\n  â”‚   OR httpOnly cookie (more secure)\n  â”œâ”€â–º Store refresh_token (for token renewal)\n  â”‚   â””â”€â–º localStorage.setItem('refresh_token', token)\n  â”‚   OR httpOnly cookie (preferred)\n  â”œâ”€â–º Store session_id (for logout)\n  â”‚   â””â”€â–º localStorage.setItem('session_id', id)\n  â””â”€â–º Store access_token (optional, if not using session_token)\n      â””â”€â–º localStorage.setItem('access_token', token)\nStep 10: Client updates UI\n  â”œâ”€â–º Redirect to dashboard/home\n  â”œâ”€â–º Update user state/context\n  â””â”€â–º Show success message\nStep 11: Client uses tokens for API calls\n  â”œâ”€â–º Add to request headers:\n  â”‚   â”œâ”€â–º X-Session-Token: <session_token> (RECOMMENDED)\n  â”‚   OR\n  â”‚   â””â”€â–º Authorization: Bearer <session_token>\n  â””â”€â–º All subsequent API requests include token\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â””â”€â–º Show: \"Username and password are required\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid username or password\" â†’ Show error, clear password field\n  â”‚   â”œâ”€â–º \"User account is not active\" â†’ Show: \"Account is disabled\"\n  â”‚   â””â”€â–º \"User account is not verified\" â†’ Show: \"Please verify your email/phone\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Login failed. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- User login\n    \n- Session establishment\n    \n- API access token generation\n    \n\n---\n\n### Send OTP\n\n**Endpoint:** `POST /{MODE}/auth/send-one-time-password`\n\n**Description:** Send one-time password via email, SMS, or WhatsApp. OTP is valid for 10 minutes.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\"\n}\n\n ```\n\n**Channel Options:**\n\n- `email`: Send OTP via email\n    \n- `sms`: Send OTP via SMS\n    \n- `whatsapp`: Send OTP via WhatsApp\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"OTP sent successfully\",\n  \"data\": {\n    \"message\": \"OTP sent successfully\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User requests OTP\n  â”œâ”€â–º User enters email/phone on login/signup form\n  â””â”€â–º User clicks \"Send OTP\" button\nStep 2: Client sends OTP request\n  POST /{MODE}/auth/send-one-time-password\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check channel exists â†’ âŒ 400 if missing\n    â””â”€â–º Validate channel value â†’ âŒ 400 if not email/sms/whatsapp\n  Step 4: Server generates OTP\n    â”œâ”€â–º Generate 6-digit random code (e.g., \"123456\")\n    â””â”€â–º Store in cache (Redis or in-memory)\n        â”œâ”€â–º Key: \"otp:{channel}:{user_id}\"\n        â”œâ”€â–º Value: OTP code\n        â””â”€â–º TTL: 600 seconds (10 minutes)\n  Step 5: Server sends OTP via channel\n    â”œâ”€â–º channel = \"email\"\n    â”‚   â””â”€â–º Send email with OTP code\n    â”‚       â””â”€â–º Subject: \"Your OTP Code\"\n    â”‚\n    â”œâ”€â–º channel = \"sms\"\n    â”‚   â””â”€â–º Send SMS via Twilio\n    â”‚       â””â”€â–º Message: \"Your OTP is: 123456\"\n    â”‚\n    â””â”€â–º channel = \"whatsapp\"\n        â””â”€â–º Send WhatsApp message via Twilio\n            â””â”€â–º Message: \"Your OTP is: 123456\"\n  Step 6: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"OTP sent successfully\",\n      \"data\": {\n        \"message\": \"OTP sent successfully\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 7: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Show success message to user\nStep 8: Client shows OTP input form\n  â”œâ”€â–º Display: \"OTP sent to your email/phone\"\n  â”œâ”€â–º Show OTP input field\n  â”œâ”€â–º Start countdown timer (10 minutes)\n  â””â”€â–º Enable \"Resend OTP\" button (after 60 seconds)\nStep 9: User enters OTP\n  â””â”€â–º User types 6-digit code from email/SMS\nStep 10: Client validates OTP format\n  â”œâ”€â–º Check: OTP is 6 digits\n  â””â”€â–º âŒ Show error if invalid format\nStep 11: Client sends OTP for verification\n  â””â”€â–º Proceed to verify-otp or login-with-otp endpoint\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"user_id is required\" â†’ Show: \"Please enter email/phone\"\n  â”‚   â””â”€â–º \"channel is required\" â†’ Show: \"Please select channel\"\n  â”‚\n  â”œâ”€â–º 500 Internal Server Error\n  â”‚   â””â”€â–º \"Failed to send OTP\" â†’ Show: \"Unable to send OTP. Please try again.\"\n  â”‚\n  â””â”€â–º Network Error\n      â””â”€â–º Show: \"Connection error. Check your internet.\"\n\n ```\n\n**Use Cases:**\n\n- Password reset\n    \n- Email/phone verification\n    \n- Two-factor authentication\n    \n- Account recovery\n    \n\n---\n\n### Verify OTP\n\n**Endpoint:** `POST /{MODE}/auth/verify-one-time-password`\n\n**Description:** Verify one-time password without logging in. Used for verification purposes.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Verify Successfully\",\n  \"data\": {\n    \"user_id\": \"user@example.com\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User enters OTP\n  â”œâ”€â–º User receives OTP via email/SMS/WhatsApp\n  â””â”€â–º User types OTP into input field\nStep 2: Client validates OTP format\n  â”œâ”€â–º Check: OTP is 6 digits\n  â””â”€â–º âŒ Show error if invalid format\nStep 3: Client sends verification request\n  POST /{MODE}/auth/verify-one-time-password\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\",\n    \"otp\": \"123456\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 4: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check channel exists â†’ âŒ 400 if missing\n    â””â”€â–º Check otp exists â†’ âŒ 400 if missing\n  Step 5: Server retrieves stored OTP\n    â”œâ”€â–º Build cache key: \"otp:{channel}:{user_id}\"\n    â”œâ”€â–º Get OTP from cache (Redis or in-memory)\n    â””â”€â–º âŒ 401 if OTP not found (expired or never sent)\n  Step 6: Server compares OTPs\n    â”œâ”€â–º Compare stored OTP with provided OTP\n    â””â”€â–º âŒ 401 if OTPs don't match\n  Step 7: Server checks expiration\n    â”œâ”€â–º Check if OTP is still valid (within 10 minutes)\n    â””â”€â–º âŒ 401 if expired\n  Step 8: Server returns verification result\n    â”œâ”€â–º OTP is NOT deleted (can be reused)\n    â””â”€â–º HTTP 200 OK\n        {\n          \"success\": true,\n          \"message\": \"Verify Successfully\",\n          \"data\": {\n            \"user_id\": \"user@example.com\"\n          }\n        }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 9: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Proceed to next step (e.g., signup, password reset)\nStep 10: Client updates UI\n  â”œâ”€â–º Show success message: \"OTP verified successfully\"\n  â”œâ”€â–º Enable next step button (e.g., \"Create Account\")\n  â””â”€â–º Hide OTP input field\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â””â”€â–º Show: \"Please enter all required fields\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect OTP. Please try again.\"\n  â”‚   â”œâ”€â–º \"OTP expired\" â†’ Show: \"OTP has expired. Please request a new one.\"\n  â”‚   â””â”€â–º \"OTP not found\" â†’ Show: \"OTP not found. Please request a new OTP.\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Verification failed. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Email verification\n    \n- Phone verification\n    \n- Pre-login verification\n    \n\n---\n\n### Login with OTP\n\n**Endpoint:** `POST /{MODE}/auth/login-with-otp`\n\n**Description:** Verify OTP and login user. Returns access token upon successful verification. OTP is deleted after successful login.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Login successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"f533589d-48d3-4b67-9430-c0b4793ac13e\",\n    \"token_type\": \"bearer\",\n    \"user\": {\n      \"user_id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"first_name\": \"John\",\n      \"last_name\": \"Doe\"\n    }\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User has received OTP\n  â”œâ”€â–º User received OTP via email/SMS/WhatsApp (from send-otp)\n  â””â”€â–º User enters OTP in login form\nStep 2: Client sends login request\n  POST /{MODE}/auth/login-with-otp\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\",\n    \"otp\": \"123456\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check channel exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check otp exists â†’ âŒ 400 if missing\n    â””â”€â–º Validate email/phone format â†’ âŒ 400 if invalid\n  Step 4: Server gets user from database\n    â”œâ”€â–º Query: getUserByEmailOrPhone(user_id)\n    â””â”€â–º âŒ 404 if user not found\n  Step 5: Server checks user status\n    â”œâ”€â–º Check is_active = true â†’ âŒ 401 if false\n    â””â”€â–º Check is_verified = true â†’ âŒ 401 if false\n  Step 6: Server verifies OTP\n    â”œâ”€â–º Get stored OTP from cache: \"otp:{channel}:{user_id}\"\n    â”œâ”€â–º Compare stored OTP with provided OTP\n    â”œâ”€â–º Check expiration (10 minutes)\n    â””â”€â–º âŒ 401 if invalid/expired\n  Step 7: Server deletes OTP (consume)\n    â””â”€â–º Delete OTP from cache (one-time use)\n  Step 8: Server updates last sign-in\n    â””â”€â–º Update last_sign_in_at = current timestamp\n  Step 9: Server clears user blacklist\n    â”œâ”€â–º Clear user-level session blacklist\n    â””â”€â–º Clear user refresh token blacklist\n  Step 10: Server generates all tokens\n    â”œâ”€â–º Generate session_id (UUID)\n    â”œâ”€â–º Generate access_token (60 min)\n    â”œâ”€â–º Generate session_token (7 days, with full profile)\n    â””â”€â–º Generate refresh_token (30 days)\n  Step 11: Server returns tokens and user data\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"data\": {\n        \"access_token\": \"...\",\n        \"refresh_token\": \"...\",\n        \"session_token\": \"...\",\n        \"session_id\": \"...\",\n        \"token_type\": \"bearer\",\n        \"user\": { ... }\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 12: Client stores tokens\n  â”œâ”€â–º Store session_token (RECOMMENDED)\n  â”œâ”€â–º Store refresh_token\n  â”œâ”€â–º Store session_id\n  â””â”€â–º Store user data in app state\nStep 13: Client updates UI\n  â”œâ”€â–º Redirect to dashboard\n  â”œâ”€â–º Show welcome message\n  â””â”€â–º Update user context/state\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â””â”€â–º Show: \"Please enter all required fields\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect OTP\"\n  â”‚   â”œâ”€â–º \"OTP expired\" â†’ Show: \"OTP expired. Request new one.\"\n  â”‚   â”œâ”€â–º \"User account is not active\" â†’ Show: \"Account disabled\"\n  â”‚   â””â”€â–º \"User account is not verified\" â†’ Show: \"Please verify account\"\n  â”‚\n  â”œâ”€â–º 404 Not Found\n  â”‚   â””â”€â–º \"User not found\" â†’ Show: \"User does not exist\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Login failed. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Passwordless login\n    \n- Quick authentication\n    \n- Mobile app login\n    \n\n---\n\n### Signup/Register\n\n**Endpoint:** `POST /{MODE}/auth/verify`\n\n**Description:** Verify OTP and create new user account. Supports master OTP for admin account creation.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Signup successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"f533589d-48d3-4b67-9430-c0b4793ac13e\",\n    \"token_type\": \"bearer\",\n    \"user\": { ... }\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User completes signup form\n  â”œâ”€â–º User enters email/phone\n  â”œâ”€â–º User requests OTP (via send-otp endpoint)\n  â””â”€â–º User receives and enters OTP\nStep 2: Client sends signup request\n  POST /{MODE}/auth/verify\n  Content-Type: application/json\n  {\n    \"user_id\": \"newuser@example.com\",\n    \"channel\": \"email\",\n    \"otp\": \"123456\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check channel exists â†’ âŒ 400 if missing\n    â””â”€â–º Check otp exists â†’ âŒ 400 if missing\n  Step 4: Server checks master OTP (optional)\n    â”œâ”€â–º Compare OTP with MASTER_OTP env variable\n    â””â”€â–º If matches â†’ Skip OTP verification, assign admin group\n  Step 5: Server verifies OTP (if not master OTP)\n    â”œâ”€â–º Get stored OTP from cache\n    â”œâ”€â–º Compare with provided OTP\n    â”œâ”€â–º Check expiration\n    â””â”€â–º âŒ 401 if invalid/expired\n    (Note: OTP not deleted yet - will be deleted after signup)\n  Step 6: Server validates email/phone format\n    â”œâ”€â–º If channel = \"email\" â†’ validateEmail()\n    â””â”€â–º If channel = \"sms/whatsapp\" â†’ validatePhone()\n    â””â”€â–º âŒ 400 if invalid format\n  Step 7: Server checks if user already exists\n    â”œâ”€â–º Query: getUserByEmailOrPhone(user_id)\n    â””â”€â–º âŒ 409 if user already exists\n  Step 8: Server creates new user account\n    â”œâ”€â–º Generate user_id (UUID)\n    â”œâ”€â–º Set default values:\n    â”‚   â”œâ”€â–º is_active: true\n    â”‚   â”œâ”€â–º is_verified: true\n    â”‚   â”œâ”€â–º profile_accessibility: \"public\"\n    â”‚   â”œâ”€â–º theme: \"light\"\n    â”‚   â”œâ”€â–º user_type: \"customer\"\n    â”‚   â”œâ”€â–º language: \"en\"\n    â”‚   â””â”€â–º status: \"ACTIVE\"\n    â”œâ”€â–º Set auth_type based on channel\n    â”œâ”€â–º Set verification status:\n    â”‚   â”œâ”€â–º is_email_verified: true (if channel=email)\n    â”‚   â””â”€â–º is_phone_verified: true (if channel=sms/whatsapp)\n    â””â”€â–º Insert user into database\n  Step 9: Server assigns groups (if master OTP)\n    â””â”€â–º Assign admin group to user\n  Step 10: Server clears user blacklist\n    â”œâ”€â–º Clear user-level session blacklist\n    â””â”€â–º Clear user refresh token blacklist\n  Step 11: Server generates all tokens\n    â”œâ”€â–º Generate session_id\n    â”œâ”€â–º Generate access_token (60 min)\n    â”œâ”€â–º Generate session_token (7 days)\n    â””â”€â–º Generate refresh_token (30 days)\n  Step 12: Server deletes OTP (if not master OTP)\n    â””â”€â–º Delete OTP from cache (consume=true)\n  Step 13: Server returns tokens and user data\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"data\": {\n        \"access_token\": \"...\",\n        \"refresh_token\": \"...\",\n        \"session_token\": \"...\",\n        \"session_id\": \"...\",\n        \"token_type\": \"bearer\",\n        \"user\": { ... }\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 14: Client stores tokens\n  â”œâ”€â–º Store session_token (RECOMMENDED)\n  â”œâ”€â–º Store refresh_token\n  â”œâ”€â–º Store session_id\n  â””â”€â–º Store user data\nStep 15: Client updates UI\n  â”œâ”€â–º Redirect to onboarding/dashboard\n  â”œâ”€â–º Show welcome message\n  â””â”€â–º Update user context/state\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Invalid email format\" â†’ Show: \"Please enter valid email\"\n  â”‚   â””â”€â–º \"Invalid phone format\" â†’ Show: \"Please enter valid phone\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â””â”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect OTP. Please try again.\"\n  â”‚\n  â”œâ”€â–º 409 Conflict\n  â”‚   â””â”€â–º \"User already exists\" â†’ Show: \"Account already exists. Please login.\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Signup failed. Please try again.\"\n\n ```\n\n**Special Features:**\n\n- **Master OTP**: If `MASTER_OTP` environment variable matches, user is assigned admin group\n    \n- **Auto-verification**: Email/phone is automatically verified during signup\n    \n- **Default Settings**: New users get sensible defaults\n    \n\n**Use Cases:**\n\n- New user registration\n    \n- Account creation\n    \n- Onboarding flow\n    \n\n---\n\n### Set Password\n\n**Endpoint:** `POST /{MODE}/auth/set-password`\n\n**Description:** Set password for authenticated user (for users who signed up with OTP).\n\n**Authentication:** Required  \n**Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password set successfully\",\n  \"data\": {\n    \"message\": \"Password set successfully\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User wants to set password\n  â”œâ”€â–º User is logged in (has valid token)\n  â””â”€â–º User navigates to \"Set Password\" page\nStep 2: User enters password\n  â”œâ”€â–º User enters new password\n  â”œâ”€â–º User confirms password\n  â””â”€â–º Client validates: passwords match\nStep 3: Client sends set password request\n  POST /{MODE}/auth/set-password\n  Authorization: Bearer <session_token>\n  Content-Type: application/json\n  {\n    \"password\": \"newSecurePassword123\",\n    \"confirm_password\": \"newSecurePassword123\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 4: Server validates authentication\n    â”œâ”€â–º Extract token from Authorization header\n    â”œâ”€â–º Validate token (decode, check expiration, blacklist)\n    â””â”€â–º âŒ 401 if invalid/expired\n  Step 5: Server validates request\n    â”œâ”€â–º Check password exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check confirm_password exists â†’ âŒ 400 if missing\n    â””â”€â–º Check password === confirm_password â†’ âŒ 400 if mismatch\n  Step 6: Server hashes password\n    â”œâ”€â–º Use bcrypt with 10 salt rounds\n    â””â”€â–º Generate secure hash\n  Step 7: Server updates user password\n    â”œâ”€â–º Get user_id from token\n    â”œâ”€â–º Update password in database\n    â””â”€â–º Update last_updated timestamp\n  Step 8: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Password set successfully\",\n      \"data\": {\n        \"message\": \"Password set successfully\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 9: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Show success message\nStep 10: Client updates UI\n  â”œâ”€â–º Show: \"Password set successfully\"\n  â”œâ”€â–º Redirect to profile/settings\n  â””â”€â–º Clear password fields\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Password is required\" â†’ Show: \"Please enter password\"\n  â”‚   â””â”€â–º \"Passwords do not match\" â†’ Show: \"Passwords don't match\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â””â”€â–º \"Invalid token\" â†’ Redirect to login\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Failed to set password. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Initial password setup\n    \n- Passwordless signup completion\n    \n\n---\n\n### Change Password\n\n**Endpoint:** `POST /{MODE}/auth/change-password`\n\n**Description:** Change user's existing password. Requires old password verification.\n\n**Authentication:** Required  \n**Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"old_password\": \"current-password\",\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password updated successfully\",\n  \"data\": {\n    \"message\": \"Password updated successfully\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User wants to change password\n  â”œâ”€â–º User is logged in (has valid token)\n  â””â”€â–º User navigates to \"Change Password\" page\nStep 2: User enters password information\n  â”œâ”€â–º User enters current password\n  â”œâ”€â–º User enters new password\n  â””â”€â–º User confirms new password\nStep 3: Client validates passwords\n  â”œâ”€â–º Check: new password !== old password\n  â”œâ”€â–º Check: new password === confirm password\n  â””â”€â–º âŒ Show error if validation fails\nStep 4: Client sends change password request\n  POST /{MODE}/auth/change-password\n  Authorization: Bearer <session_token>\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\",\n    \"old_password\": \"currentPassword123\",\n    \"password\": \"newSecurePassword123\",\n    \"confirm_password\": \"newSecurePassword123\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 5: Server validates authentication\n    â”œâ”€â–º Extract token from Authorization header\n    â”œâ”€â–º Validate token (decode, check expiration, blacklist)\n    â””â”€â–º âŒ 401 if invalid/expired\n  Step 6: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check old_password exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check password exists â†’ âŒ 400 if missing\n    â””â”€â–º Check confirm_password exists â†’ âŒ 400 if missing\n  Step 7: Server validates passwords match\n    â””â”€â–º Check password === confirm_password\n    â””â”€â–º âŒ 400 if mismatch\n  Step 8: Server verifies old password\n    â”œâ”€â–º Get user from database (by user_id from token)\n    â”œâ”€â–º Authenticate user with old_password\n    â”‚   â”œâ”€â–º Get user by email/phone\n    â”‚   â”œâ”€â–º Verify password (bcrypt/PBKDF2)\n    â”‚   â””â”€â–º Check user status (is_active, is_verified)\n    â””â”€â–º âŒ 401 if old password incorrect\n  Step 9: Server hashes new password\n    â”œâ”€â–º Use bcrypt with 10 salt rounds\n    â””â”€â–º Generate secure hash\n  Step 10: Server updates user password\n    â”œâ”€â–º Get user_id from authenticated token\n    â”œâ”€â–º Update password in database\n    â””â”€â–º Update last_updated timestamp\n  Step 11: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Password updated successfully\",\n      \"data\": {\n        \"message\": \"Password updated successfully\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 12: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Show success message\nStep 13: Client updates UI\n  â”œâ”€â–º Show: \"Password changed successfully\"\n  â”œâ”€â–º Clear password fields\n  â””â”€â–º Optionally: Force re-login for security\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Passwords do not match\" â†’ Show: \"New passwords don't match\"\n  â”‚   â””â”€â–º \"Missing required fields\" â†’ Show: \"Please fill all fields\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid token\" â†’ Redirect to login\n  â”‚   â””â”€â–º \"Invalid old password\" â†’ Show: \"Current password is incorrect\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Failed to change password. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Password change\n    \n- Security updates\n    \n- Account security\n    \n\n---\n\n### Forget Password\n\n**Endpoint:** `POST /{MODE}/auth/forget-password`\n\n**Description:** Reset password after verifying OTP. Used for password recovery.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"otp\": \"123456\",\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password updated successfully\",\n  \"data\": {\n    \"message\": \"Password updated successfully\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User forgot password\n  â”œâ”€â–º User clicks \"Forgot Password\" link\n  â””â”€â–º User enters email/phone\nStep 2: Client requests OTP\n  POST /{MODE}/auth/send-one-time-password\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\"\n  }\n  â””â”€â–º User receives OTP via email/SMS\nStep 3: User enters OTP and new password\n  â”œâ”€â–º User enters OTP from email/SMS\n  â”œâ”€â–º User enters new password\n  â””â”€â–º User confirms new password\nStep 4: Client validates passwords match\n  â””â”€â–º âŒ Show error if passwords don't match\nStep 5: Client sends password reset request\n  POST /{MODE}/auth/forget-password\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"otp\": \"123456\",\n    \"password\": \"newSecurePassword123\",\n    \"confirm_password\": \"newSecurePassword123\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 6: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check otp exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check password exists â†’ âŒ 400 if missing\n    â””â”€â–º Check confirm_password exists â†’ âŒ 400 if missing\n  Step 7: Server verifies OTP\n    â”œâ”€â–º Get stored OTP from cache\n    â”œâ”€â–º Compare with provided OTP\n    â”œâ”€â–º Check expiration (10 minutes)\n    â””â”€â–º âŒ 401 if invalid/expired\n  Step 8: Server validates email/phone format\n    â”œâ”€â–º Validate email format (if contains @)\n    â””â”€â–º Validate phone format (if doesn't contain @)\n    â””â”€â–º âŒ 400 if invalid format\n  Step 9: Server gets user from database\n    â”œâ”€â–º Query: getUserByEmailOrPhone(user_id)\n    â””â”€â–º âŒ 404 if user not found\n  Step 10: Server validates passwords match\n    â””â”€â–º Check password === confirm_password\n    â””â”€â–º âŒ 400 if mismatch\n  Step 11: Server hashes new password\n    â”œâ”€â–º Use bcrypt with 10 salt rounds\n    â””â”€â–º Generate secure hash\n  Step 12: Server updates user password\n    â”œâ”€â–º Update password in database\n    â””â”€â–º Update last_updated timestamp\n  Step 13: Server deletes OTP (consume)\n    â””â”€â–º Delete OTP from cache (one-time use)\n  Step 14: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Password updated successfully\",\n      \"data\": {\n        \"message\": \"Password updated successfully\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 15: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Show success message\nStep 16: Client updates UI\n  â”œâ”€â–º Show: \"Password reset successfully\"\n  â”œâ”€â–º Redirect to login page\n  â””â”€â–º Clear form fields\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Passwords do not match\" â†’ Show: \"Passwords don't match\"\n  â”‚   â””â”€â–º \"Invalid email/phone format\" â†’ Show: \"Invalid format\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â””â”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect or expired OTP\"\n  â”‚\n  â”œâ”€â–º 404 Not Found\n  â”‚   â””â”€â–º \"User not found\" â†’ Show: \"User does not exist\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Password reset failed. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Password recovery\n    \n- Account reset\n    \n- Security recovery\n    \n\n---\n\n### Refresh Token\n\n**Endpoint:** `POST /{MODE}/auth/refresh-token`\n\n**Description:** Refresh access token using refresh token. Returns new tokens with a new session.\n\n**Authentication:** Not required (uses refresh token)\n\n**Request Body:**\n\n``` json\n{\n  \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Token refreshed successfully\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"f533589d-48d3-4b67-9430-c0b4793ac13e\",\n    \"token_type\": \"bearer\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Token expires or about to expire\n  â”œâ”€â–º Client makes API request with expired token\n  â””â”€â–º Server returns 401 Unauthorized\nStep 2: Client detects token expiration\n  â”œâ”€â–º Intercept 401 response\n  â””â”€â–º Check if refresh_token exists\nStep 3: Client sends refresh token request\n  POST /{MODE}/auth/refresh-token\n  Content-Type: application/json\n  {\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 4: Server validates refresh token\n    â”œâ”€â–º Check refresh_token exists â†’ âŒ 400 if missing\n    â””â”€â–º Decode JWT token\n        â”œâ”€â–º Try with audience=\"authenticated\"\n        â””â”€â–º Fallback: decode without audience\n        â””â”€â–º âŒ 401 if invalid/expired\n  Step 5: Server validates token type\n    â”œâ”€â–º Check token.type === \"refresh\"\n    â””â”€â–º âŒ 401 if not refresh token\n  Step 6: Server checks blacklist status\n    â”œâ”€â–º Check if token is blacklisted â†’ âŒ 401 if blacklisted\n    â”œâ”€â–º Check if user refresh tokens revoked â†’ âŒ 401 if revoked\n    â””â”€â–º Check if session is blacklisted â†’ âŒ 401 if blacklisted\n  Step 7: Server extracts user info\n    â”œâ”€â–º Get user_id from token.sub\n    â””â”€â–º Get session_id from token (if exists)\n  Step 8: Server gets user from database\n    â”œâ”€â–º Query: getUserById(user_id)\n    â””â”€â–º âŒ 404 if user not found\n  Step 9: Server blacklists old tokens\n    â”œâ”€â–º Blacklist old refresh token\n    â””â”€â–º Blacklist old session (if session_id exists)\n  Step 10: Server generates new tokens\n    â”œâ”€â–º Generate new session_id (UUID)\n    â”œâ”€â–º Generate new access_token (60 min, new JTI)\n    â”œâ”€â–º Generate new session_token (7 days, full profile)\n    â””â”€â–º Generate new refresh_token (30 days, rotated)\n  Step 11: Server returns new tokens\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"data\": {\n        \"access_token\": \"...\",\n        \"refresh_token\": \"...\",\n        \"session_token\": \"...\",\n        \"session_id\": \"...\",\n        \"token_type\": \"bearer\"\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 12: Client receives new tokens\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Extract new tokens from response.data\nStep 13: Client updates stored tokens\n  â”œâ”€â–º Update session_token (RECOMMENDED)\n  â”œâ”€â–º Update refresh_token (rotated)\n  â”œâ”€â–º Update session_id (new)\n  â””â”€â–º Update access_token (optional)\nStep 14: Client retries original request\n  â”œâ”€â–º Use new session_token in request header\n  â””â”€â–º Original API call succeeds\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â””â”€â–º \"refresh_token is required\" â†’ Show: \"Please login again\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Refresh token expired\" â†’ Redirect to login\n  â”‚   â”œâ”€â–º \"Refresh token revoked\" â†’ Redirect to login\n  â”‚   â””â”€â–º \"Invalid refresh token\" â†’ Redirect to login\n  â”‚\n  â”œâ”€â–º 404 Not Found\n  â”‚   â””â”€â–º \"User not found\" â†’ Redirect to login\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Token refresh failed. Please login again.\"\n\n ```\n\n**Client-Side Implementation Example:**\n\n``` javascript\n// Axios interceptor for automatic token refresh\naxios.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n    // If 401 and not already retrying\n    if (error.response?.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n      try {\n        // Get refresh token\n        const refreshToken = localStorage.getItem('refresh_token');\n        // Request new tokens\n        const response = await axios.post('/api/auth/refresh-token', {\n          refresh_token: refreshToken\n        });\n        // Update stored tokens\n        localStorage.setItem('session_token', response.data.data.session_token);\n        localStorage.setItem('refresh_token', response.data.data.refresh_token);\n        localStorage.setItem('session_id', response.data.data.session_id);\n        // Retry original request with new token\n        originalRequest.headers['X-Session-Token'] = response.data.data.session_token;\n        return axios(originalRequest);\n      } catch (refreshError) {\n        // Refresh failed, redirect to login\n        localStorage.clear();\n        window.location.href = '/login';\n        return Promise.reject(refreshError);\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n ```\n\n**Token Rotation:**\n\n- All tokens are rotated (new tokens generated)\n    \n- Old refresh token is blacklisted\n    \n- Old session is blacklisted (if session_id exists)\n    \n- New session_id is created for all new tokens\n    \n- Complete token rotation for security\n    \n\n**Use Cases:**\n\n- Access token expiration\n    \n- Token rotation for security\n    \n- Session renewal\n    \n\n**Error Responses:**\n\n- `400`: Refresh token not provided\n    \n- `401`: Invalid or expired refresh token\n    \n- `401`: Refresh token has been revoked (user-level blacklist)\n    \n- `401`: Session has been revoked\n    \n- `401`: Invalid token type (not a refresh token)\n    \n- `404`: User not found\n    \n- `500`: JWT configuration error\n    \n\n---\n\n### Logout\n\n**Endpoint:** `POST /{MODE}/auth/logout`\n\n**Description:** Logout user and revoke all tokens and sessions from all devices. Returns detailed revocation status.\n\n**Authentication:** Required (permission: `view_profile`)\n\n**Request Body:** None\n\n**Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\nor\n\n```\nX-Session-Token: <session_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Logged out successfully. All tokens and sessions have been revoked.\",\n  \"data\": {\n    \"message\": \"Logged out successfully\",\n    \"access_token_revoked\": true,\n    \"refresh_tokens_revoked\": true,\n    \"sessions_revoked\": true,\n    \"tokens_revoked\": true\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Response Fields:**\n\n- `access_token_revoked`: Whether the current access token was blacklisted (by JTI)\n    \n- `refresh_tokens_revoked`: Whether all refresh tokens for the user were revoked\n    \n- `sessions_revoked`: Whether all sessions for the user were blacklisted (complete logout from all devices)\n    \n- `tokens_revoked`: Overall status - true if all operations succeeded\n    \n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User clicks logout\n  â”œâ”€â–º User clicks \"Logout\" button\n  â””â”€â–º Client shows confirmation (optional)\nStep 2: Client sends logout request\n  POST /{MODE}/auth/logout\n  Authorization: Bearer <session_token>\n  OR\n  X-Session-Token: <session_token>\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates authentication\n    â”œâ”€â–º Extract token from Authorization header or X-Session-Token\n    â”œâ”€â–º Validate token (decode, check signature)\n    â””â”€â–º âŒ 401 if invalid (but continues with logout if expired)\n  Step 4: Server decodes token (even if expired)\n    â”œâ”€â–º Decode with verify_exp: false (allows expired tokens)\n    â”œâ”€â–º Extract JTI (JWT ID) from token\n    â”œâ”€â–º Extract user_id from token.sub\n    â””â”€â–º Extract session_id from token (if available)\n  Step 5: Server blacklists access token\n    â”œâ”€â–º Blacklist by JTI: \"blacklist:access:jti:{jti}\"\n    â””â”€â–º TTL: 45 days (3888000 seconds)\n  Step 6: Server revokes all refresh tokens\n    â”œâ”€â–º Set user-level blacklist: \"blacklist:refresh:user:{user_id}\"\n    â””â”€â–º TTL: 30 days (all refresh tokens for user invalidated)\n  Step 7: Server blacklists all user sessions\n    â”œâ”€â–º Set user-level blacklist: \"blacklist:user:{user_id}\"\n    â””â”€â–º TTL: 30 days (all sessions for user invalidated)\n    â””â”€â–º Complete logout from all devices\n  Step 8: Server tracks revocation status\n    â”œâ”€â–º access_token_revoked: true/false\n    â”œâ”€â–º refresh_tokens_revoked: true/false\n    â”œâ”€â–º sessions_revoked: true/false\n    â””â”€â–º tokens_revoked: overall status\n  Step 9: Server returns logout status\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Logged out successfully. All tokens and sessions have been revoked.\",\n      \"data\": {\n        \"message\": \"Logged out successfully\",\n        \"access_token_revoked\": true,\n        \"refresh_tokens_revoked\": true,\n        \"sessions_revoked\": true,\n        \"tokens_revoked\": true\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 10: Client receives logout response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Check tokens_revoked status\nStep 11: Client clears local storage\n  â”œâ”€â–º Remove session_token\n  â”œâ”€â–º Remove refresh_token\n  â”œâ”€â–º Remove access_token\n  â”œâ”€â–º Remove session_id\n  â””â”€â–º Clear user data from app state\nStep 12: Client updates UI\n  â”œâ”€â–º Redirect to login page\n  â”œâ”€â–º Clear user context/state\n  â””â”€â–º Show logout success message (optional)\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â””â”€â–º Token invalid/expired â†’ Still proceed with logout\n  â”‚       â””â”€â–º Clear local storage and redirect to login\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Logout may have partially succeeded\n      â””â”€â–º Still clear local storage and redirect to login\n\n ```\n\n**Important Notes:**\n\n- Logout works even with expired tokens (server decodes without expiration check)\n    \n- All tokens are invalidated (access, refresh, session)\n    \n- All sessions are revoked (complete logout from all devices)\n    \n- Client should always clear local storage regardless of response\n    \n\n**Token Blacklisting:**\n\n- Access tokens are blacklisted by JTI (JWT ID) for efficiency\n    \n- All refresh tokens for the user are revoked (user-level blacklist)\n    \n- All sessions for the user are blacklisted (complete logout from all devices)\n    \n- Blacklist entries expire automatically based on token expiration times\n    \n- Works even with expired tokens (decodes without expiration check)\n    \n\n**Security Features:**\n\n- Complete logout from all devices (all sessions revoked)\n    \n- All refresh tokens invalidated (prevents token refresh)\n    \n- Access token blacklisted (prevents reuse)\n    \n- Works with expired tokens (for cleanup)\n    \n\n**Use Cases:**\n\n- User logout\n    \n- Complete session termination (all devices)\n    \n- Security logout\n    \n- Account security\n    \n- Force logout from all devices\n    \n\n---\n\n### Check User Availability\n\n**Endpoint:** `POST /{MODE}/auth/check-user-availability`\n\n**Description:** Check if email or phone number is available for registration.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\"\n}\n\n ```\n\n**Alternative:**\n\n``` json\n{\n  \"email\": \"user@example.com\"\n}\n\n ```\n\nor\n\n``` json\n{\n  \"phone\": \"+1234567890\"\n}\n\n ```\n\n**Response (Available):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User is not available\",\n  \"data\": {\n    \"available\": false,\n    \"first_name\": null,\n    \"last_name\": null\n  }\n}\n\n ```\n\n**Response (Not Available):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User is available\",\n  \"data\": {\n    \"available\": true,\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User enters email/phone in registration form\n  â”œâ”€â–º User types email or phone number\n  â””â”€â–º Client may validate format client-side (optional)\nStep 2: Client sends availability check (on blur or debounced)\n  POST /{MODE}/auth/check-user-availability\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\"\n  }\n  OR\n  {\n    \"email\": \"user@example.com\"\n  }\n  OR\n  {\n    \"phone\": \"+1234567890\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 3: Server validates request\n    â”œâ”€â–º Check: user_id OR email OR phone exists\n    â””â”€â–º âŒ 400 if none provided\n  Step 4: Server determines identifier\n    â”œâ”€â–º Use user_id if provided\n    â”œâ”€â–º Use email if provided\n    â””â”€â–º Use phone if provided\n  Step 5: Server validates format\n    â”œâ”€â–º If email format â†’ validateEmail()\n    â””â”€â–º If phone format â†’ validatePhone()\n    â””â”€â–º âŒ 400 if invalid format\n  Step 6: Server queries database\n    â”œâ”€â–º Query: getUserByEmailOrPhone(identifier)\n    â””â”€â–º Returns user if exists, None if not exists\n  Step 7: Server determines availability\n    â”œâ”€â–º If user exists:\n    â”‚   â”œâ”€â–º available: false\n    â”‚   â”œâ”€â–º first_name: user.first_name (if exists)\n    â”‚   â””â”€â–º last_name: user.last_name (if exists)\n    â””â”€â–º If user not exists:\n        â”œâ”€â–º available: true\n        â”œâ”€â–º first_name: null\n        â””â”€â–º last_name: null\n  Step 8: Server returns availability status\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"User is not available\",  // or \"User is available\"\n      \"data\": {\n        \"available\": false,  // or true\n        \"first_name\": \"John\",  // or null\n        \"last_name\": \"Doe\"  // or null\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 9: Client receives response\n  â”œâ”€â–º Check response.data.available\n  â””â”€â–º Update UI based on availability\nStep 10: Client updates UI\n  â”œâ”€â–º If available === false:\n  â”‚   â”œâ”€â–º Show: \"Email/phone already registered\"\n  â”‚   â”œâ”€â–º Show user name if provided: \"This email belongs to John Doe\"\n  â”‚   â””â”€â–º Disable submit button or show error\n  â””â”€â–º If available === true:\n      â”œâ”€â–º Show: \"Email/phone is available\" (optional)\n      â””â”€â–º Enable submit button\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"user_id, email, or phone is required\" â†’ Show: \"Please enter email/phone\"\n  â”‚   â””â”€â–º \"Invalid email/phone format\" â†’ Show: \"Invalid format\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Unable to check availability. Please try again.\"\n\n ```\n\n**Client-Side Implementation Example:**\n\n``` javascript\n// Debounced availability check\nlet checkTimeout;\nconst emailInput = document.getElementById('email');\nemailInput.addEventListener('input', (e) => {\n  clearTimeout(checkTimeout);\n  const email = e.target.value;\n  // Wait 500ms after user stops typing\n  checkTimeout = setTimeout(async () => {\n    if (email && validateEmail(email)) {\n      try {\n        const response = await fetch('/api/auth/check-user-availability', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ email })\n        });\n        const data = await response.json();\n        if (!data.data.available) {\n          // Email already registered\n          showError('Email already registered');\n          if (data.data.first_name) {\n            showInfo(`This email belongs to ${data.data.first_name} ${data.data.last_name}`);\n          }\n        } else {\n          // Email available\n          clearError();\n        }\n      } catch (error) {\n        console.error('Availability check failed:', error);\n      }\n    }\n  }, 500);\n});\n\n ```\n\n**Use Cases:**\n\n- Registration form validation\n    \n- Username/email availability check\n    \n- Phone number availability check\n    \n\n---\n\n### Verify Email and Phone\n\n**Endpoint:** `POST /{MODE}/auth/verify-email-and-phone`\n\n**Description:** Verify email or phone number with OTP.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Email/Phone verified successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User wants to verify email/phone\n  â”œâ”€â–º User is on verification page\n  â””â”€â–º User has received OTP (from send-otp endpoint)\nStep 2: User enters OTP\n  â”œâ”€â–º User enters OTP from email/SMS\n  â””â”€â–º User clicks \"Verify\" button\nStep 3: Client sends verification request\n  POST /{MODE}/auth/verify-email-and-phone\n  Content-Type: application/json\n  {\n    \"user_id\": \"user@example.com\",\n    \"channel\": \"email\",\n    \"otp\": \"123456\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 4: Server validates request\n    â”œâ”€â–º Check user_id exists â†’ âŒ 400 if missing\n    â”œâ”€â–º Check channel exists â†’ âŒ 400 if missing\n    â””â”€â–º Check otp exists â†’ âŒ 400 if missing\n  Step 5: Server validates channel\n    â”œâ”€â–º Check channel is \"email\" or \"sms\"\n    â””â”€â–º âŒ 400 if invalid channel\n  Step 6: Server validates format\n    â”œâ”€â–º If channel = \"email\" â†’ validateEmail(user_id)\n    â””â”€â–º If channel = \"sms\" â†’ validatePhone(user_id)\n    â””â”€â–º âŒ 400 if invalid format\n  Step 7: Server verifies OTP\n    â”œâ”€â–º Get stored OTP from cache: \"otp:{channel}:{user_id}\"\n    â”œâ”€â–º Compare stored OTP with provided OTP\n    â”œâ”€â–º Check expiration (10 minutes)\n    â””â”€â–º âŒ 401 if invalid/expired\n    â””â”€â–º OTP is NOT deleted (consume=false, can be reused)\n  Step 8: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Email/Phone verified successfully\",\n      \"data\": {\n        \"user_id\": \"user@example.com\",\n        \"channel\": \"email\",\n        \"verified\": true\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 9: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Check response.data.verified === true\nStep 10: Client updates UI\n  â”œâ”€â–º Show: \"Email/Phone verified successfully\"\n  â”œâ”€â–º Mark verification status as complete\n  â”œâ”€â–º Enable next step (e.g., complete profile)\n  â””â”€â–º Hide OTP input field\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Invalid channel\" â†’ Show: \"Channel must be email or sms\"\n  â”‚   â”œâ”€â–º \"Invalid email format\" â†’ Show: \"Please enter valid email\"\n  â”‚   â””â”€â–º \"Invalid phone format\" â†’ Show: \"Please enter valid phone\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect OTP. Please try again.\"\n  â”‚   â””â”€â–º \"OTP expired\" â†’ Show: \"OTP expired. Please request a new one.\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Verification failed. Please try again.\"\n\n ```\n\n**Note:** This endpoint does NOT delete the OTP after verification (consume=false), allowing the OTP to be reused for other verification steps if needed.\n\n**Use Cases:**\n\n- Email verification\n    \n- Phone verification\n    \n- Account verification\n    \n\n---\n\n### Change Email/Phone Workflow (Recommended)\n\n**Description:** Secure two-step verification process for changing email or phone number. This workflow ensures both the current and new contact information are verified before making changes.\n\n**Recommended Workflow Steps:**\n\n1. **Step 1: Verify Primary Email/Phone** (Optional but Recommended)\n    \n    - Verify user owns the current email/phone before allowing changes\n        \n    - Provides additional security layer\n        \n2. **Step 2: Request OTP for New Email/Phone**\n    \n    - Request OTP to be sent to the new email/phone address\n        \n    - Ensures user has access to the new contact information\n        \n3. **Step 3: Change Email/Phone**\n    \n    - Call the change email/phone API with the OTP\n        \n    - Server verifies OTP and updates the contact information\n        \n\n**Complete Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User initiates email/phone change\n  â”œâ”€â–º User is logged in (has valid token)\n  â”œâ”€â–º User navigates to \"Change Email\" or \"Change Phone\" page\n  â””â”€â–º User enters new email/phone address\nStep 2: (OPTIONAL) Verify Primary Email/Phone\n  â”œâ”€â–º Client requests OTP for current email/phone\n  â”‚   POST /{MODE}/auth/send-one-time-password\n  â”‚   {\n  â”‚     \"user_id\": \"current@example.com\",  // Current email/phone\n  â”‚     \"channel\": \"email\"\n  â”‚   }\n  â”‚\n  â””â”€â–º User receives OTP on current email/phone\n      â””â”€â–º User enters OTP to verify ownership\nStep 3: Client verifies primary email/phone (OPTIONAL)\n  â”œâ”€â–º POST /{MODE}/auth/verify-one-time-password\n  â”‚   {\n  â”‚     \"user_id\": \"current@example.com\",\n  â”‚     \"channel\": \"email\",\n  â”‚     \"otp\": \"123456\"\n  â”‚   }\n  â”‚\n  â””â”€â–º Server verifies OTP (does NOT delete it)\n      â””â”€â–º Response: { \"success\": true, \"message\": \"Verify Successfully\" }\nStep 4: Client requests OTP for NEW email/phone\n  â”œâ”€â–º POST /{MODE}/auth/send-one-time-password\n  â”‚   {\n  â”‚     \"user_id\": \"newemail@example.com\",  // NEW email/phone\n  â”‚     \"channel\": \"email\"\n  â”‚   }\n  â”‚\n  â””â”€â–º User receives OTP on NEW email/phone\n      â””â”€â–º This proves user has access to new contact info\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Server â†’ Generates OTP, stores in cache (10 min TTL)\n  Server â†’ Sends OTP via email/SMS/WhatsApp to NEW address\n  Server â†’ Response: { \"success\": true, \"message\": \"OTP sent successfully\" }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 5: User receives OTP on new email/phone\n  â””â”€â–º User checks new email/SMS, gets 6-digit code\nStep 6: Client calls change email/phone API\n  â”œâ”€â–º POST /{MODE}/settings/change-email\n  â”‚   Authorization: Bearer <session_token>\n  â”‚   {\n  â”‚     \"new_email\": \"newemail@example.com\",\n  â”‚     \"otp\": \"123456\"  // OTP received on new email\n  â”‚   }\n  â”‚\n  OR\n  â”‚\n  â”œâ”€â–º POST /{MODE}/settings/change-phone\n  â”‚   Authorization: Bearer <session_token>\n  â”‚   {\n  â”‚     \"new_phone\": \"+1234567890\",\n  â”‚     \"otp\": \"123456\"  // OTP received on new phone\n  â”‚   }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Step 7: Server validates authentication\n    â”œâ”€â–º Extract token from Authorization header\n    â”œâ”€â–º Validate token (decode, check expiration, blacklist)\n    â””â”€â–º âŒ 401 if invalid/expired\n  Step 8: Server verifies OTP for NEW email/phone\n    â”œâ”€â–º Get stored OTP from cache: \"otp:{channel}:{new_email/phone}\"\n    â”œâ”€â–º Compare stored OTP with provided OTP\n    â”œâ”€â–º Check expiration (10 minutes)\n    â””â”€â–º âŒ 400 if invalid/expired\n  Step 9: Server checks email/phone availability\n    â”œâ”€â–º Check if new email/phone already exists for another user\n    â””â”€â–º âŒ 400 if already exists\n  Step 10: Server updates email/phone\n    â”œâ”€â–º Update user.email or user.phone_number\n    â”œâ”€â–º Set is_email_verified = TRUE or is_phone_verified = TRUE\n    â”œâ”€â–º Set email_verified_at or phone_number_verified_at = NOW()\n    â””â”€â–º Update last_updated = NOW()\n  Step 11: Server deletes OTP (consume)\n    â””â”€â–º Delete OTP from cache (one-time use)\n  Step 12: Server returns success response\n    HTTP 200 OK\n    {\n      \"success\": true,\n      \"message\": \"Email/Phone updated and verified successfully\",\n      \"data\": {\n        \"user\": {\n          \"id\": \"uuid\",\n          \"email\": \"newemail@example.com\",\n          \"is_email_verified\": true,\n          \"email_verified_at\": \"2025-01-28T15:51:55Z\"\n        }\n      }\n    }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 13: Client receives response\n  â”œâ”€â–º Check response.success === true\n  â””â”€â–º Extract updated user data\nStep 14: Client updates UI\n  â”œâ”€â–º Show: \"Email/Phone updated successfully\"\n  â”œâ”€â–º Update user profile display\n  â”œâ”€â–º Clear form fields\n  â””â”€â–º Redirect to profile/settings page\n\n ```\n\n**Why This Workflow is Recommended:**\n\n1. **Security**: Verifies ownership of both current and new contact information\n    \n2. **Prevents Unauthorized Changes**: Requires access to both email/phone addresses\n    \n3. **Two-Step Verification**: Adds an extra layer of security\n    \n4. **User Experience**: Clear step-by-step process\n    \n5. **Error Prevention**: Catches issues before making changes\n    \n\n**Alternative Simplified Workflow (Less Secure):**\n\nIf you skip Step 2-3 (primary verification), you can directly:\n\n1. Request OTP for new email/phone\n    \n2. Call change email/phone API\n    \n\n**However, the recommended workflow provides better security.**\n\n**Client-Side Implementation Example:**\n\n``` javascript\n// Complete email change workflow\nasync function changeEmailWithVerification(currentEmail, newEmail) {\n  try {\n    // Step 1: (Optional) Verify current email\n    // Request OTP for current email\n    await fetch('/api/v1/auth/send-one-time-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        user_id: currentEmail,\n        channel: 'email'\n      })\n    });\n    // User enters OTP for current email\n    const currentOtp = prompt('Enter OTP sent to your current email:');\n    // Verify current email\n    const verifyResponse = await fetch('/api/v1/auth/verify-one-time-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        user_id: currentEmail,\n        channel: 'email',\n        otp: currentOtp\n      })\n    });\n    const verifyData = await verifyResponse.json();\n    if (!verifyData.success) {\n      throw new Error('Current email verification failed');\n    }\n    // Step 2: Request OTP for new email\n    await fetch('/api/v1/auth/send-one-time-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        user_id: newEmail,\n        channel: 'email'\n      })\n    });\n    // User enters OTP for new email\n    const newOtp = prompt('Enter OTP sent to your new email:');\n    // Step 3: Change email\n    const token = localStorage.getItem('session_token');\n    const changeResponse = await fetch('/api/v1/settings/change-email', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        new_email: newEmail,\n        otp: newOtp\n      })\n    });\n    const changeData = await changeResponse.json();\n    if (changeData.success) {\n      console.log('Email changed successfully:', changeData.data.user.email);\n      return changeData.data;\n    } else {\n      throw new Error(changeData.error?.message || 'Failed to change email');\n    }\n  } catch (error) {\n    console.error('Email change error:', error);\n    throw error;\n  }\n}\n// Simplified workflow (without primary verification)\nasync function changeEmailSimple(newEmail) {\n  try {\n    // Step 1: Request OTP for new email\n    await fetch('/api/v1/auth/send-one-time-password', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        user_id: newEmail,\n        channel: 'email'\n      })\n    });\n    // User enters OTP\n    const otp = prompt('Enter OTP sent to your new email:');\n    // Step 2: Change email\n    const token = localStorage.getItem('session_token');\n    const response = await fetch('/api/v1/settings/change-email', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      },\n      body: JSON.stringify({\n        new_email: newEmail,\n        otp: otp\n      })\n    });\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Email change error:', error);\n    throw error;\n  }\n}\n\n ```\n\n**Error Handling:**\n\n```\nClient receives error response:\n  â”œâ”€â–º 400 Bad Request\n  â”‚   â”œâ”€â–º \"Invalid OTP\" â†’ Show: \"Incorrect OTP. Please try again.\"\n  â”‚   â”œâ”€â–º \"Email already exists\" â†’ Show: \"This email is already registered\"\n  â”‚   â””â”€â–º \"Invalid email format\" â†’ Show: \"Please enter valid email\"\n  â”‚\n  â”œâ”€â–º 401 Unauthorized\n  â”‚   â”œâ”€â–º \"Invalid token\" â†’ Redirect to login\n  â”‚   â””â”€â–º \"OTP expired\" â†’ Show: \"OTP expired. Please request a new one.\"\n  â”‚\n  â”œâ”€â–º 403 Forbidden\n  â”‚   â””â”€â–º \"Permission denied\" â†’ Show: \"You don't have permission to change email\"\n  â”‚\n  â””â”€â–º 500 Internal Server Error\n      â””â”€â–º Show: \"Failed to change email. Please try again.\"\n\n ```\n\n**Use Cases:**\n\n- Secure email change with two-step verification\n    \n- Secure phone change with two-step verification\n    \n- Account security updates\n    \n- Contact information updates\n    \n\n**Related Endpoints:**\n\n- `POST /{MODE}/auth/send-one-time-password` - Request OTP\n    \n- `POST /{MODE}/auth/verify-one-time-password` - Verify OTP (doesn't delete)\n    \n- `POST /{MODE}/settings/change-email` - Change email (requires OTP to new email)\n    \n- `POST /{MODE}/settings/change-phone` - Change phone (requires OTP to new phone)\n    \n\n---\n\n### Token Info\n\n**Endpoint:** `GET /{MODE}/auth/token-info` or `POST /{MODE}/auth/token-info`\n\n**Description:** Get information about the current authentication token. Useful for debugging and understanding token configuration.\n\n**Authentication:** Required\n\n**Request Body (POST only, optional):**\n\n``` json\n{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n\n ```\n\n**Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\nor\n\n```\nX-Session-Token: <session_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Token information retrieved successfully\",\n  \"data\": {\n    \"current_token\": {\n      \"type\": \"session\",\n      \"user_id\": \"f533589d-48d3-4b67-9430-c0b4793ac13e\",\n      \"expires_at\": \"2025-02-04T15:51:55Z\",\n      \"expires_in\": \"7 days\",\n      \"issued_at\": \"2025-01-28T15:51:55Z\",\n      \"session_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    },\n    \"token_config\": {\n      \"access_token\": {\n        \"expiry_minutes\": 60,\n        \"expires_in\": \"1 hour\"\n      },\n      \"session_token\": {\n        \"expiry_minutes\": 10080,\n        \"expires_in\": \"7 days\"\n      },\n      \"refresh_token\": {\n        \"expiry_minutes\": 43200,\n        \"expires_in\": \"30 days\"\n      }\n    },\n    \"extension_info\": {\n      \"access_token_extension\": \"1 hour\",\n      \"session_token_extension\": \"7 days\",\n      \"refresh_token_extension\": \"30 days\"\n    }\n  }\n}\n\n ```\n\n**Response Fields:**\n\n- `current_token`: Information about the token used for authentication\n    - `type`: Token type (access, session, or refresh)\n        \n    - `user_id`: User ID from token\n        \n    - `expires_at`: Token expiration timestamp\n        \n    - `expires_in`: Human-readable expiration time\n        \n    - `issued_at`: Token issuance timestamp\n        \n    - `session_id`: Session identifier (if available)\n        \n- `token_config`: Configuration for all token types\n    \n- `extension_info`: How long tokens are extended when refreshed\n    \n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Extract Token from Headers\n   â”‚   â”œâ”€â–º Authorization Bearer header\n   â”‚   â””â”€â–º X-Session-Token header (fallback)\n   â”‚\n   â”œâ”€â–º Decode Token\n   â”‚   â”œâ”€â–º Extract token type\n   â”‚   â”œâ”€â–º Extract user_id\n   â”‚   â”œâ”€â–º Extract expiration time\n   â”‚   â””â”€â–º Extract session_id\n   â”‚\n   â”œâ”€â–º Get Token Configuration\n   â”‚   â””â”€â–º Read from environment variables\n   â”‚\n   â””â”€â–º Return Token Information\n\n ```\n\n**Use Cases:**\n\n- Debug authentication issues\n    \n- Check token expiration\n    \n- Understand token configuration\n    \n- Verify token type and payload\n    \n- Client-side token validation\n    \n\n**Note:** This endpoint is excluded from API schema (`include_in_schema=False`) but is available for use.\n\n---\n\n## Workflows\n\n### Complete Authentication Flow (High-Level Overview)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              User Authentication Flow                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Registration?  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚   Signup      â”‚         â”‚    Login      â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Send OTP     â”‚         â”‚ Password/OTP  â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Verify OTP   â”‚         â”‚ Authenticate  â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Generate Token  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Return Token   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n**Flow Explanation:**\n\n1. **User Decision**: User chooses between Registration (Signup) or Login\n    \n2. **Signup Path**: Send OTP â†’ Verify OTP â†’ Generate Token\n    \n3. **Login Path**: Password/OTP â†’ Authenticate â†’ Generate Token\n    \n4. **Token Generation**: Server generates all tokens (access, refresh, session)\n    \n5. **Token Return**: Client receives tokens and stores them securely\n    \n\n### Enhanced Authentication Flow Diagram (Client â†” Server)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                         CLIENT                                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â”‚ User Action: Login or Signup?\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Registration?      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                               â”‚\n                â–¼                               â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚   SIGNUP     â”‚               â”‚    LOGIN      â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                               â”‚\n                â”‚                               â”‚\n                â–¼                               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚\n        â”‚  Send OTP     â”‚                       â”‚\n        â”‚  (Client)     â”‚                       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚\n                â”‚                               â”‚\n                â”‚ POST /auth/send-otp           â”‚\n                â–¼                               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚\n        â”‚  SERVER       â”‚                       â”‚\n        â”‚  - Generate   â”‚                       â”‚\n        â”‚  - Store OTP  â”‚                       â”‚\n        â”‚  - Send Email â”‚                       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚\n                â”‚                               â”‚\n                â”‚ Response: OTP Sent            â”‚\n                â–¼                               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚\n        â”‚  User Receivesâ”‚                       â”‚\n        â”‚  OTP via Emailâ”‚                       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚\n                â”‚                               â”‚\n                â”‚ POST /auth/verify             â”‚\n                â”‚ (Signup)                      â”‚\n                â–¼                               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚\n        â”‚  SERVER       â”‚                       â”‚\n        â”‚  - Verify OTP â”‚                       â”‚\n        â”‚  - Create Userâ”‚                       â”‚\n        â”‚  - Generate   â”‚                       â”‚\n        â”‚    Tokens     â”‚                       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚\n                â”‚                               â”‚\n                â”‚ Response: Tokens + User       â”‚\n                â–¼                               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚\n        â”‚  CLIENT       â”‚                       â”‚\n        â”‚  - Store      â”‚                       â”‚\n        â”‚    Tokens     â”‚                       â”‚\n        â”‚  - Redirect   â”‚                       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚\n                                                â”‚\n                                                â”‚\n                                                â–¼\n                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                                        â”‚  Password/   â”‚\n                                        â”‚  OTP Login   â”‚\n                                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                                                â”‚\n                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                        â”‚                                               â”‚\n                        â–¼                                               â–¼\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚ Password      â”‚                               â”‚ OTP Login     â”‚\n                â”‚ Login         â”‚                               â”‚               â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                        â”‚                                               â”‚\n                        â”‚ POST /auth/login-with-password                â”‚ POST /auth/send-otp\n                        â–¼                                               â–¼\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚  SERVER       â”‚                               â”‚  SERVER       â”‚\n                â”‚  - Validate   â”‚                               â”‚  - Generate   â”‚\n                â”‚  - Authenticateâ”‚                              â”‚  - Send OTP   â”‚\n                â”‚  - Generate   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚    Tokens     â”‚                                       â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚\n                        â”‚                                               â”‚ User Receives OTP\n                        â”‚                                               â–¼\n                        â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                        â”‚                                       â”‚ POST /auth/   â”‚\n                        â”‚                                       â”‚ login-with-otpâ”‚\n                        â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                        â”‚                                               â”‚\n                        â”‚                                               â–¼\n                        â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                        â”‚                                       â”‚  SERVER       â”‚\n                        â”‚                                       â”‚  - Verify OTP â”‚\n                        â”‚                                       â”‚  - Generate   â”‚\n                        â”‚                                       â”‚    Tokens     â”‚\n                        â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                        â”‚                                               â”‚\n                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                                â”‚\n                                                â”‚ Response: Tokens + User\n                                                â–¼\n                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                                        â”‚  CLIENT       â”‚\n                                        â”‚  - Store      â”‚\n                                        â”‚    Tokens     â”‚\n                                        â”‚  - Use for APIâ”‚\n                                        â”‚    Requests   â”‚\n                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n**Key Points:**\n\n- **Blue boxes**: Client-side actions\n    \n- **Green boxes**: Server-side processing\n    \n- **Arrows**: Request/response flow direction\n    \n- **Multiple paths**: Shows different authentication methods\n    \n- **Token storage**: Final step shows token usage for API requests\n    \n\n---\n\n### Complete Authentication Flow (Detailed Client-Server Communication)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nUser Action: Wants to login or signup\n  â”‚\n  â”œâ”€â–º Decision: New User (Signup) or Existing User (Login)?\n  â”‚\n  â””â”€â–º User enters email/phone\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSCENARIO 1: NEW USER (SIGNUP)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStep 1: Check Availability (Optional)\n  Client â†’ POST /auth/check-user-availability\n  Body: { \"email\": \"user@example.com\" }\n  Server â†’ Response: { \"available\": true }\n  Client: If available, proceed to signup\nStep 2: Request OTP\n  Client â†’ POST /auth/send-one-time-password\n  Body: { \"user_id\": \"user@example.com\", \"channel\": \"email\" }\n  Server â†’ Generates OTP, stores in cache, sends email\n  Server â†’ Response: { \"success\": true, \"message\": \"OTP sent\" }\n  Client: Shows \"OTP sent to your email\"\nStep 3: User receives OTP\n  User: Checks email, gets 6-digit code\nStep 4: Verify OTP and Signup\n  Client â†’ POST /auth/verify\n  Body: { \"user_id\": \"user@example.com\", \"channel\": \"email\", \"otp\": \"123456\" }\n  Server â†’ Verifies OTP, creates user account, generates tokens\n  Server â†’ Response: { \"success\": true, \"data\": { tokens, user } }\n  Client: Stores tokens, redirects to dashboard\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nSCENARIO 2: EXISTING USER (LOGIN)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOPTION A: Password Login\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStep 1: User enters credentials\n  Client: User enters email/phone and password\nStep 2: Login Request\n  Client â†’ POST /auth/login-with-password\n  Body: username=user@example.com&password=secret123\n  Server â†’ Validates credentials, checks user status, generates tokens\n  Server â†’ Response: { \"success\": true, \"data\": { tokens, user } }\n  Client: Stores tokens, redirects to dashboard\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOPTION B: OTP Login\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStep 1: Request OTP\n  Client â†’ POST /auth/send-one-time-password\n  Body: { \"user_id\": \"user@example.com\", \"channel\": \"email\" }\n  Server â†’ Generates OTP, sends email\n  Server â†’ Response: { \"success\": true }\n  Client: Shows \"OTP sent to your email\"\nStep 2: User receives OTP\n  User: Checks email, gets 6-digit code\nStep 3: Login with OTP\n  Client â†’ POST /auth/login-with-otp\n  Body: { \"user_id\": \"user@example.com\", \"channel\": \"email\", \"otp\": \"123456\" }\n  Server â†’ Verifies OTP, checks user status, generates tokens\n  Server â†’ Response: { \"success\": true, \"data\": { tokens, user } }\n  Client: Stores tokens, redirects to dashboard\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nONGOING: TOKEN USAGE\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStep 1: Client makes API requests\n  Client â†’ GET /api/protected-endpoint\n  Headers: X-Session-Token: <session_token>\n  Server â†’ Validates token, processes request\n  Server â†’ Response: { \"success\": true, \"data\": {...} }\nStep 2: Token expires\n  Client â†’ GET /api/protected-endpoint\n  Headers: X-Session-Token: <expired_token>\n  Server â†’ Response: 401 Unauthorized\n  Client: Detects 401, triggers token refresh\nStep 3: Refresh tokens\n  Client â†’ POST /auth/refresh-token\n  Body: { \"refresh_token\": \"...\" }\n  Server â†’ Validates refresh token, generates new tokens\n  Server â†’ Response: { \"success\": true, \"data\": { new_tokens } }\n  Client: Updates stored tokens, retries original request\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nLOGOUT FLOW\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nStep 1: User clicks logout\n  Client â†’ POST /auth/logout\n  Headers: Authorization: Bearer <session_token>\n  Server â†’ Blacklists tokens, revokes all sessions\n  Server â†’ Response: { \"success\": true, \"data\": { revocation_status } }\n  Client: Clears local storage, redirects to login\n\n ```\n\n### Password Reset Flow (Client-Server Communication)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User clicks \"Forgot Password\"\n  â””â”€â–º User navigates to password reset page\nStep 2: User enters email/phone\n  â””â”€â–º Client validates format\nStep 3: Request OTP\n  Client â†’ POST /auth/send-one-time-password\n  Body: { \"user_id\": \"user@example.com\", \"channel\": \"email\" }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Server â†’ Generates OTP, stores in cache (10 min TTL)\n  Server â†’ Sends OTP via email/SMS\n  Server â†’ Response: { \"success\": true, \"message\": \"OTP sent\" }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 4: User receives OTP\n  â””â”€â–º User checks email/SMS, gets 6-digit code\nStep 5: User enters OTP and new password\n  â”œâ”€â–º User enters OTP\n  â”œâ”€â–º User enters new password\n  â””â”€â–º User confirms new password\nStep 6: Reset password\n  Client â†’ POST /auth/forget-password\n  Body: {\n    \"user_id\": \"user@example.com\",\n    \"otp\": \"123456\",\n    \"password\": \"newPassword123\",\n    \"confirm_password\": \"newPassword123\"\n  }\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚                    SERVER SIDE                              â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Server â†’ Verifies OTP\n  Server â†’ Validates passwords match\n  Server â†’ Hashes new password (bcrypt)\n  Server â†’ Updates user password in database\n  Server â†’ Deletes OTP (consume=true)\n  Server â†’ Response: { \"success\": true, \"message\": \"Password updated\" }\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 7: Password reset complete\n  â”œâ”€â–º Show: \"Password reset successfully\"\n  â””â”€â–º Redirect to login page\n\n ```\n\n### Token Lifecycle Flow (Client-Server Communication)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nLOGIN â†’ Token Generation\n  â”œâ”€â–º POST /auth/login-with-password\n  â””â”€â–º Receive: access_token, refresh_token, session_token, session_id\n  â””â”€â–º Store tokens securely\nAPI REQUESTS â†’ Token Usage\n  â”œâ”€â–º Include token in request header\n  â”‚   â”œâ”€â–º X-Session-Token: <session_token> (RECOMMENDED)\n  â”‚   OR\n  â”‚   â””â”€â–º Authorization: Bearer <session_token>\n  â””â”€â–º Server validates token, processes request\nTOKEN EXPIRATION â†’ Automatic Refresh\n  â”œâ”€â–º API request returns 401\n  â”œâ”€â–º Client intercepts 401 error\n  â”œâ”€â–º POST /auth/refresh-token\n  â”‚   â””â”€â–º Body: { \"refresh_token\": \"...\" }\n  â”œâ”€â–º Receive new tokens\n  â”œâ”€â–º Update stored tokens\n  â””â”€â–º Retry original request with new token\nLOGOUT â†’ Token Revocation\n  â”œâ”€â–º POST /auth/logout\n  â”œâ”€â–º Server blacklists all tokens\n  â”œâ”€â–º Server revokes all sessions\n  â””â”€â–º Client clears local storage\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"Validation error details\",\n  \"statusCode\": 400\n}\n\n ```\n\n**401 Unauthorized - Invalid Credentials:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid credentials\",\n  \"error\": \"Email/phone or password is incorrect\",\n  \"statusCode\": 401\n}\n\n ```\n\n**401 Unauthorized - Invalid OTP:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid OTP\",\n  \"error\": \"OTP is incorrect or expired\",\n  \"statusCode\": 401\n}\n\n ```\n\n**404 Not Found - User Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"User not found\",\n  \"error\": \"User with provided email/phone does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - User Already Exists:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"User already exists\",\n  \"error\": \"User with this email/phone already registered\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Token Management\n\n### Frontend Token Usage\n\n**Recommended Approach (Session Token - Fastest & Most Secure):**\n\n1. **Session Token**: Use for all API requests (RECOMMENDED)\n    \n    ``` javascript\n    // Store after login\n    localStorage.setItem('session_token', response.data.session_token);\n    localStorage.setItem('refresh_token', response.data.refresh_token);\n    localStorage.setItem('session_id', response.data.session_id);\n    // Use session_token for API calls (fastest validation)\n    // Option 1: X-Session-Token header (preferred)\n    const headers = {\n      'X-Session-Token': localStorage.getItem('session_token')\n    };\n    // Option 2: Authorization Bearer header (session_token works here too!)\n    const headers = {\n      'Authorization': `Bearer ${localStorage.getItem('session_token')}`\n    };\n    // Decode session token for client-side user info (no API call needed)\n    import jwtDecode from 'jwt-decode';\n    const userInfo = jwtDecode(localStorage.getItem('session_token'));\n    console.log(userInfo.user_profile);  // Full user profile available\n    \n     ```\n    \n2. **Alternative: Access Token** (Still supported)\n    \n    ``` javascript\n    // Store after login\n    localStorage.setItem('access_token', response.data.access_token);\n    // Use in API calls\n    const headers = {\n      'Authorization': `Bearer ${localStorage.getItem('access_token')}`\n    };\n    \n     ```\n    \n3. **Refresh Token**: Store securely and use when tokens expire\n    \n    ``` javascript\n    // Store securely (prefer httpOnly cookie if possible)\n    localStorage.setItem('refresh_token', response.data.refresh_token);\n    // Refresh when session/access token expires\n    async function refreshTokens() {\n      const refreshToken = localStorage.getItem('refresh_token');\n      const response = await fetch('/api/auth/refresh-token', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ refresh_token: refreshToken })\n      });\n      const data = await response.json();\n      // Update all tokens\n      localStorage.setItem('session_token', data.data.session_token);\n      localStorage.setItem('access_token', data.data.access_token);\n      localStorage.setItem('refresh_token', data.data.refresh_token);\n      localStorage.setItem('session_id', data.data.session_id);\n      return data.data;\n    }\n    \n     ```\n    \n4. **Session ID**: Store for logout operations\n    \n    ``` javascript\n    localStorage.setItem('session_id', response.data.session_id);\n    \n     ```\n    \n\n### Token Expiration Handling\n\n**Using Session Token (Recommended):**\n\n``` javascript\n// Intercept API responses to handle token expiration\naxios.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    if (error.response?.status === 401) {\n      // Session token expired, try to refresh\n      try {\n        const newTokens = await refreshTokens();\n        // Retry original request with new session token\n        // You can use either method:\n        error.config.headers['X-Session-Token'] = newTokens.session_token;\n        // OR\n        // error.config.headers['Authorization'] = `Bearer ${newTokens.session_token}`;\n        return axios.request(error.config);\n      } catch (refreshError) {\n        // Refresh failed, redirect to login\n        window.location.href = '/login';\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n// Request interceptor to add session token\naxios.interceptors.request.use(\n  (config) => {\n    const sessionToken = localStorage.getItem('session_token');\n    if (sessionToken) {\n      // Option 1: X-Session-Token header (preferred)\n      config.headers['X-Session-Token'] = sessionToken;\n      // OR\n      // Option 2: Authorization Bearer header (session_token works here too!)\n      // config.headers['Authorization'] = `Bearer ${sessionToken}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n ```\n\n**Using Access Token (Alternative):**\n\n``` javascript\n// Intercept API responses to handle token expiration\naxios.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    if (error.response?.status === 401) {\n      // Access token expired, try to refresh\n      try {\n        const newTokens = await refreshTokens();\n        // Retry original request with new access token\n        error.config.headers.Authorization = `Bearer ${newTokens.access_token}`;\n        return axios.request(error.config);\n      } catch (refreshError) {\n        // Refresh failed, redirect to login\n        window.location.href = '/login';\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n ```\n\n### Security Best Practices\n\n1. **Token Storage**:\n    \n    - **Session Token**: httpOnly cookie (preferred) or secure storage - **RECOMMENDED for API calls**\n        \n    - Access Token: Memory or secure storage (avoid localStorage for sensitive apps)\n        \n    - Refresh Token: httpOnly cookie (preferred) or secure storage\n        \n    - Session ID: Store with tokens\n        \n2. **Token Usage Priority**:\n    \n    - **Primary**: Use `session_token` with `X-Session-Token` header (fastest, most secure)\n        \n    - **Alternative 1**: Use `session_token` with `Authorization: Bearer` header (also works!)\n        \n    - **Alternative 2**: Use `access_token` with `Authorization: Bearer` header (still supported)\n        \n    - **Never**: Use `refresh_token` for API authentication (only for token refresh)\n        \n    \n    **Note**: The `Authorization: Bearer` header accepts both `session_token` and `access_token`.  \n    The server automatically detects the token type and validates accordingly.\n    \n3. **Token Rotation**: Refresh tokens are rotated on each refresh for security\n    \n4. **Token Blacklisting**: Tokens are blacklisted on logout and cannot be reused\n    \n5. **Session Management**: Each login creates a new session with unique session_id\n    \n6. **Client-Side Validation**: Session tokens can be decoded client-side for user info display without API calls\n    \n\n## Best Practices\n\n1. **Use Strong Passwords**: Enforce password complexity requirements\n    \n2. **OTP Expiration**: OTPs expire after 10 minutes for security\n    \n3. **Rate Limiting**: Implement rate limiting on authentication endpoints\n    \n4. **Token Storage**:\n    - Access tokens: Store in memory when possible\n        \n    - Refresh tokens: Use httpOnly cookies for web apps\n        \n    - Never store tokens in localStorage for sensitive applications\n        \n5. **Password Hashing**: Always use bcrypt with appropriate salt rounds (10 rounds)\n    \n6. **Email/Phone Validation**: Validate format before processing\n    \n7. **Error Messages**: Don't reveal if email/phone exists in system\n    \n8. **Token Refresh**: Implement automatic token refresh before expiration\n    \n9. **Session Management**: Track active sessions and allow users to revoke them\n    \n10. **Token Blacklisting**: Tokens are automatically blacklisted on logout\n    \n\n## Environment Variables\n\nConfigure token expiration times:\n\n``` bash\n# Token Expiration Times (in minutes)\nACCESS_TOKEN_EXPIRY_MINUTES=60      # Access token lifetime (default: 60 minutes = 1 hour)\nSESSION_TOKEN_EXPIRY_MINUTES=10080  # Session token lifetime (default: 10080 minutes = 7 days)\nREFRESH_TOKEN_EXPIRY_MINUTES=43200  # Refresh token lifetime (default: 43200 minutes = 30 days)\n# JWT Configuration\nJWT_SECRET_KEY=your-secret-key-here  # Required: Secret key for JWT signing\nJWT_ALGORITHM=HS256                  # Optional: JWT algorithm (default: HS256)\n# Password Hashing\nBCRYPT_SALT_ROUNDS=10                # Optional: Bcrypt salt rounds (default: 10)\n\n ```\n\n## Architecture\n\n### Stateless Authentication\n\n- No database storage for sessions\n    \n- All session info embedded in JWT tokens\n    \n- Token blacklisting via cache (Redis or in-memory)\n    \n- Fast and scalable\n    \n\n### Token Blacklisting\n\n- Tokens blacklisted in cache with TTL matching token expiration\n    \n- Automatic cleanup when tokens expire\n    \n- Supports Redis for distributed systems\n    \n- Falls back to in-memory cache if Redis unavailable\n    \n\n### Performance Optimizations\n\n- Lightweight access tokens (minimal payload - only essential fields)\n    \n- Session tokens with full user profile (no database lookup needed)\n    \n- Non-blocking sign-in updates\n    \n- Optimized blacklist check order\n    \n- Fast token generation and validation\n    \n- JTI-based access token blacklisting (efficient)\n    \n- User-level blacklist for refresh tokens and sessions\n    \n- Token validation priority: X-Session-Token > Authorization Bearer > OAuth2 > query param\n    \n\n### Token Blacklisting Strategy\n\n- **Access Tokens**: Blacklisted by JTI (JWT ID) for efficiency\n    \n- **Refresh Tokens**: User-level blacklist (revokes all refresh tokens for user)\n    \n- **Sessions**: User-level blacklist (revokes all sessions for user - complete logout)\n    \n- **Automatic Expiration**: Blacklist entries expire with token expiration times\n    \n- **Cache Storage**: Uses Redis (if available) or in-memory cache\n    \n- **Logout Behavior**: Complete logout from all devices (all sessions revoked)\n    \n\n---\n\n**Last Updated**: January 2025\n\n## Recent Updates\n\n### Token System Improvements\n\n- âœ… Access token expiration updated to 60 minutes (1 hour)\n    \n- âœ… Session token contains full user profile (no database lookup needed)\n    \n- âœ… JTI-based access token blacklisting for efficiency\n    \n- âœ… Complete logout from all devices (all sessions revoked)\n    \n- âœ… User-level blacklist for refresh tokens and sessions\n    \n- âœ… Token rotation on refresh (all tokens regenerated)\n    \n\n### New Endpoints\n\n- âœ… `GET/POST /auth/token-info` - Get token information and configuration\n    \n\n### Security Enhancements\n\n- âœ… Complete logout from all devices\n    \n- âœ… All refresh tokens revoked on logout\n    \n- âœ… Access token blacklisted by JTI\n    \n- âœ… Token rotation on refresh for security\n    \n- âœ… User-level blacklist clearing on login (allows re-login after logout)",
			"auth": {
				"type": "bearer",
				"bearer": [
					{
						"key": "token",
						"value": "{{session_token}}",
						"type": "string"
					}
				]
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"const response = pm.response.json();",
							"",
							"// Check if the response succeeded",
							"if (response.success && response.data) {",
							"    // Access Token",
							"    if (response.data.access_token) {",
							"        pm.environment.set(\"access_token\", response.data.access_token);",
							"        console.log(\"Access token updated:\", response.data.access_token);",
							"    }",
							"",
							"    // Refresh Token",
							"    if (response.data.refresh_token) {",
							"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
							"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
							"    }",
							"",
							"    // Session ID",
							"    if (response.data.session_id) {",
							"        pm.environment.set(\"session_id\", response.data.session_id);",
							"        console.log(\"Session ID updated:\", response.data.session_id);",
							"    }",
							"",
							"    // Session Token",
							"    if (response.data.session_token) {",
							"        pm.environment.set(\"session_token\", response.data.session_token);",
							"        console.log(\"Session token updated:\", response.data.session_token);",
							"    }",
							"",
							"    // Token Type",
							"    if (response.data.token_type) {",
							"        pm.environment.set(\"token_type\", response.data.token_type);",
							"        console.log(\"Token type updated:\", response.data.token_type);",
							"    }",
							"",
							"} else {",
							"    console.log(\"No token found in response:\", response);",
							"}",
							""
						]
					}
				}
			]
		},
		{
			"name": "Profile & Settings",
			"item": [
				{
					"name": "profile",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "get-user-profile",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile/156424ef-5e88-464d-92bd-5a99a7f24224?page=1&page_size=1",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile",
								"156424ef-5e88-464d-92bd-5a99a7f24224"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "page_size",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "update-profile",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-profile",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-profile"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-profile-picture",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "/home/mrdas/Downloads/6f790e8d-4ec9-4222-818b-f63a983e5073.jpeg"
								}
							]
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-profile-picture",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-profile-picture"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-email",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/change-email",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"change-email"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-phone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/change-email",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"change-email"
							]
						}
					},
					"response": []
				},
				{
					"name": "profile-accessibility",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"profile_accessibility\": \"private\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-accessibility",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-accessibility"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-theme",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"theme\": \"light\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-theme",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-theme"
							]
						}
					},
					"response": []
				},
				{
					"name": "profile-language",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"en\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-language"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-timezone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"timezone\": \"America/New_York\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-timezone",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-timezone"
							]
						}
					},
					"response": []
				},
				{
					"name": "deactivate-account",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"en\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-language"
							]
						}
					},
					"response": []
				},
				{
					"name": "delete-account",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"en\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-language"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Profile Router\n\n> **Complete Documentation for User Profile Management Endpoints** \n  \n\nThis router handles all user profile operations including viewing, updating profile information, managing profile pictures, changing email/phone, updating settings, and account management.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    - [Profile System](#profile-system)\n        \n    - [Permissions](#permissions)\n        \n- [Endpoints](#endpoints)\n    - [Get User Profile](#get-user-profile)\n        \n    - [Get User Profile by ID](#get-user-profile-by-id)\n        \n    - [Update Profile Picture](#update-profile-picture)\n        \n    - [Update Profile](#update-profile)\n        \n    - [Profile Accessibility](#profile-accessibility)\n        \n    - [Profile Language](#profile-language)\n        \n    - [Change Email](#change-email)\n        \n    - [Change Phone](#change-phone)\n        \n    - [Send Phone OTP](#send-phone-otp)\n        \n    - [Update Theme](#update-theme)\n        \n    - [Update Timezone](#update-timezone)\n        \n    - [Get Settings](#get-settings)\n        \n    - [Deactivate Account](#deactivate-account)\n        \n    - [Delete Account](#delete-account)\n        \n- [User Model](#user-model)\n    \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n- [Best Practices](#best-practices)\n    \n- [Client-Side Implementation](#client-side-implementation)\n    \n\n## Overview\n\nThe Profile router provides comprehensive user profile management functionality including:\n\n- **Profile Viewing**: Get current user profile or view other users' profiles\n    \n- **Profile Updates**: Update personal information, bio, and preferences\n    \n- **Profile Picture**: Upload and update profile pictures via Google Cloud Storage\n    \n- **Contact Management**: Change email and phone numbers with OTP verification\n    \n- **Settings Management**: Update theme, language, timezone, and accessibility settings\n    \n- **Account Management**: Deactivate or delete user accounts\n    \n\n**Base Path:** `/{MODE}/settings`\n\n**Authentication:** All endpoints require authentication via token (access_token or session_token)\n\n### Profile System\n\nThe profile system provides a comprehensive user management interface:\n\n1. **Profile Data**\n    \n    - Personal information (name, email, phone, bio, etc.)\n        \n    - Profile picture URL (stored in Google Cloud Storage)\n        \n    - User preferences (theme, language, timezone)\n        \n    - Verification status (email, phone)\n        \n    - Account status (active, verified, protected)\n        \n2. **Profile Updates**\n    \n    - Partial updates supported (only provided fields are updated)\n        \n    - Protected fields (user_id, email/phone) cannot be changed directly\n        \n    - Email/phone changes require OTP verification\n        \n    - Automatic timestamp updates (`last_updated`)\n        \n3. **File Uploads**\n    \n    - Profile pictures uploaded to Google Cloud Storage\n        \n    - Automatic file naming with user_id and UUID\n        \n    - Support for various image formats\n        \n    - Public URL returned for frontend use\n        \n\n### Permissions\n\nProfile endpoints use permission-based access control:\n\n- **`view_profile`**: Required for viewing own profile\n    \n- **`view_user`**: Required for viewing other users' profiles\n    \n- **`edit_profile`**: Required for all profile update operations\n    \n\n**Permission Middleware:**  \nAll endpoints use `check_permission()` middleware to validate user permissions before processing requests.\n\n## Endpoints\n\n### Get User Profile\n\n**Endpoint:** `GET /{MODE}/settings/profile`\n\n**Description:** Get the current authenticated user's profile information.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_profile`\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile fetched successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"email\": \"john.doe@example.com\",\n    \"phone_number\": {\n      \"phone\": \"+1234567890\"\n    },\n    \"profile_picture_url\": \"https://storage.googleapis.com/...\",\n    \"bio\": \"Software developer\",\n    \"country\": \"US\",\n    \"gender\": \"male\",\n    \"theme\": \"light\",\n    \"language\": \"en\",\n    \"profile_accessibility\": \"public\",\n    \"timezone\": \"America/New_York\",\n    \"is_email_verified\": true,\n    \"is_phone_verified\": true,\n    \"is_active\": true,\n    \"is_verified\": true,\n    \"status\": \"ACTIVE\",\n    \"created_at\": \"2025-01-15T10:30:00Z\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Client prepares request\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/settings/profile\nStep 2: Client sends request\n  GET /{MODE}/settings/profile\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display profile data\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Not Found (404): Show profile not found error\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_profile\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\nStep 3: Database query\n  â”œâ”€â–º Query user profile by user_id from token\n  â”œâ”€â–º Fetch all user fields from database\n  â””â”€â–º Serialize datetime fields to ISO format\nStep 4: Response preparation\n  â”œâ”€â–º Build User model from database result\n  â”œâ”€â–º Serialize data (convert datetime objects)\n  â””â”€â–º Return SUCCESS response with profile data\nStep 5: Error handling\n  â”œâ”€â–º Profile not found: Return 404 with error details\n  â”œâ”€â–º Database error: Log error, return 500\n  â””â”€â–º Permission error: Return 403 with error details\n\n ```\n\n**Error Responses:**\n\n``` json\n// 404 - Profile Not Found\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Profile not found\",\n  \"error\": {\n    \"code\": \"PROFILE_NOT_FOUND\",\n    \"details\": {\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  }\n}\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_profile\"\n    }\n  }\n}\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Error processing profile request\",\n  \"error\": {\n    \"code\": \"PROFILE_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  }\n}\n\n ```\n\n---\n\n### Get User Profile by ID\n\n**Endpoint:** `GET /{MODE}/settings/profile/{user_id}`\n\n**Description:** Get a specific user's profile by user_id. Requires `view_user` permission.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_user`\n\n**Path Parameters:**\n\n- `user_id` (string, required): The UUID of the user whose profile to retrieve\n    \n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile fetched successfully\",\n  \"data\": {\n    \"user_id\": \"b3dgb6gd-6074-5b64-b1b9-7e3e361bg9ge\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Smith\",\n    \"email\": \"jane.smith@example.com\",\n    \"profile_picture_url\": \"https://storage.googleapis.com/...\",\n    \"bio\": \"Designer\",\n    \"profile_accessibility\": \"public\",\n    \"is_active\": true,\n    \"is_verified\": true\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Client prepares request\n  â”œâ”€â–º User navigates to another user's profile page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Get target user_id from route/URL\n  â””â”€â–º Prepare GET request to /{MODE}/settings/profile/{user_id}\nStep 2: Client sends request\n  GET /{MODE}/settings/profile/{user_id}\n  Headers:\n    Authorization: Bearer <token>\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display user profile\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Not Found (404): Show user not found error\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user_id from path parameters\n  â””â”€â–º Extract current user from token\nStep 2: Permission check\n  â”œâ”€â–º Check if current user has \"view_user\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\nStep 3: Database query\n  â”œâ”€â–º Query user profile by target user_id\n  â”œâ”€â–º Fetch all user fields from database\n  â””â”€â–º Serialize datetime fields\nStep 4: Response preparation\n  â”œâ”€â–º Build User model from database result\n  â”œâ”€â–º Serialize data\n  â””â”€â–º Return SUCCESS response with profile data\nStep 5: Error handling\n  â”œâ”€â–º User not found: Return 404\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Server error: Log and return 500\n\n ```\n\n---\n\n### Update Profile Picture\n\n**Endpoint:** `POST /{MODE}/settings/update-profile-picture`\n\n**Description:** Upload and update the user's profile picture. The file is uploaded to Google Cloud Storage and the public URL is stored in the database.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request:**\n\n```\nPOST /{MODE}/settings/update-profile-picture\nContent-Type: multipart/form-data\nfile: <binary image data>\n\n ```\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\nContent-Type: multipart/form-data\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile picture updated successfully\",\n  \"data\": {\n    \"message\": \"Profile picture updated successfully\",\n    \"profile_picture_url\": \"https://storage.googleapis.com/bucket/media/users/johndoe-user_id_a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd-|-f533589d-48d3-4b67-9430-c0b4793ac13e.jpg\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User selects image\n  â”œâ”€â–º User clicks \"Change Profile Picture\"\n  â”œâ”€â–º File picker opens (accepts image/*)\n  â””â”€â–º User selects image file\nStep 2: Client validates image\n  â”œâ”€â–º Check file size (recommended: < 5MB)\n  â”œâ”€â–º Check file type (jpg, png, gif, webp)\n  â””â”€â–º Optionally: Preview image before upload\nStep 3: Client prepares request\n  â”œâ”€â–º Create FormData object\n  â”œâ”€â–º Append image file to FormData\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with multipart/form-data\nStep 4: Client sends request\n  POST /{MODE}/settings/update-profile-picture\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: multipart/form-data\n  Body:\n    file: <File object>\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI with new profile picture URL\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message, keep old picture\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â””â”€â–º Check permission: \"edit_profile\"\nStep 2: File processing\n  â”œâ”€â–º Read file data from request\n  â”œâ”€â–º Extract file extension\n  â”œâ”€â–º Determine content type\n  â””â”€â–º Generate unique object key: {username}-user_id_{user_id}-|-{uuid}.{ext}\nStep 3: Upload to Google Cloud Storage\n  â”œâ”€â–º Upload file to \"media/users\" folder\n  â”œâ”€â–º Set content type\n  â”œâ”€â–º Make file publicly accessible\n  â””â”€â–º Get public URL\nStep 4: Database update\n  â”œâ”€â–º Update user.profile_picture_url with new URL\n  â”œâ”€â–º Update user.last_updated timestamp\n  â””â”€â–º Return updated user_id\nStep 5: Response preparation\n  â”œâ”€â–º Build success response with profile_picture_url\n  â””â”€â–º Return SUCCESS response\nStep 6: Error handling\n  â”œâ”€â–º Upload failed: Return 500 with error details\n  â”œâ”€â–º Database update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n**Client-Side Implementation Example:**\n\n``` javascript\n// Update Profile Picture\nasync function updateProfilePicture(file) {\n  try {\n    // Validate file\n    if (!file || !file.type.startsWith('image/')) {\n      throw new Error('Please select a valid image file');\n    }\n    if (file.size > 5 * 1024 * 1024) { // 5MB limit\n      throw new Error('Image size must be less than 5MB');\n    }\n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    // Get token from storage\n    const token = localStorage.getItem('access_token') || \n                 localStorage.getItem('session_token');\n    // Send request\n    const response = await fetch('/api/v1/settings/update-profile-picture', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      body: formData\n    });\n    const data = await response.json();\n    if (data.success) {\n      // Update UI with new profile picture\n      document.getElementById('profile-picture').src = data.data.profile_picture_url;\n      showNotification('Profile picture updated successfully');\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile picture');\n    }\n  } catch (error) {\n    console.error('Error updating profile picture:', error);\n    showError(error.message);\n  }\n}\n// HTML Example\n  type=\"file\" \n  accept=\"image/*\" \n  onChange={(e) => updateProfilePicture(e.target.files[0])}\n/>\n\n ```\n\n---\n\n### Update Profile\n\n**Endpoint:** `POST /{MODE}/settings/update-profile`\n\n**Description:** Partially update user profile fields. Only provided fields will be updated. Protected fields (user_id, email, phone) cannot be updated through this endpoint.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"first_name\": \"John\",\n  \"last_name\": \"Doe\",\n  \"bio\": \"Software developer passionate about web technologies\",\n  \"country\": \"US\",\n  \"gender\": \"male\",\n  \"dob\": \"1990-01-15T00:00:00Z\",\n  \"portfolio_url\": \"https://johndoe.dev\"\n}\n\n ```\n\n**Note:** Only include fields you want to update. Omitted fields will remain unchanged.\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"bio\": \"Software developer passionate about web technologies\",\n    \"country\": \"US\",\n    \"gender\": \"male\",\n    \"dob\": \"1990-01-15T00:00:00Z\",\n    \"portfolio_url\": \"https://johndoe.dev\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User edits profile form\n  â”œâ”€â–º User fills in profile fields (name, bio, country, etc.)\n  â”œâ”€â–º Client validates form fields\n  â””â”€â–º User clicks \"Save\" button\nStep 2: Client prepares request\n  â”œâ”€â–º Collect form data (only changed fields)\n  â”œâ”€â–º Remove protected fields (user_id, email, phone)\n  â”œâ”€â–º Convert dates to ISO format\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with JSON body\nStep 3: Client sends request\n  POST /{MODE}/settings/update-profile\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/json\n  Body:\n    {\n      \"first_name\": \"John\",\n      \"last_name\": \"Doe\",\n      \"bio\": \"...\",\n      ...\n    }\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Update UI with new profile data\n  â”œâ”€â–º Bad Request (400): Show validation errors\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body (User model)\n  â””â”€â–º Check permission: \"edit_profile\"\nStep 2: Data processing\n  â”œâ”€â–º Extract only provided fields (exclude_unset=True)\n  â”œâ”€â–º Remove protected fields:\n  â”‚   â”œâ”€â–º user_id (always protected)\n  â”‚   â”œâ”€â–º email (if user has email)\n  â”‚   â””â”€â–º phone (if user has phone)\n  â”œâ”€â–º Validate no protected fields in update\n  â””â”€â–º Check if any fields remain to update\nStep 3: Build SQL update query\n  â”œâ”€â–º Create SET clauses for each field\n  â”œâ”€â–º Handle phone_number as JSONB if provided\n  â”œâ”€â–º Add last_updated = NOW()\n  â””â”€â–º Prepare parameterized query\nStep 4: Database update\n  â”œâ”€â–º Execute UPDATE query\n  â”œâ”€â–º Verify update succeeded (check RETURNING)\n  â””â”€â–º Fetch updated user data\nStep 5: Response preparation\n  â”œâ”€â–º Build User model from updated data\n  â”œâ”€â–º Serialize data (convert datetime objects)\n  â””â”€â–º Return SUCCESS response with updated profile\nStep 6: Error handling\n  â”œâ”€â–º No fields to update: Return 400\n  â”œâ”€â–º Protected field attempted: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n**Protected Fields:**\n\n- `user_id`: Always protected (cannot be changed)\n    \n- `email`: Protected if user has email (use `/change-email` endpoint)\n    \n- `phone`: Protected if user has phone (use `/change-phone` endpoint)\n    \n\n**Client-Side Implementation Example:**\n\n``` javascript\n// Update Profile\nasync function updateProfile(profileData) {\n  try {\n    // Remove protected fields\n    const { user_id, email, phone_number, ...updateData } = profileData;\n    // Get token\n    const token = localStorage.getItem('access_token') || \n                 localStorage.getItem('session_token');\n    // Send request\n    const response = await fetch('/api/v1/settings/update-profile', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(updateData)\n    });\n    const data = await response.json();\n    if (data.success) {\n      // Update UI with new profile data\n      updateProfileDisplay(data.data);\n      showNotification('Profile updated successfully');\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile');\n    }\n  } catch (error) {\n    console.error('Error updating profile:', error);\n    showError(error.message);\n  }\n}\n\n ```\n\n---\n\n### Profile Accessibility\n\n**Endpoint:** `POST /{MODE}/settings/profile-accessibility`\n\n**Description:** Update user profile accessibility setting (public, private, friends).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"profile_accessibility\": \"public\"\n}\n\n ```\n\n**Valid Values:**\n\n- `\"public\"`: Profile visible to everyone\n    \n- `\"private\"`: Profile visible only to user\n    \n- `\"friends\"`: Profile visible only to friends\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile accessibility update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"profile_accessibility\": \"public\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n\n ```\n\n---\n\n### Profile Language\n\n**Endpoint:** `POST /{MODE}/settings/profile-language`\n\n**Description:** Update user's preferred language setting.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"language\": \"en\"\n}\n\n ```\n\n**Valid Values:**\n\n- `\"en\"`: English\n    \n- `\"es\"`: Spanish\n    \n- `\"fr\"`: French\n    \n- (Other language codes as supported)\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile language update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"language\": \"en\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n\n ```\n\n---\n\n### Change Email\n\n**Endpoint:** `POST /{MODE}/settings/change-email`\n\n**Description:** Change user's email address. Requires OTP verification sent to the new email address.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Prerequisites:**\n\n1. User must first request OTP to new email via `/auth/send-otp` endpoint\n    \n2. OTP must be sent to the new email address (channel: \"email\")\n    \n\n**Request Body:**\n\n``` json\n{\n  \"new_email\": \"newemail@example.com\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Email updated and verified successfully\",\n  \"data\": {\n    \"message\": \"Email updated and verified successfully\",\n    \"user\": {\n      \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n      \"email\": \"newemail@example.com\",\n      \"is_email_verified\": true,\n      \"email_verified_at\": \"2025-01-28T15:51:55Z\"\n    }\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User initiates email change\n  â”œâ”€â–º User enters new email address\n  â”œâ”€â–º User clicks \"Send OTP\" button\n  â””â”€â–º Client validates email format\nStep 2: Request OTP to new email\n  POST /{MODE}/auth/send-otp\n  Body: {\n    \"user_id\": \"newemail@example.com\",\n    \"channel\": \"email\"\n  }\n  â”œâ”€â–º Server sends OTP to new email\n  â””â”€â–º Client shows \"OTP sent\" message\nStep 3: User enters OTP\n  â”œâ”€â–º User receives OTP via email\n  â”œâ”€â–º User enters OTP in form\n  â””â”€â–º User clicks \"Change Email\" button\nStep 4: Client sends change email request\n  POST /{MODE}/settings/change-email\n  Headers:\n    Authorization: Bearer <token>\n  Body: {\n    \"new_email\": \"newemail@example.com\",\n    \"otp\": \"123456\"\n  }\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI, show success message\n  â”œâ”€â–º Bad Request (400): Show error (invalid OTP, email exists)\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body\n  â””â”€â–º Check permission: \"edit_profile\"\nStep 2: OTP verification\n  â”œâ”€â–º Verify OTP for new_email (delete_after_verify=False)\n  â”œâ”€â–º If invalid: Return 400 with \"PROFILE_INVALID_OTP\"\n  â””â”€â–º OTP must be sent to new_email (not old email)\nStep 3: Email uniqueness check\n  â”œâ”€â–º Check if new_email already exists for another user\n  â”œâ”€â–º If exists: Return 400 with \"EMAIL_ALREADY_EXISTS\"\n  â””â”€â–º Allow same email if it's the current user\nStep 4: Database update\n  â”œâ”€â–º Update user.email = new_email\n  â”œâ”€â–º Set is_email_verified = TRUE\n  â”œâ”€â–º Set email_verified_at = NOW()\n  â”œâ”€â–º Update last_updated = NOW()\n  â””â”€â–º Verify update succeeded\nStep 5: Cleanup\n  â”œâ”€â–º Delete OTP from cache (delete_after_verify=True)\n  â””â”€â–º Prepare response with updated user data\nStep 6: Response preparation\n  â”œâ”€â–º Build success response\n  â”œâ”€â–º Include updated email and verification status\n  â””â”€â–º Return SUCCESS response\nStep 7: Error handling\n  â”œâ”€â–º Invalid OTP: Return 400\n  â”œâ”€â–º Email exists: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n**Important Notes:**\n\n- OTP must be sent to the **new email address**, not the old one\n    \n- Email change automatically verifies the new email (`is_email_verified = true`)\n    \n- Old email is replaced; user cannot revert without going through the process again\n    \n\n---\n\n### Change Phone\n\n**Endpoint:** `POST /{MODE}/settings/change-phone`\n\n**Description:** Change user's phone number. Requires OTP verification sent to the new phone number.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Prerequisites:**\n\n1. User must first request OTP to new phone via `/settings/send-phone-otp` endpoint\n    \n2. OTP must be sent to the new phone number (channel: \"sms\" or \"whatsapp\")\n    \n\n**Request Body:**\n\n``` json\n{\n  \"new_phone\": \"+1234567890\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Phone number updated and verified successfully\",\n  \"data\": {\n    \"user\": {\n      \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n      \"phone_number\": {\n        \"phone\": \"1234567890\"\n      },\n      \"is_phone_verified\": true,\n      \"phone_number_verified_at\": \"2025-01-28T15:51:55Z\"\n    }\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User initiates phone change\n  â”œâ”€â–º User enters new phone number\n  â”œâ”€â–º User selects channel (SMS or WhatsApp)\n  â”œâ”€â–º User clicks \"Send OTP\" button\n  â””â”€â–º Client validates phone format\nStep 2: Request OTP to new phone\n  POST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n  Headers:\n    Authorization: Bearer <token>\n  â”œâ”€â–º Server sends OTP to new phone\n  â””â”€â–º Client shows \"OTP sent\" message\nStep 3: User enters OTP\n  â”œâ”€â–º User receives OTP via SMS/WhatsApp\n  â”œâ”€â–º User enters OTP in form\n  â””â”€â–º User clicks \"Change Phone\" button\nStep 4: Client sends change phone request\n  POST /{MODE}/settings/change-phone\n  Headers:\n    Authorization: Bearer <token>\n  Body: {\n    \"new_phone\": \"+1234567890\",\n    \"otp\": \"123456\"\n  }\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI, show success message\n  â”œâ”€â–º Bad Request (400): Show error (invalid OTP, phone exists, invalid format)\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body\n  â”œâ”€â–º Validate phone format (E.164 format)\n  â””â”€â–º Check permission: \"edit_profile\"\nStep 2: OTP verification\n  â”œâ”€â–º Verify OTP for new_phone (delete_after_verify=False)\n  â”œâ”€â–º If invalid: Return 400 with \"PROFILE_INVALID_OTP\"\n  â””â”€â–º OTP must be sent to new_phone (not old phone)\nStep 3: Phone uniqueness check\n  â”œâ”€â–º Clean phone number (remove +)\n  â”œâ”€â–º Check if phone already exists for another user\n  â”œâ”€â–º Query: phone_number->>'phone' = cleaned_phone\n  â”œâ”€â–º If exists: Return 400 with \"EMAIL_ALREADY_EXISTS\" (reused error code)\n  â””â”€â–º Allow same phone if it's the current user\nStep 4: Database update\n  â”œâ”€â–º Format phone as JSON: {\"phone\": cleaned_phone}\n  â”œâ”€â–º Update user.phone_number = JSONB\n  â”œâ”€â–º Set is_phone_verified = TRUE\n  â”œâ”€â–º Set phone_number_verified_at = NOW()\n  â”œâ”€â–º Update last_updated = NOW()\n  â””â”€â–º Verify update succeeded\nStep 5: Cleanup\n  â”œâ”€â–º Delete OTP from cache (delete_after_verify=True)\n  â””â”€â–º Prepare response with updated user data\nStep 6: Response preparation\n  â”œâ”€â–º Build success response\n  â”œâ”€â–º Include updated phone_number and verification status\n  â””â”€â–º Return SUCCESS response\nStep 7: Error handling\n  â”œâ”€â–º Invalid phone format: Return 400\n  â”œâ”€â–º Invalid OTP: Return 400\n  â”œâ”€â–º Phone exists: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n**Phone Format:**\n\n- Must be in E.164 format: `+[country code][number]`\n    \n- Example: `+1234567890`, `+441234567890`\n    \n- The `+` sign is optional but recommended\n    \n\n---\n\n### Send Phone OTP\n\n**Endpoint:** `POST /{MODE}/settings/send-phone-otp`\n\n**Description:** Send OTP to a phone number via SMS or WhatsApp. Used for phone number verification during phone change.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n\n- `phone` (string, required): Phone number in E.164 format\n    \n- `channel` (string, required): Delivery channel - `\"sms\"` or `\"whatsapp\"`\n    \n\n**Request:**\n\n```\nPOST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n\n ```\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"OTP sent successfully\",\n  \"data\": {\n    \"message\": \"OTP sent successfully\"\n  }\n}\n\n ```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User enters phone number\n  â”œâ”€â–º User enters new phone number\n  â”œâ”€â–º User selects channel (SMS or WhatsApp)\n  â””â”€â–º Client validates phone format\nStep 2: Client sends request\n  POST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n  Headers:\n    Authorization: Bearer <token>\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Show \"OTP sent\" message, enable OTP input\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract query parameters (phone, channel)\n  â”œâ”€â–º Validate phone format (E.164)\n  â”œâ”€â–º Validate channel (sms or whatsapp)\n  â””â”€â–º Check permission: \"edit_profile\"\nStep 2: Generate and store OTP\n  â”œâ”€â–º Generate 6-digit OTP\n  â”œâ”€â–º Store OTP in cache with TTL (600 seconds = 10 minutes)\n  â”œâ”€â–º Key: phone number\n  â””â”€â–º Value: OTP code\nStep 3: Send OTP\n  â”œâ”€â–º If channel = \"sms\": Send SMS via SMS service\n  â”œâ”€â–º If channel = \"whatsapp\": Send WhatsApp message\n  â””â”€â–º Message includes OTP code\nStep 4: Response preparation\n  â”œâ”€â–º Build success response\n  â””â”€â–º Return SUCCESS response\nStep 5: Error handling\n  â”œâ”€â–º Invalid phone format: Return 400\n  â”œâ”€â–º Invalid channel: Return 400\n  â”œâ”€â–º OTP generation failed: Return 500\n  â”œâ”€â–º SMS/WhatsApp send failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n---\n\n### Update Theme\n\n**Endpoint:** `POST /{MODE}/settings/update-theme`\n\n**Description:** Update user's theme preference (light or dark).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n\n- `theme` (string, required): Theme value - `\"light\"` or `\"dark\"`\n    \n\n**Request:**\n\n```\nPOST /{MODE}/settings/update-theme?theme=dark\n\n ```\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Theme updated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"theme\": \"dark\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n\n ```\n\n---\n\n### Update Timezone\n\n**Endpoint:** `POST /{MODE}/settings/update-timezone`\n\n**Description:** Update user's timezone preference.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n\n- `timezone` (string, required): Timezone identifier (e.g., `\"America/New_York\"`, `\"Europe/London\"`)\n    \n\n**Request:**\n\n```\nPOST /{MODE}/settings/update-timezone?timezone=America/New_York\n\n ```\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Timezone updated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"timezone\": \"America/New_York\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n\n ```\n\n---\n\n### Get Settings\n\n**Endpoint:** `GET /{MODE}/settings/get-settings`\n\n**Description:** Get user settings including theme, language, timezone, verification status, and account status.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_profile`\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User settings retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"theme\": \"light\",\n    \"language\": \"en\",\n    \"profile_accessibility\": \"public\",\n    \"timezone\": \"America/New_York\",\n    \"country\": \"US\",\n    \"bio\": \"Software developer\",\n    \"is_email_verified\": true,\n    \"is_phone_verified\": true,\n    \"is_active\": true,\n    \"is_verified\": true,\n    \"status\": \"ACTIVE\"\n  }\n}\n\n ```\n\n---\n\n### Deactivate Account\n\n**Endpoint:** `POST /{MODE}/settings/deactivate-account`\n\n**Description:** Deactivate user account. Sets `is_active = false` and `status = 'INACTIVE'`. Account data is preserved.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Account deactivated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"is_active\": false,\n    \"status\": \"INACTIVE\"\n  }\n}\n\n ```\n\n**Note:** Deactivated accounts cannot log in. To reactivate, contact support or use account recovery process.\n\n---\n\n### Delete Account\n\n**Endpoint:** `POST /{MODE}/settings/delete-account`\n\n**Description:** Delete user account. Requires confirmation. Sets `is_active = false` and `status = 'INACTIVE'`. Account data is preserved (soft delete).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n\n- `confirm` (boolean, required): Must be `true` to confirm deletion\n    \n\n**Request:**\n\n```\nPOST /{MODE}/settings/delete-account?confirm=true\n\n ```\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Account deactivated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"is_active\": false\n  }\n}\n\n ```\n\n**Note:**\n\n- Currently performs soft delete (same as deactivate)\n    \n- Account data is preserved in database\n    \n- User cannot log in after deletion\n    \n- For permanent deletion, contact support\n    \n\n---\n\n## User Model\n\nThe User model contains all user profile information:\n\n``` typescript\ninterface User {\n  // Primary identifier\n  user_id: string;\n  // Basic information\n  first_name?: string;\n  last_name?: string;\n  email?: string;\n  phone_number?: {\n    phone: string;\n  };\n  country?: string;\n  gender?: string;\n  dob?: string; // ISO 8601 datetime\n  profile_picture_url?: string;\n  bio?: string;\n  portfolio_url?: string;\n  user_name?: string;\n  // Preferences\n  theme?: \"light\" | \"dark\";\n  language?: string; // Language code (en, es, fr, etc.)\n  profile_accessibility?: \"public\" | \"private\" | \"friends\";\n  timezone?: string; // IANA timezone (America/New_York, etc.)\n  // Verification status\n  is_email_verified?: boolean;\n  is_phone_verified?: boolean;\n  email_verified_at?: string; // ISO 8601 datetime\n  phone_number_verified_at?: string; // ISO 8601 datetime\n  // Account status\n  is_active?: boolean;\n  is_verified?: boolean;\n  status?: \"ACTIVE\" | \"INACTIVE\" | \"SUSPENDED\" | \"DELETED\";\n  // Timestamps\n  created_at?: string; // ISO 8601 datetime\n  last_updated?: string; // ISO 8601 datetime\n  last_sign_in_at?: string; // ISO 8601 datetime\n}\n\n ```\n\n---\n\n## Workflows\n\n### Complete Profile Update Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    PROFILE UPDATE WORKFLOW                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User Authentication\n  â”œâ”€â–º User logs in (via /auth/login-with-password or /auth/login-with-otp)\n  â”œâ”€â–º Client receives tokens (access_token, session_token, refresh_token)\n  â””â”€â–º Client stores tokens securely\nStep 2: View Profile\n  â”œâ”€â–º Client requests profile: GET /{MODE}/settings/profile\n  â”œâ”€â–º Server validates token and permissions\n  â”œâ”€â–º Server returns user profile data\n  â””â”€â–º Client displays profile in UI\nStep 3: Update Profile Information\n  â”œâ”€â–º User edits profile fields (name, bio, country, etc.)\n  â”œâ”€â–º Client validates form data\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/update-profile\n  â”œâ”€â–º Server validates token, permissions, and data\n  â”œâ”€â–º Server updates database\n  â””â”€â–º Server returns updated profile\nStep 4: Update Profile Picture\n  â”œâ”€â–º User selects new profile picture\n  â”œâ”€â–º Client validates image file\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/update-profile-picture (multipart/form-data)\n  â”œâ”€â–º Server uploads to Google Cloud Storage\n  â”œâ”€â–º Server updates database with new URL\n  â””â”€â–º Server returns new profile_picture_url\nStep 5: Change Email (if needed)\n  â”œâ”€â–º User enters new email\n  â”œâ”€â–º Client requests OTP: POST /{MODE}/auth/send-otp (to new email)\n  â”œâ”€â–º User receives OTP via email\n  â”œâ”€â–º User enters OTP\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/change-email\n  â”œâ”€â–º Server verifies OTP and updates email\n  â””â”€â–º Server returns updated user data\nStep 6: Change Phone (if needed)\n  â”œâ”€â–º User enters new phone\n  â”œâ”€â–º Client requests OTP: POST /{MODE}/settings/send-phone-otp\n  â”œâ”€â–º User receives OTP via SMS/WhatsApp\n  â”œâ”€â–º User enters OTP\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/change-phone\n  â”œâ”€â–º Server verifies OTP and updates phone\n  â””â”€â–º Server returns updated user data\nStep 7: Update Settings\n  â”œâ”€â–º User updates theme: POST /{MODE}/settings/update-theme\n  â”œâ”€â–º User updates language: POST /{MODE}/settings/profile-language\n  â”œâ”€â–º User updates timezone: POST /{MODE}/settings/update-timezone\n  â”œâ”€â–º User updates accessibility: POST /{MODE}/settings/profile-accessibility\n  â””â”€â–º Each update returns updated user data\n\n ```\n\n### Profile Picture Upload Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              PROFILE PICTURE UPLOAD WORKFLOW                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 1. User selects image file\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  Validation  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 2. Validate file (type, size)\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  FormData    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 3. Create FormData with file\n       â”‚    Add Authorization header\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Validation  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 4. Validate token & permission\n       â”‚    Read file data\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Generate    â”‚\nâ”‚  Object Key  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 5. Generate: {username}-user_id_{id}-|-{uuid}.{ext}\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Google      â”‚\nâ”‚  Cloud       â”‚\nâ”‚  Storage     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 6. Upload to \"media/users\" folder\n       â”‚    Set public access\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Database    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 7. Update profile_picture_url\n       â”‚    Update last_updated\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Response    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 8. Return profile_picture_url\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  Update UI   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n---\n\n## Error Handling\n\nAll profile endpoints return standardized error responses:\n\n### Error Response Format\n\n``` json\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Error message\",\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"details\": {\n      \"field\": \"value\",\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n\n ```\n\n### Common Error Codes\n\n| Error Code | HTTP Status | Description |\n| --- | --- | --- |\n| `PROFILE_NOT_FOUND` | 404 | User profile not found |\n| `PROFILE_INVALID_PAYLOAD` | 400 | Invalid request data |\n| `PROFILE_UPDATE_FAILED` | 500 | Profile update operation failed |\n| `PROFILE_PICTURE_UPDATE_FAILED` | 500 | Profile picture upload failed |\n| `PROFILE_INVALID_OTP` | 400 | Invalid or expired OTP |\n| `EMAIL_ALREADY_EXISTS` | 400 | Email already registered to another user |\n| `PERMISSION_DENIED` | 403 | User lacks required permission |\n| `UNAUTHORIZED` | 401 | Invalid or missing authentication token |\n| `PROFILE_PROCESSING_ERROR` | 500 | Internal server error processing profile request |\n\n### Error Handling Best Practices\n\n1. **Client-Side:**\n    \n    - Always check `response.success` before processing data\n        \n    - Display user-friendly error messages\n        \n    - Handle 401 errors by redirecting to login\n        \n    - Handle 403 errors by showing permission denied message\n        \n    - Log errors for debugging\n        \n2. **Server-Side:**\n    \n    - All errors are logged with context\n        \n    - Sensitive information is not exposed in error messages\n        \n    - Errors include user_id for tracking\n        \n    - Database errors are caught and returned as 500\n        \n\n---\n\n## Best Practices\n\n### Profile Management\n\n1. **Partial Updates:**\n    \n    - Only send fields that need to be updated\n        \n    - Don't send protected fields (user_id, email, phone)\n        \n    - Use appropriate endpoints for email/phone changes\n        \n2. **Profile Picture:**\n    \n    - Validate file size (recommended: < 5MB)\n        \n    - Validate file type (jpg, png, gif, webp)\n        \n    - Show loading state during upload\n        \n    - Handle upload failures gracefully\n        \n3. **Email/Phone Changes:**\n    \n    - Always request OTP first\n        \n    - Verify OTP before allowing change\n        \n    - Show clear instructions to user\n        \n    - Handle OTP expiration (10 minutes)\n        \n4. **Token Management:**\n    \n    - Use session_token for API calls (recommended)\n        \n    - Store tokens securely (httpOnly cookies or secure storage)\n        \n    - Handle token expiration with refresh flow\n        \n    - Include tokens in all authenticated requests\n        \n5. **Permissions:**\n    \n    - Check user permissions before showing edit buttons\n        \n    - Handle permission errors gracefully\n        \n    - Request appropriate permissions from admin if needed\n        \n\n### Security\n\n1. **Authentication:**\n    \n    - Always include tokens in request headers\n        \n    - Use HTTPS for all API calls\n        \n    - Don't expose tokens in URLs or logs\n        \n2. **Data Validation:**\n    \n    - Validate all user input on client side\n        \n    - Server validates all inputs (don't trust client)\n        \n    - Sanitize user-generated content (bio, etc.)\n        \n3. **File Uploads:**\n    \n    - Validate file types and sizes\n        \n    - Scan files for malware (if applicable)\n        \n    - Store files in secure, isolated storage\n        \n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n``` javascript\n// Store tokens after login\nfunction storeTokens(tokens) {\n  localStorage.setItem('access_token', tokens.access_token);\n  localStorage.setItem('session_token', tokens.session_token);\n  localStorage.setItem('refresh_token', tokens.refresh_token);\n  localStorage.setItem('session_id', tokens.session_id);\n}\n// Get token for API calls (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n// API request helper\nasync function apiRequest(url, options = {}) {\n  const token = getAuthToken();\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  if (response.status === 401) {\n    // Token expired, try refresh\n    await refreshTokens();\n    // Retry request\n    return apiRequest(url, options);\n  }\n  return response.json();\n}\n\n ```\n\n### Profile Update Example\n\n``` javascript\n// Update Profile\nasync function updateProfile(profileData) {\n  try {\n    // Remove protected fields\n    const { user_id, email, phone_number, ...updateData } = profileData;\n    const response = await apiRequest('/api/v1/settings/update-profile', {\n      method: 'POST',\n      body: JSON.stringify(updateData)\n    });\n    if (response.success) {\n      // Update UI\n      updateProfileDisplay(response.data);\n      showNotification('Profile updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to update profile');\n    }\n  } catch (error) {\n    console.error('Error updating profile:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Update Profile Picture\nasync function updateProfilePicture(file) {\n  try {\n    // Validate file\n    if (!file || !file.type.startsWith('image/')) {\n      throw new Error('Please select a valid image file');\n    }\n    if (file.size > 5 * 1024 * 1024) {\n      throw new Error('Image size must be less than 5MB');\n    }\n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    const token = getAuthToken();\n    const response = await fetch('/api/v1/settings/update-profile-picture', {\n      method: 'POST',\n      headers: {\n        'X-Session-Token': token\n      },\n      body: formData\n    });\n    const data = await response.json();\n    if (data.success) {\n      // Update UI\n      document.getElementById('profile-picture').src = data.data.profile_picture_url;\n      showNotification('Profile picture updated successfully');\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile picture');\n    }\n  } catch (error) {\n    console.error('Error updating profile picture:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Change Email\nasync function changeEmail(newEmail, otp) {\n  try {\n    // First, request OTP to new email\n    await requestOTP(newEmail, 'email');\n    // Then, change email with OTP\n    const response = await apiRequest('/api/v1/settings/change-email', {\n      method: 'POST',\n      body: JSON.stringify({\n        new_email: newEmail,\n        otp: otp\n      })\n    });\n    if (response.success) {\n      showNotification('Email updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to change email');\n    }\n  } catch (error) {\n    console.error('Error changing email:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Change Phone\nasync function changePhone(newPhone, otp, channel = 'sms') {\n  try {\n    // First, request OTP to new phone\n    const token = getAuthToken();\n    const otpResponse = await fetch(\n      `/api/v1/settings/send-phone-otp?phone=${encodeURIComponent(newPhone)}&channel=${channel}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    const otpData = await otpResponse.json();\n    if (!otpData.success) {\n      throw new Error('Failed to send OTP');\n    }\n    // Then, change phone with OTP\n    const response = await apiRequest('/api/v1/settings/change-phone', {\n      method: 'POST',\n      body: JSON.stringify({\n        new_phone: newPhone,\n        otp: otp\n      })\n    });\n    if (response.success) {\n      showNotification('Phone number updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to change phone');\n    }\n  } catch (error) {\n    console.error('Error changing phone:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Get Profile\nasync function getProfile() {\n  try {\n    const response = await apiRequest('/api/v1/settings/profile', {\n      method: 'GET'\n    });\n    if (response.success) {\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to fetch profile');\n    }\n  } catch (error) {\n    console.error('Error fetching profile:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Update Theme\nasync function updateTheme(theme) {\n  try {\n    if (!['light', 'dark'].includes(theme)) {\n      throw new Error('Theme must be \"light\" or \"dark\"');\n    }\n    const token = getAuthToken();\n    const response = await fetch(\n      `/api/v1/settings/update-theme?theme=${theme}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    const data = await response.json();\n    if (data.success) {\n      showNotification('Theme updated successfully');\n      // Apply theme to UI\n      document.documentElement.setAttribute('data-theme', theme);\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update theme');\n    }\n  } catch (error) {\n    console.error('Error updating theme:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Update Timezone\nasync function updateTimezone(timezone) {\n  try {\n    const token = getAuthToken();\n    const response = await fetch(\n      `/api/v1/settings/update-timezone?timezone=${encodeURIComponent(timezone)}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    const data = await response.json();\n    if (data.success) {\n      showNotification('Timezone updated successfully');\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update timezone');\n    }\n  } catch (error) {\n    console.error('Error updating timezone:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Deactivate Account\nasync function deactivateAccount() {\n  try {\n    const confirmed = confirm('Are you sure you want to deactivate your account?');\n    if (!confirmed) {\n      return;\n    }\n    const response = await apiRequest('/api/v1/settings/deactivate-account', {\n      method: 'POST'\n    });\n    if (response.success) {\n      showNotification('Account deactivated successfully');\n      // Redirect to login or home page\n      window.location.href = '/login';\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to deactivate account');\n    }\n  } catch (error) {\n    console.error('Error deactivating account:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n// Delete Account\nasync function deleteAccount() {\n  try {\n    const confirmed = confirm(\n      'Are you sure you want to delete your account? This action cannot be undone.'\n    );\n    if (!confirmed) {\n      return;\n    }\n    const token = getAuthToken();\n    const response = await fetch(\n      '/api/v1/settings/delete-account?confirm=true',\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    const data = await response.json();\n    if (data.success) {\n      showNotification('Account deleted successfully');\n      // Redirect to login or home page\n      window.location.href = '/login';\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to delete account');\n    }\n  } catch (error) {\n    console.error('Error deleting account:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n ```\n\n### Complete Profile Management Example\n\n``` javascript\n// Complete Profile Management Component\nclass ProfileManager {\n  constructor() {\n    this.profile = null;\n    this.token = null;\n  }\n  async init() {\n    // Load profile on initialization\n    this.token = getAuthToken();\n    if (this.token) {\n      await this.loadProfile();\n    }\n  }\n  async loadProfile() {\n    try {\n      this.profile = await getProfile();\n      this.renderProfile();\n      return this.profile;\n    } catch (error) {\n      console.error('Failed to load profile:', error);\n      return null;\n    }\n  }\n  renderProfile() {\n    if (!this.profile) return;\n    // Update UI elements\n    document.getElementById('profile-name').textContent = \n      `${this.profile.first_name || ''} ${this.profile.last_name || ''}`.trim();\n    document.getElementById('profile-email').textContent = this.profile.email || '';\n    document.getElementById('profile-bio').textContent = this.profile.bio || '';\n    if (this.profile.profile_picture_url) {\n      document.getElementById('profile-picture').src = this.profile.profile_picture_url;\n    }\n    // Update theme\n    if (this.profile.theme) {\n      document.documentElement.setAttribute('data-theme', this.profile.theme);\n    }\n  }\n  async updateProfile(data) {\n    try {\n      this.profile = await updateProfile(data);\n      this.renderProfile();\n      return this.profile;\n    } catch (error) {\n      console.error('Failed to update profile:', error);\n      throw error;\n    }\n  }\n  async updatePicture(file) {\n    try {\n      const result = await updateProfilePicture(file);\n      this.profile.profile_picture_url = result.profile_picture_url;\n      this.renderProfile();\n      return result;\n    } catch (error) {\n      console.error('Failed to update picture:', error);\n      throw error;\n    }\n  }\n}\n// Initialize profile manager\nconst profileManager = new ProfileManager();\nprofileManager.init();\n\n ```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all profile management endpoints:\n\n### Endpoints Covered:\n\n1. âœ… **Get User Profile** - View own profile\n    \n2. âœ… **Get User Profile by ID** - View other users' profiles\n    \n3. âœ… **Update Profile Picture** - Upload and update profile picture\n    \n4. âœ… **Update Profile** - Partial profile updates\n    \n5. âœ… **Profile Accessibility** - Update profile visibility\n    \n6. âœ… **Profile Language** - Update language preference\n    \n7. âœ… **Change Email** - Change email with OTP verification\n    \n8. âœ… **Change Phone** - Change phone with OTP verification\n    \n9. âœ… **Send Phone OTP** - Request OTP for phone verification\n    \n10. âœ… **Update Theme** - Update theme preference\n    \n11. âœ… **Update Timezone** - Update timezone preference\n    \n12. âœ… **Get Settings** - Get all user settings\n    \n13. âœ… **Deactivate Account** - Deactivate user account\n    \n14. âœ… **Delete Account** - Delete user account (soft delete)\n    \n\n### Documentation Sections:\n\n- âœ… Overview and system architecture\n    \n- âœ… Detailed endpoint documentation with examples\n    \n- âœ… Client-server communication flows\n    \n- âœ… Complete workflows and diagrams\n    \n- âœ… Error handling guide\n    \n- âœ… Best practices\n    \n- âœ… Complete client-side implementation examples\n    \n- âœ… User model reference\n    \n\n### Key Features:\n\n- **Permission-based access control** - All endpoints require appropriate permissions\n    \n- **OTP verification** - Email and phone changes require OTP verification\n    \n- **Partial updates** - Only send fields that need updating\n    \n- **File uploads** - Profile pictures uploaded to Google Cloud Storage\n    \n- **Comprehensive error handling** - Standardized error responses\n    \n- **Client-side examples** - Ready-to-use JavaScript code\n    \n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance."
		},
		{
			"name": "User & Activity",
			"item": [
				{
					"name": "Create activity log",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"level\": \"info\",\n    \"message\": \"User logged in successfully\",\n    \"action\": \"login\",\n    \"module\": \"authentication\",\n    \"ip_address\": \"127.0.0.1\",\n    \"user_agent\": \"PostmanRuntime/7.49.1\",\n    \"device\": \"Desktop\",\n    \"browser\": null,\n    \"os\": null,\n    \"platform\": \"web\",\n    \"endpoint\": \"/dev/v1/activity/logs\",\n    \"method\": \"POST\",\n    \"status_code\": null,\n    \"request_id\": null,\n    \"session_id\": null,\n    \"metadata\": null,\n    \"error_details\": null,\n    \"duration_ms\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get specific log",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs/:log_id",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs",
								":log_id"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							],
							"variable": [
								{
									"key": "log_id",
									"value": "265df286-d4e2-45d0-a1d9-a4561baded93"
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get all logs (with filters)",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get current user logs",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/me/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"me",
								"logs"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Delete old logs",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs/cleanup",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs",
								"cleanup"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Activity Logging Router\n\n> **Complete Documentation for Activity Logging and Audit Trail Endpoints** \n  \n\nThis router handles all activity logging operations including creating log entries, retrieving logs with filters, getting statistics, and managing log cleanup.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    - [Create Activity Log](#create-activity-log)\n        \n    - [Get Activity Logs](#get-activity-logs)\n        \n    - [Get Activity Log by ID](#get-activity-log-by-id)\n        \n    - [Get User Activity Logs](#get-user-activity-logs)\n        \n    - [Get My Activity Logs](#get-my-activity-logs)\n        \n    - [Get Activity Statistics](#get-activity-statistics)\n        \n    - [Delete Old Activity Logs](#delete-old-activity-logs)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Activity Logging router provides comprehensive audit trail and activity tracking functionality including:\n\n- **Activity Logging**: Create detailed activity log entries\n    \n- **Log Retrieval**: Query logs with advanced filters\n    \n- **User Activity Tracking**: Track user-specific activities\n    \n- **Statistics**: Get activity statistics and analytics\n    \n- **Log Management**: Clean up old logs\n    \n\n**Base Path:** `/{MODE}/activity`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Create Activity Log\n\n**Endpoint:** `POST /{MODE}/activity/logs`\n\n**Description:** Create a new activity log entry with comprehensive metadata.\n\n**Authentication:** Required  \n**Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"level\": \"info\",\n  \"message\": \"User performed action\",\n  \"action\": \"login\",\n  \"module\": \"authentication\",\n  \"ip_address\": \"192.168.1.1\",\n  \"user_agent\": \"Mozilla/5.0...\",\n  \"endpoint\": \"/api/token\",\n  \"method\": \"POST\",\n  \"status_code\": 200,\n  \"metadata\": {\n    \"key\": \"value\"\n  }\n}\n\n ```\n\n**Level Options:** `info`, `warn`, `error`, `debug`, `audit`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Activity log created successfully\",\n  \"data\": {\n    \"activity_log\": {\n      \"log_id\": \"uuid\",\n      \"user_id\": \"uuid\",\n      \"level\": \"info\",\n      \"message\": \"User performed action\",\n      \"action\": \"login\",\n      \"module\": \"authentication\",\n      \"ip_address\": \"192.168.1.1\",\n      \"created_at\": \"2025-01-01T00:00:00.000Z\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_profile)\n   â”‚\n   â”œâ”€â–º Extract Request Metadata\n   â”‚   â”œâ”€â–º IP Address (req.ip or req.connection.remoteAddress)\n   â”‚   â”œâ”€â–º User Agent (req.get('user-agent'))\n   â”‚   â””â”€â–º Parse User Agent (device, browser, OS)\n   â”‚\n   â”œâ”€â–º Build Log Data\n   â”‚   â”œâ”€â–º user_id (from token or request body)\n   â”‚   â”œâ”€â–º level (default: 'info')\n   â”‚   â”œâ”€â–º message (required)\n   â”‚   â”œâ”€â–º action, module, endpoint, method\n   â”‚   â”œâ”€â–º ip_address, user_agent, device, browser, os\n   â”‚   â”œâ”€â–º request_id, session_id\n   â”‚   â”œâ”€â–º metadata (JSONB)\n   â”‚   â””â”€â–º error_details (JSONB, if error)\n   â”‚\n   â”œâ”€â–º Create Activity Log\n   â”‚   â””â”€â–º createActivityLog(logData)\n   â”‚\n   â””â”€â–º Return Created Log Entry\n\n ```\n\n**Auto-Extracted Fields:**\n\n- `user_id`: From JWT token if not provided\n    \n- `ip_address`: From request if not provided\n    \n- `user_agent`: From request headers if not provided\n    \n- `device`, `browser`, `os`: Parsed from user agent\n    \n- `endpoint`: From request URL if not provided\n    \n- `method`: From request method if not provided\n    \n\n---\n\n### Get Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/logs`\n\n**Description:** Retrieve activity logs with advanced filtering options.\n\n**Authentication:** Required  \n**Permission:** `view_activity_log`\n\n**Query Parameters:**\n\n- `user_id` (optional): Filter by user ID\n    \n- `level` (optional): Filter by log level (`info`, `warn`, `error`, `debug`, `audit`)\n    \n- `action` (optional): Filter by action\n    \n- `module` (optional): Filter by module\n    \n- `ip_address` (optional): Filter by IP address\n    \n- `start_date` (optional): Start date (ISO format)\n    \n- `end_date` (optional): End date (ISO format)\n    \n- `limit` (optional): Number of results (default: 100)\n    \n- `offset` (optional): Pagination offset (default: 0)\n    \n- `order_by` (optional): Sort field (default: `created_at`)\n    \n- `order` (optional): Sort order (`asc`, `desc`, default: `desc`)\n    \n\n**Request:**\n\n``` http\nGET /dev/v1/activity/logs?user_id=uuid&level=error&limit=50&offset=0 HTTP/1.1\nAuthorization: Bearer <token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Activity logs retrieved successfully\",\n  \"data\": {\n    \"activity_logs\": [\n      {\n        \"log_id\": \"uuid\",\n        \"user_id\": \"uuid\",\n        \"level\": \"error\",\n        \"message\": \"Error occurred\",\n        \"action\": \"api_call\",\n        \"module\": \"api\",\n        \"ip_address\": \"192.168.1.1\",\n        \"created_at\": \"2025-01-01T00:00:00.000Z\"\n      }\n    ],\n    \"count\": 50\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º Filters (user_id, level, action, module, ip_address)\n   â”‚   â”œâ”€â–º Date Range (start_date, end_date)\n   â”‚   â”œâ”€â–º Pagination (limit, offset)\n   â”‚   â””â”€â–º Sorting (order_by, order)\n   â”‚\n   â”œâ”€â–º Build Query Filters\n   â”‚   â””â”€â–º Construct Prisma where clause\n   â”‚\n   â”œâ”€â–º Execute Query\n   â”‚   â””â”€â–º getActivityLogs(filters)\n   â”‚\n   â””â”€â–º Return Filtered Logs\n\n ```\n\n---\n\n### Get Activity Log by ID\n\n**Endpoint:** `GET /{MODE}/activity/logs/:log_id`\n\n**Description:** Get a specific activity log by ID.\n\n**Authentication:** Required  \n**Permission:** `view_activity_log`\n\n**Parameters:**\n\n- `log_id` (path): Log UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Activity log retrieved successfully\",\n  \"data\": {\n    \"activity_log\": {\n      \"log_id\": \"uuid\",\n      \"user_id\": \"uuid\",\n      \"level\": \"info\",\n      \"message\": \"User performed action\",\n      \"action\": \"login\",\n      \"module\": \"authentication\",\n      \"ip_address\": \"192.168.1.1\",\n      \"user_agent\": \"Mozilla/5.0...\",\n      \"device\": \"Desktop\",\n      \"browser\": \"Chrome\",\n      \"os\": \"Windows\",\n      \"endpoint\": \"/api/token\",\n      \"method\": \"POST\",\n      \"status_code\": 200,\n      \"metadata\": { ... },\n      \"created_at\": \"2025-01-01T00:00:00.000Z\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Get Activity Log by ID\n   â”‚   â””â”€â–º getActivityLogById(log_id)\n   â”‚\n   â”œâ”€â–º Check if Log Exists\n   â”‚   â””â”€â–º Return 404 if not found\n   â”‚\n   â””â”€â–º Return Activity Log\n\n ```\n\n---\n\n### Get User Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/users/:user_id/logs`\n\n**Description:** Get activity logs for a specific user.\n\n**Authentication:** Required  \n**Permission:** `view_activity_log`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Query Parameters:**\n\n- `start_date` (optional): Start date (ISO format)\n    \n- `end_date` (optional): End date (ISO format)\n    \n- `limit` (optional): Number of results (default: 100)\n    \n- `offset` (optional): Pagination offset (default: 0)\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User activity logs retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"activity_logs\": [ ... ],\n    \"count\": 25\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º Date Range (start_date, end_date)\n   â”‚   â””â”€â–º Pagination (limit, offset)\n   â”‚\n   â”œâ”€â–º Get User Activity Logs\n   â”‚   â””â”€â–º getUserActivityLogs(user_id, filters)\n   â”‚\n   â””â”€â–º Return User Activity Logs\n\n ```\n\n---\n\n### Get My Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/me/logs`\n\n**Description:** Get activity logs for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Query Parameters:**\n\n- `start_date` (optional): Start date (ISO format)\n    \n- `end_date` (optional): End date (ISO format)\n    \n- `limit` (optional): Number of results (default: 100)\n    \n- `offset` (optional): Pagination offset (default: 0)\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Your activity logs retrieved successfully\",\n  \"data\": {\n    \"activity_logs\": [ ... ],\n    \"count\": 10\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º Date range and pagination\n   â”‚\n   â”œâ”€â–º Get User Activity Logs\n   â”‚   â””â”€â–º getUserActivityLogs(userId, filters)\n   â”‚\n   â””â”€â–º Return Activity Logs\n\n ```\n\n---\n\n### Get Activity Statistics\n\n**Endpoint:** `GET /{MODE}/activity/statistics`\n\n**Description:** Get activity log statistics including counts by level, action, and module.\n\n**Authentication:** Required  \n**Permission:** `view_activity_log`\n\n**Query Parameters:**\n\n- `user_id` (optional): Filter by user ID\n    \n- `start_date` (optional): Start date (ISO format)\n    \n- `end_date` (optional): End date (ISO format)\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Activity statistics retrieved successfully\",\n  \"data\": {\n    \"statistics\": {\n      \"total_logs\": 1000,\n      \"by_level\": {\n        \"info\": 800,\n        \"warn\": 100,\n        \"error\": 80,\n        \"debug\": 15,\n        \"audit\": 5\n      },\n      \"by_action\": {\n        \"login\": 200,\n        \"logout\": 150,\n        \"api_call\": 500\n      },\n      \"by_module\": {\n        \"authentication\": 350,\n        \"api\": 500,\n        \"profile\": 150\n      }\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º user_id (optional)\n   â”‚   â””â”€â–º Date range (optional)\n   â”‚\n   â”œâ”€â–º Build Query Filters\n   â”‚\n   â”œâ”€â–º Calculate Statistics\n   â”‚   â”œâ”€â–º Total logs count\n   â”‚   â”œâ”€â–º Count by level (groupBy)\n   â”‚   â”œâ”€â–º Count by action (groupBy)\n   â”‚   â””â”€â–º Count by module (groupBy)\n   â”‚\n   â””â”€â–º Return Statistics\n\n ```\n\n---\n\n### Delete Old Activity Logs\n\n**Endpoint:** `DELETE /{MODE}/activity/logs/cleanup`\n\n**Description:** Delete activity logs older than specified days.\n\n**Authentication:** Required  \n**Permission:** `delete_activity_log`\n\n**Query Parameters:**\n\n- `days` (optional): Days old (default: 90)\n    \n\n**Request:**\n\n``` http\nDELETE /dev/v1/activity/logs/cleanup?days=90 HTTP/1.1\nAuthorization: Bearer <token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Old activity logs deleted successfully\",\n  \"data\": {\n    \"deleted_count\": 500,\n    \"days_old\": 90\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º days (default: 90)\n   â”‚\n   â”œâ”€â–º Calculate Cutoff Date\n   â”‚   â””â”€â–º Current date - days\n   â”‚\n   â”œâ”€â–º Delete Old Logs\n   â”‚   â””â”€â–º deleteOldActivityLogs(daysOld)\n   â”‚       â””â”€â–º prisma.activityLog.deleteMany()\n   â”‚\n   â””â”€â–º Return Deletion Count\n\n ```\n\n**Use Cases:**\n\n- Database maintenance\n    \n- Storage optimization\n    \n- Compliance (GDPR data retention)\n    \n- Performance optimization\n    \n\n---\n\n## Workflows\n\n### Complete Activity Logging Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Activity Logging Flow                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Create Log   â”‚         â”‚  Query Logs   â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Extract Meta  â”‚         â”‚ Apply Filters â”‚\n        â”‚   Data        â”‚         â”‚   & Paginationâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Parse User    â”‚         â”‚ Execute Query â”‚\n        â”‚   Agent       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Store in DB   â”‚         â”‚ Return Resultsâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### Activity Log Creation Flow\n\n```\n1. User Action Occurs\n   â”‚\n   â”œâ”€â–º Extract Request Context\n   â”‚   â”œâ”€â–º IP Address\n   â”‚   â”œâ”€â–º User Agent\n   â”‚   â”œâ”€â–º Endpoint\n   â”‚   â””â”€â–º Method\n   â”‚\n   â”œâ”€â–º Parse User Agent\n   â”‚   â”œâ”€â–º Device Type\n   â”‚   â”œâ”€â–º Browser\n   â”‚   â””â”€â–º Operating System\n   â”‚\n   â”œâ”€â–º Build Log Entry\n   â”‚   â”œâ”€â–º User ID\n   â”‚   â”œâ”€â–º Level\n   â”‚   â”œâ”€â–º Message\n   â”‚   â”œâ”€â–º Action & Module\n   â”‚   â”œâ”€â–º Request Metadata\n   â”‚   â””â”€â–º Custom Metadata\n   â”‚\n   â”œâ”€â–º Store in Database\n   â”‚   â””â”€â–º ActivityLog table\n   â”‚\n   â””â”€â–º Return Log Entry\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"message is required\",\n  \"statusCode\": 400\n}\n\n ```\n\n**403 Forbidden - Permission Denied:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires view_activity_log permission\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found - Log Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Activity log not found\",\n  \"error\": \"Log with provided ID does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**500 Internal Server Error:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Activity log creation failed\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Log Levels**: Use appropriate log levels (info, warn, error, debug, audit)\n    \n2. **Metadata**: Include relevant metadata for debugging and auditing\n    \n3. **User Agent Parsing**: Automatically parse user agent for device/browser/OS info\n    \n4. **Pagination**: Always use pagination for log queries to avoid performance issues\n    \n5. **Date Filtering**: Use date filters to limit query scope\n    \n6. **Log Cleanup**: Regularly clean up old logs to maintain database performance\n    \n7. **Sensitive Data**: Don't log sensitive information (passwords, tokens, etc.)\n    \n8. **Performance**: Index frequently queried fields (user_id, level, action, created_at)\n    \n\n---\n\n## Log Levels\n\n- **info**: General informational messages\n    \n- **warn**: Warning messages for potential issues\n    \n- **error**: Error messages for failures\n    \n- **debug**: Debug messages for development\n    \n- **audit**: Audit trail messages for compliance\n    \n\n---\n\n## Database Schema\n\n**ActivityLog Model:**\n\n- `log_id`: UUID (Primary Key)\n    \n- `user_id`: UUID (Foreign Key, nullable)\n    \n- `level`: String (info, warn, error, debug, audit)\n    \n- `message`: String\n    \n- `action`: String (nullable)\n    \n- `module`: String (nullable)\n    \n- `ip_address`: String\n    \n- `user_agent`: String\n    \n- `device`: String (nullable)\n    \n- `browser`: String (nullable)\n    \n- `os`: String (nullable)\n    \n- `platform`: String (default: 'web')\n    \n- `endpoint`: String (nullable)\n    \n- `method`: String (nullable)\n    \n- `status_code`: Integer (nullable)\n    \n- `request_id`: String (nullable)\n    \n- `session_id`: String (nullable)\n    \n- `metadata`: JSONB (nullable)\n    \n- `error_details`: JSONB (nullable)\n    \n- `duration_ms`: Integer (nullable)\n    \n- `created_at`: Timestamp\n    \n\n---\n\n**Last Updated**: January 2025"
		},
		{
			"name": "Groups & Permissions",
			"item": [
				{
					"name": "Permissions",
					"item": [
						{
							"name": "permissions",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"response": [
								{
									"name": "profile",
									"originalRequest": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{domain.com}}/{{mode}}/settings/profile",
											"host": [
												"{{domain.com}}"
											],
											"path": [
												"{{mode}}",
												"settings",
												"profile"
											],
											"query": [
												{
													"key": "page",
													"value": "1",
													"disabled": true
												},
												{
													"key": "page_size",
													"value": "1",
													"disabled": true
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Server",
											"value": "openresty"
										},
										{
											"key": "Date",
											"value": "Sun, 16 Nov 2025 07:46:55 GMT"
										},
										{
											"key": "Content-Type",
											"value": "application/json",
											"description": "",
											"type": "text"
										},
										{
											"key": "Content-Length",
											"value": "994"
										},
										{
											"key": "Connection",
											"value": "keep-alive"
										},
										{
											"key": "X-XSS-Protection",
											"value": "1; mode=block"
										},
										{
											"key": "X-Content-Type-Options",
											"value": "nosniff"
										},
										{
											"key": "X-Frame-Options",
											"value": "DENY"
										},
										{
											"key": "Referrer-Policy",
											"value": "strict-origin-when-cross-origin"
										},
										{
											"key": "Permissions-Policy",
											"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
										},
										{
											"key": "X-Permitted-Cross-Domain-Policies",
											"value": "none"
										},
										{
											"key": "Content-Security-Policy",
											"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
										},
										{
											"key": "X-Served-By",
											"value": "v3.staging.winsta.pro"
										}
									],
									"cookie": [],
									"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
								}
							]
						},
						{
							"name": "get-permissions",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/59bcc480-e972-46db-8b7f-804af5102e42?page=1&page_size=1",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"59bcc480-e972-46db-8b7f-804af5102e42"
									],
									"query": [
										{
											"key": "page",
											"value": "1"
										},
										{
											"key": "page_size",
											"value": "1"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "create-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									]
								}
							},
							"response": []
						},
						{
							"name": "update-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"type": "file",
											"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"permission_id"
									]
								}
							},
							"response": []
						},
						{
							"name": "delete-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"permission_id"
									]
								}
							},
							"response": []
						}
					],
					"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints** \n  \n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    \n    - [Permissions](#permissions)\n        \n    - [Groups](#groups)\n        \n    - [User Permissions &amp; Groups](#user-permissions--groups)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n\n- **Permission Management**: Create, read, update, and delete permissions\n    \n- **Group Management**: Create, read, update, and delete groups\n    \n- **Permission Assignment**: Assign permissions to groups\n    \n- **User-Group Assignment**: Assign groups to users\n    \n- **Permission Queries**: Get user permissions and groups\n    \n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get All Permissions\n   â”‚   â””â”€â–º prisma.permission.findMany()\n   â”‚\n   â””â”€â–º Return Permissions List\n\n ```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n\n ```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required  \n**Permission:** `add_permission`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_permission)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Permission\n   â”‚   â””â”€â–º prisma.permission.create()\n   â”‚\n   â””â”€â–º Return Created Permission\n\n ```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required  \n**Permission:** `edit_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n\n ```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required  \n**Permission:** `delete_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n\n ```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n\n ```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required  \n**Permission:** `add_group`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n\n ```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required  \n**Permission:** `delete_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required  \n**Permission:** `assign_groups`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n\n ```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissionsâ”‚\n                    â”‚   (Aggregated)  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n\n ```\n\n**403 Forbidden - Permission Denied:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - Duplicate Entry:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n    \n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n    \n3. **System Groups**: Don't delete system groups (is_system = true)\n    \n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n    \n5. **Group Assignment**: Assign groups to users, not permissions directly\n    \n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n    \n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n    \n8. **Validation**: Always validate permission/group codenames before assignment\n    \n\n---\n\n**Last Updated**: January 2025"
				},
				{
					"name": "Groups",
					"item": [
						{
							"name": "groups",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"response": [
								{
									"name": "profile",
									"originalRequest": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{domain.com}}/{{mode}}/settings/profile",
											"host": [
												"{{domain.com}}"
											],
											"path": [
												"{{mode}}",
												"settings",
												"profile"
											],
											"query": [
												{
													"key": "page",
													"value": "1",
													"disabled": true
												},
												{
													"key": "page_size",
													"value": "1",
													"disabled": true
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Server",
											"value": "openresty"
										},
										{
											"key": "Date",
											"value": "Sun, 16 Nov 2025 07:46:55 GMT"
										},
										{
											"key": "Content-Type",
											"value": "application/json",
											"description": "",
											"type": "text"
										},
										{
											"key": "Content-Length",
											"value": "994"
										},
										{
											"key": "Connection",
											"value": "keep-alive"
										},
										{
											"key": "X-XSS-Protection",
											"value": "1; mode=block"
										},
										{
											"key": "X-Content-Type-Options",
											"value": "nosniff"
										},
										{
											"key": "X-Frame-Options",
											"value": "DENY"
										},
										{
											"key": "Referrer-Policy",
											"value": "strict-origin-when-cross-origin"
										},
										{
											"key": "Permissions-Policy",
											"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
										},
										{
											"key": "X-Permitted-Cross-Domain-Policies",
											"value": "none"
										},
										{
											"key": "Content-Security-Policy",
											"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
										},
										{
											"key": "X-Served-By",
											"value": "v3.staging.winsta.pro"
										}
									],
									"cookie": [],
									"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
								}
							]
						},
						{
							"name": "get-groups",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/9c93cc19-7325-45e4-8f03-7ea80850170d?page=1&page_size=1",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"9c93cc19-7325-45e4-8f03-7ea80850170d"
									],
									"query": [
										{
											"key": "page",
											"value": "1"
										},
										{
											"key": "page_size",
											"value": "1"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "create",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									]
								}
							},
							"response": []
						},
						{
							"name": "Assign permissions to group",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/:group_id/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										":group_id",
										"permissions"
									],
									"variable": [
										{
											"key": "group_id",
											"value": ""
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "update",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"type": "file",
											"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/groups_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"groups_id"
									]
								}
							},
							"response": []
						},
						{
							"name": "delete-groups",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{session_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"permission_id"
									]
								}
							},
							"response": []
						}
					],
					"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints** \n  \n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    \n    - [Permissions](#permissions)\n        \n    - [Groups](#groups)\n        \n    - [User Permissions &amp; Groups](#user-permissions--groups)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n\n- **Permission Management**: Create, read, update, and delete permissions\n    \n- **Group Management**: Create, read, update, and delete groups\n    \n- **Permission Assignment**: Assign permissions to groups\n    \n- **User-Group Assignment**: Assign groups to users\n    \n- **Permission Queries**: Get user permissions and groups\n    \n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get All Permissions\n   â”‚   â””â”€â–º prisma.permission.findMany()\n   â”‚\n   â””â”€â–º Return Permissions List\n\n ```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n\n ```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required  \n**Permission:** `add_permission`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_permission)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Permission\n   â”‚   â””â”€â–º prisma.permission.create()\n   â”‚\n   â””â”€â–º Return Created Permission\n\n ```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required  \n**Permission:** `edit_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n\n ```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required  \n**Permission:** `delete_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n\n ```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n\n ```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required  \n**Permission:** `add_group`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n\n ```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required  \n**Permission:** `delete_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required  \n**Permission:** `assign_groups`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n\n ```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissionsâ”‚\n                    â”‚   (Aggregated)  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n\n ```\n\n**403 Forbidden - Permission Denied:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - Duplicate Entry:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n    \n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n    \n3. **System Groups**: Don't delete system groups (is_system = true)\n    \n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n    \n5. **Group Assignment**: Assign groups to users, not permissions directly\n    \n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n    \n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n    \n8. **Validation**: Always validate permission/group codenames before assignment\n    \n\n---\n\n**Last Updated**: January 2025"
				},
				{
					"name": "Get user's groups",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"groups"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get user's permissions",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/:user_id/permissions",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								":user_id",
								"permissions"
							],
							"variable": [
								{
									"key": "user_id",
									"value": ""
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Assign groups to user",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/api/users/:user_id/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"api",
								"users",
								":user_id",
								"groups"
							],
							"variable": [
								{
									"key": "user_id",
									"value": ""
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get current user's groups",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/me/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								"me",
								"groups"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get current user's permissions",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/me/permissions",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								"me",
								"permissions"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints**\n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Permissions](#permissions)\n  - [Groups](#groups)\n  - [User Permissions & Groups](#user-permissions--groups)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Client-Side Implementation](#client-side-implementation)\n- [Summary](#summary)\n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n- **Permission Management**: Create, read, update, and delete permissions\n- **Group Management**: Create, read, update, and delete groups\n- **Permission Assignment**: Assign permissions to groups\n- **User-Group Assignment**: Assign groups to users\n- **Permission Queries**: Get user permissions and groups\n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_permission`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Admin navigates to permissions management page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/permissions\n\nStep 2: Client sends request\n  GET /{MODE}/permissions\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display permissions list in UI\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract permissions array from response.data.permissions\n  â”œâ”€â–º Render permissions table/list\n  â”œâ”€â–º Group by category if needed\n  â””â”€â–º Enable edit/delete actions based on permissions\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_permission\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Database query\n  â”œâ”€â–º Query all permissions from database\n  â”œâ”€â–º Fetch permission fields (permission_id, name, codename, description, category)\n  â””â”€â–º Order by category or name\n\nStep 4: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include permissions array in data.permissions\n  â””â”€â–º Return response with user's language preference\n\nStep 5: Error handling\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Error Responses:**\n\n```json\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_permission\"\n    }\n  }\n}\n\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Internal server error\",\n  \"error\": {\n    \"code\": \"INTERNAL_ERROR\",\n    \"details\": {\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required\n**Permission:** `view_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `add_permission`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\nContent-Type: application/json\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Body:**\n```json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User fills permission form\n  â”œâ”€â–º User enters permission name\n  â”œâ”€â–º User enters codename (lowercase with underscores)\n  â”œâ”€â–º User enters description (optional)\n  â”œâ”€â–º User selects category (optional)\n  â””â”€â–º User clicks \"Create\" button\n\nStep 2: Client validates form\n  â”œâ”€â–º Validate name is not empty\n  â”œâ”€â–º Validate codename format (lowercase, underscores)\n  â”œâ”€â–º Check codename uniqueness (client-side check)\n  â””â”€â–º Prepare request payload\n\nStep 3: Client sends request\n  POST /{MODE}/permissions\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/json\n  Body:\n    {\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Add permission to list, show success message\n  â”œâ”€â–º Bad Request (400): Show validation errors\n  â”œâ”€â–º Conflict (409): Show duplicate codename error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Parse request body (PermissionCreate model)\n  â””â”€â–º Check permission: \"add_permission\"\n\nStep 2: Data validation\n  â”œâ”€â–º Validate name is provided and not empty\n  â”œâ”€â–º Validate codename is provided\n  â”œâ”€â–º Validate codename format (lowercase, underscores, alphanumeric)\n  â”œâ”€â–º Check codename uniqueness in database\n  â””â”€â–º If duplicate: Return 409 Conflict\n\nStep 3: Create permission\n  â”œâ”€â–º Insert permission into database\n  â”œâ”€â–º Generate permission_id (UUID)\n  â”œâ”€â–º Set created_at timestamp\n  â””â”€â–º Return created permission\n\nStep 4: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include created permission in data.permission\n  â””â”€â–º Return response with user's language preference\n\nStep 5: Error handling\n  â”œâ”€â–º Validation error: Return 400\n  â”œâ”€â–º Duplicate codename: Return 409\n  â”œâ”€â–º Permission denied: Return 403\n  â”œâ”€â–º Database error: Log error, return 500\n  â””â”€â–º Token invalid: Return 401\n```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required\n**Permission:** `edit_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Request Body:**\n```json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required\n**Permission:** `delete_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required\n**Permission:** `view_group`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required\n**Permission:** `view_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required\n**Permission:** `add_group`\n\n**Request Body:**\n```json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required\n**Permission:** `edit_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Request Body:**\n```json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required\n**Permission:** `delete_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required\n**Permission:** `edit_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Request Body:**\n```json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required\n**Permission:** `view_user`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required\n**Permission:** `view_user`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required\n**Permission:** `assign_groups`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Request Body:**\n```json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required\n**Permission:** `view_profile`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required\n**Permission:** `view_profile`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissions â”‚\n                    â”‚   (Aggregated)   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n```\n\n**403 Forbidden - Permission Denied:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n```\n\n**404 Not Found:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n```\n\n**409 Conflict - Duplicate Entry:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n3. **System Groups**: Don't delete system groups (is_system = true)\n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n5. **Group Assignment**: Assign groups to users, not permissions directly\n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n8. **Validation**: Always validate permission/group codenames before assignment\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for permissions endpoints\nasync function permissionsRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to perform this action');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success) {\n    throw new Error(data.error?.message || 'Request failed');\n  }\n  \n  return data;\n}\n```\n\n### Permissions Management\n\n```javascript\n// Get all permissions\nasync function getPermissions() {\n  try {\n    const response = await permissionsRequest('/api/v1/permissions', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching permissions:', error);\n    showError('Failed to load permissions');\n    throw error;\n  }\n}\n\n// Get permission by ID\nasync function getPermission(permissionId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/permissions/${permissionId}`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error fetching permission:', error);\n    showError('Failed to load permission');\n    throw error;\n  }\n}\n\n// Create permission\nasync function createPermission(permissionData) {\n  try {\n    // Validate codename format\n    if (!/^[a-z][a-z0-9_]*$/.test(permissionData.codename)) {\n      throw new Error('Codename must be lowercase with underscores');\n    }\n    \n    const response = await permissionsRequest('/api/v1/permissions', {\n      method: 'POST',\n      body: JSON.stringify(permissionData)\n    });\n    \n    if (response && response.data) {\n      showNotification('Permission created successfully');\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error creating permission:', error);\n    showError(error.message || 'Failed to create permission');\n    throw error;\n  }\n}\n\n// Update permission\nasync function updatePermission(permissionId, updateData) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/permissions/${permissionId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updateData)\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Permission updated successfully');\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error updating permission:', error);\n    showError('Failed to update permission');\n    throw error;\n  }\n}\n\n// Delete permission\nasync function deletePermission(permissionId) {\n  try {\n    const confirmed = confirm('Are you sure you want to delete this permission?');\n    if (!confirmed) {\n      return;\n    }\n    \n    const response = await permissionsRequest(\n      `/api/v1/permissions/${permissionId}`,\n      { method: 'DELETE' }\n    );\n    \n    if (response) {\n      showNotification('Permission deleted successfully');\n      return true;\n    }\n  } catch (error) {\n    console.error('Error deleting permission:', error);\n    showError('Failed to delete permission');\n    throw error;\n  }\n}\n```\n\n### Groups Management\n\n```javascript\n// Get all groups\nasync function getGroups() {\n  try {\n    const response = await permissionsRequest('/api/v1/groups', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching groups:', error);\n    showError('Failed to load groups');\n    throw error;\n  }\n}\n\n// Get group by ID\nasync function getGroup(groupId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/groups/${groupId}`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error fetching group:', error);\n    showError('Failed to load group');\n    throw error;\n  }\n}\n\n// Create group\nasync function createGroup(groupData) {\n  try {\n    // Validate codename format\n    if (!/^[a-z][a-z0-9_]*$/.test(groupData.codename)) {\n      throw new Error('Codename must be lowercase with underscores');\n    }\n    \n    const response = await permissionsRequest('/api/v1/groups', {\n      method: 'POST',\n      body: JSON.stringify(groupData)\n    });\n    \n    if (response && response.data) {\n      showNotification('Group created successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error creating group:', error);\n    showError(error.message || 'Failed to create group');\n    throw error;\n  }\n}\n\n// Update group\nasync function updateGroup(groupId, updateData) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/groups/${groupId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updateData)\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Group updated successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error updating group:', error);\n    showError('Failed to update group');\n    throw error;\n  }\n}\n\n// Delete group\nasync function deleteGroup(groupId) {\n  try {\n    const confirmed = confirm(\n      'Are you sure you want to delete this group? This will remove all user assignments.'\n    );\n    if (!confirmed) {\n      return;\n    }\n    \n    const response = await permissionsRequest(\n      `/api/v1/groups/${groupId}`,\n      { method: 'DELETE' }\n    );\n    \n    if (response) {\n      showNotification('Group deleted successfully');\n      return true;\n    }\n  } catch (error) {\n    console.error('Error deleting group:', error);\n    showError('Failed to delete group');\n    throw error;\n  }\n}\n\n// Assign permissions to group\nasync function assignPermissionsToGroup(groupId, permissionIds) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/groups/${groupId}/permissions`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ permission_ids: permissionIds })\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Permissions assigned successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error assigning permissions:', error);\n    showError('Failed to assign permissions');\n    throw error;\n  }\n}\n```\n\n### User Permissions & Groups\n\n```javascript\n// Get user groups\nasync function getUserGroups(userId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/users/${userId}/groups`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching user groups:', error);\n    showError('Failed to load user groups');\n    throw error;\n  }\n}\n\n// Get user permissions\nasync function getUserPermissions(userId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/v1/users/${userId}/permissions`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching user permissions:', error);\n    showError('Failed to load user permissions');\n    throw error;\n  }\n}\n\n// Assign groups to user\nasync function assignGroupsToUser(userId, groupCodenames) {\n  try {\n    // Validate group codenames\n    const validCodenames = ['super_admin', 'admin', 'developer', 'business', 'accountant', 'user'];\n    const invalid = groupCodenames.filter(c => !validCodenames.includes(c));\n    if (invalid.length > 0) {\n      throw new Error(`Invalid group codenames: ${invalid.join(', ')}`);\n    }\n    \n    const response = await permissionsRequest(\n      `/api/v1/users/${userId}/groups`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ group_codenames: groupCodenames })\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Groups assigned successfully');\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error assigning groups:', error);\n    showError(error.message || 'Failed to assign groups');\n    throw error;\n  }\n}\n\n// Get my groups (current user)\nasync function getMyGroups() {\n  try {\n    const response = await permissionsRequest('/api/v1/users/me/groups', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching my groups:', error);\n    showError('Failed to load groups');\n    throw error;\n  }\n}\n\n// Get my permissions (current user)\nasync function getMyPermissions() {\n  try {\n    const response = await permissionsRequest('/api/v1/users/me/permissions', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching my permissions:', error);\n    showError('Failed to load permissions');\n    throw error;\n  }\n}\n```\n\n### Complete Permissions Manager Component\n\n```javascript\n// Complete Permissions Manager Class\nclass PermissionsManager {\n  constructor() {\n    this.permissions = [];\n    this.groups = [];\n    this.userPermissions = null;\n    this.userGroups = null;\n  }\n  \n  async init() {\n    try {\n      // Load permissions and groups\n      await Promise.all([\n        this.loadPermissions(),\n        this.loadGroups(),\n        this.loadMyPermissions(),\n        this.loadMyGroups()\n      ]);\n    } catch (error) {\n      console.error('Failed to initialize permissions manager:', error);\n      showError('Failed to load permissions data');\n    }\n  }\n  \n  async loadPermissions() {\n    try {\n      this.permissions = await getPermissions();\n      this.renderPermissions();\n      return this.permissions;\n    } catch (error) {\n      console.error('Failed to load permissions:', error);\n      return [];\n    }\n  }\n  \n  async loadGroups() {\n    try {\n      this.groups = await getGroups();\n      this.renderGroups();\n      return this.groups;\n    } catch (error) {\n      console.error('Failed to load groups:', error);\n      return [];\n    }\n  }\n  \n  async loadMyPermissions() {\n    try {\n      this.userPermissions = await getMyPermissions();\n      this.renderMyPermissions();\n      return this.userPermissions;\n    } catch (error) {\n      console.error('Failed to load my permissions:', error);\n      return [];\n    }\n  }\n  \n  async loadMyGroups() {\n    try {\n      this.userGroups = await getMyGroups();\n      this.renderMyGroups();\n      return this.userGroups;\n    } catch (error) {\n      console.error('Failed to load my groups:', error);\n      return [];\n    }\n  }\n  \n  renderPermissions() {\n    const container = document.getElementById('permissions-list');\n    if (!container) return;\n    \n    container.innerHTML = this.permissions.map(perm => `\n      <div class=\"permission-item\">\n        <h4>${perm.name}</h4>\n        <code>${perm.codename}</code>\n        <p>${perm.description || ''}</p>\n        <span class=\"category\">${perm.category || 'uncategorized'}</span>\n        <button onclick=\"permissionsManager.editPermission('${perm.permission_id}')\">Edit</button>\n        <button onclick=\"permissionsManager.deletePermission('${perm.permission_id}')\">Delete</button>\n      </div>\n    `).join('');\n  }\n  \n  renderGroups() {\n    const container = document.getElementById('groups-list');\n    if (!container) return;\n    \n    container.innerHTML = this.groups.map(group => `\n      <div class=\"group-item\">\n        <h4>${group.name}</h4>\n        <code>${group.codename}</code>\n        <p>${group.description || ''}</p>\n        <div class=\"permissions-count\">\n          ${group.permissions?.length || 0} permissions\n        </div>\n        <button onclick=\"permissionsManager.editGroup('${group.group_id}')\">Edit</button>\n        <button onclick=\"permissionsManager.deleteGroup('${group.group_id}')\">Delete</button>\n      </div>\n    `).join('');\n  }\n  \n  renderMyPermissions() {\n    const container = document.getElementById('my-permissions');\n    if (!container) return;\n    \n    if (this.userPermissions && this.userPermissions.length > 0) {\n      container.innerHTML = this.userPermissions.map(perm => `\n        <div class=\"permission-badge\">${perm.name} (${perm.codename})</div>\n      `).join('');\n    } else {\n      container.innerHTML = '<p>No permissions assigned</p>';\n    }\n  }\n  \n  renderMyGroups() {\n    const container = document.getElementById('my-groups');\n    if (!container) return;\n    \n    if (this.userGroups && this.userGroups.length > 0) {\n      container.innerHTML = this.userGroups.map(group => `\n        <div class=\"group-badge\">${group.name} (${group.codename})</div>\n      `).join('');\n    } else {\n      container.innerHTML = '<p>No groups assigned</p>';\n    }\n  }\n  \n  async createPermission(permissionData) {\n    try {\n      const permission = await createPermission(permissionData);\n      await this.loadPermissions();\n      return permission;\n    } catch (error) {\n      console.error('Failed to create permission:', error);\n      throw error;\n    }\n  }\n  \n  async updatePermission(permissionId, updateData) {\n    try {\n      const permission = await updatePermission(permissionId, updateData);\n      await this.loadPermissions();\n      return permission;\n    } catch (error) {\n      console.error('Failed to update permission:', error);\n      throw error;\n    }\n  }\n  \n  async deletePermission(permissionId) {\n    try {\n      await deletePermission(permissionId);\n      await this.loadPermissions();\n    } catch (error) {\n      console.error('Failed to delete permission:', error);\n      throw error;\n    }\n  }\n  \n  async createGroup(groupData) {\n    try {\n      const group = await createGroup(groupData);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to create group:', error);\n      throw error;\n    }\n  }\n  \n  async updateGroup(groupId, updateData) {\n    try {\n      const group = await updateGroup(groupId, updateData);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to update group:', error);\n      throw error;\n    }\n  }\n  \n  async deleteGroup(groupId) {\n    try {\n      await deleteGroup(groupId);\n      await this.loadGroups();\n    } catch (error) {\n      console.error('Failed to delete group:', error);\n      throw error;\n    }\n  }\n  \n  async assignPermissionsToGroup(groupId, permissionIds) {\n    try {\n      const group = await assignPermissionsToGroup(groupId, permissionIds);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to assign permissions:', error);\n      throw error;\n    }\n  }\n}\n\n// Initialize permissions manager\ndocument.addEventListener('DOMContentLoaded', () => {\n  window.permissionsManager = new PermissionsManager();\n  permissionsManager.init();\n});\n```\n\n### Permission Checking Utility\n\n```javascript\n// Check if user has a specific permission\nasync function hasPermission(codename) {\n  try {\n    const permissions = await getMyPermissions();\n    return permissions.some(perm => perm.codename === codename);\n  } catch (error) {\n    console.error('Error checking permission:', error);\n    return false;\n  }\n}\n\n// Check if user has any of the specified permissions\nasync function hasAnyPermission(codenames) {\n  try {\n    const permissions = await getMyPermissions();\n    const permissionCodenames = permissions.map(p => p.codename);\n    return codenames.some(codename => permissionCodenames.includes(codename));\n  } catch (error) {\n    console.error('Error checking permissions:', error);\n    return false;\n  }\n}\n\n// Check if user has all of the specified permissions\nasync function hasAllPermissions(codenames) {\n  try {\n    const permissions = await getMyPermissions();\n    const permissionCodenames = permissions.map(p => p.codename);\n    return codenames.every(codename => permissionCodenames.includes(codename));\n  } catch (error) {\n    console.error('Error checking permissions:', error);\n    return false;\n  }\n}\n\n// Conditionally render UI based on permissions\nasync function renderPermissionBasedUI() {\n  const canViewDashboard = await hasPermission('view_dashboard');\n  const canEditProfile = await hasPermission('edit_profile');\n  \n  if (canViewDashboard) {\n    document.getElementById('dashboard-link').style.display = 'block';\n  }\n  \n  if (canEditProfile) {\n    document.getElementById('edit-profile-btn').style.display = 'block';\n  }\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all permission and group management endpoints:\n\n### Endpoints Covered:\n1. âœ… **Get All Permissions** - List all permissions\n2. âœ… **Get Permission by ID** - Get specific permission\n3. âœ… **Create Permission** - Create new permission\n4. âœ… **Update Permission** - Update existing permission\n5. âœ… **Delete Permission** - Delete permission\n6. âœ… **Get All Groups** - List all groups with permissions\n7. âœ… **Get Group by ID** - Get specific group\n8. âœ… **Create Group** - Create new group\n9. âœ… **Update Group** - Update existing group\n10. âœ… **Delete Group** - Delete group\n11. âœ… **Assign Permissions to Group** - Assign permissions to a group\n12. âœ… **Get User Groups** - Get groups for a user\n13. âœ… **Get User Permissions** - Get permissions for a user\n14. âœ… **Assign Groups to User** - Assign groups to a user\n15. âœ… **Get My Groups** - Get current user's groups\n16. âœ… **Get My Permissions** - Get current user's permissions\n\n### Documentation Sections:\n- âœ… Overview and RBAC architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices\n- âœ… Complete client-side implementation examples\n- âœ… Permissions Manager component\n- âœ… Permission checking utilities\n\n### Key Features:\n- **Role-Based Access Control (RBAC)** - Comprehensive permission system\n- **Group Management** - Organize permissions into groups\n- **User Assignment** - Assign groups to users\n- **Permission Aggregation** - User permissions from all groups\n- **System Groups Protection** - System groups cannot be deleted\n- **Client-side examples** - Ready-to-use JavaScript code\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Dashboard & Analytics",
			"item": [
				{
					"name": "overview",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-status",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-type",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-auth-type",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-country",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-language",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "user-growth",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "role-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/role-statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"role-statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "recent-sign-ins",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "all-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/all-statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"all-statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "activity-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Dashboard Router\n\n> **Complete Documentation for Dashboard Analytics and Statistics Endpoints**\n\nThis router provides comprehensive dashboard statistics and analytics for user management, including user counts, growth metrics, role statistics, and sign-in analytics.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Dashboard Overview](#dashboard-overview)\n  - [Users by Status](#users-by-status)\n  - [Users by Type](#users-by-type)\n  - [Users by Auth Type](#users-by-auth-type)\n  - [Users by Country](#users-by-country)\n  - [Users by Language](#users-by-language)\n  - [User Growth](#user-growth)\n  - [Role Statistics](#role-statistics)\n  - [Recent Sign-ins](#recent-sign-ins)\n  - [All Statistics](#all-statistics)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n\n## Overview\n\nThe Dashboard router provides analytics and statistics endpoints for monitoring user data, growth metrics, and system health. These endpoints are essential for:\n- **Administrative Dashboards**: Display key metrics and KPIs\n- **User Analytics**: Track user growth and demographics\n- **System Monitoring**: Monitor user activity and engagement\n- **Reporting**: Generate reports for stakeholders\n\n**Base Path:** `/{MODE}/dashboard`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** All endpoints require `view_dashboard` permission\n\n## Endpoints\n\n### Dashboard Overview\n\n**Endpoint:** `GET /{MODE}/dashboard/overview`\n\n**Description:** Returns comprehensive dashboard overview statistics including total users, active users, verified users, and new user counts.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_dashboard`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Dashboard overview retrieved successfully\",\n  \"data\": {\n    \"overview\": {\n      \"total_users\": 1000,\n      \"active_users\": 850,\n      \"verified_users\": 800,\n      \"email_verified\": 750,\n      \"phone_verified\": 700,\n      \"new_users\": {\n        \"today\": 10,\n        \"this_week\": 50,\n        \"this_month\": 200\n      },\n      \"users_with_sign_in\": 600\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º Today (00:00:00)\n   â”‚   â”œâ”€â–º Tomorrow (00:00:00)\n   â”‚   â”œâ”€â–º Week Ago (7 days)\n   â”‚   â””â”€â–º Month Start (1st of month)\n   â”‚\n   â”œâ”€â–º Execute Parallel Queries\n   â”‚   â”œâ”€â–º Total Users Count\n   â”‚   â”œâ”€â–º Active Users Count (is_active = true)\n   â”‚   â”œâ”€â–º Verified Users Count (is_verified = true)\n   â”‚   â”œâ”€â–º Email Verified Count\n   â”‚   â”œâ”€â–º Phone Verified Count\n   â”‚   â”œâ”€â–º New Users Today\n   â”‚   â”œâ”€â–º New Users This Week\n   â”‚   â”œâ”€â–º New Users This Month\n   â”‚   â””â”€â–º Users With Sign-in (last_sign_in_at not null)\n   â”‚\n   â””â”€â–º Return Aggregated Statistics\n```\n\n**Metrics Explained:**\n- `total_users`: Total number of registered users\n- `active_users`: Users with `is_active = true`\n- `verified_users`: Users with `is_verified = true`\n- `email_verified`: Users with verified email addresses\n- `phone_verified`: Users with verified phone numbers\n- `new_users.today`: Users created today\n- `new_users.this_week`: Users created in last 7 days\n- `new_users.this_month`: Users created this month\n- `users_with_sign_in`: Users who have signed in at least once\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º User navigates to dashboard page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/dashboard/overview\n\nStep 2: Client sends request\n  GET /{MODE}/dashboard/overview\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display dashboard metrics in UI\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message, log error\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract overview statistics from response.data.overview\n  â”œâ”€â–º Update dashboard cards/widgets with metrics\n  â”œâ”€â–º Format numbers (e.g., 1000 â†’ \"1,000\")\n  â””â”€â–º Display charts/graphs if applicable\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_dashboard\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Calculate date boundaries\n  â”œâ”€â–º today = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)\n  â”œâ”€â–º tomorrow = today + timedelta(days=1)\n  â”œâ”€â–º week_ago = datetime.now() - timedelta(days=7)\n  â””â”€â–º month_start = datetime.now().replace(day=1, hour=0, minute=0, second=0, microsecond=0)\n\nStep 4: Execute database queries\n  â”œâ”€â–º Total Users: SELECT COUNT(*) FROM public.\"user\"\n  â”œâ”€â–º Active Users: SELECT COUNT(*) WHERE is_active = TRUE\n  â”œâ”€â–º Verified Users: SELECT COUNT(*) WHERE is_verified = TRUE\n  â”œâ”€â–º Email Verified: SELECT COUNT(*) WHERE is_email_verified = TRUE\n  â”œâ”€â–º Phone Verified: SELECT COUNT(*) WHERE is_phone_verified = TRUE\n  â”œâ”€â–º New Users Today: SELECT COUNT(*) WHERE created_at >= today AND created_at < tomorrow\n  â”œâ”€â–º New Users Week: SELECT COUNT(*) WHERE created_at >= week_ago\n  â”œâ”€â–º New Users Month: SELECT COUNT(*) WHERE created_at >= month_start\n  â””â”€â–º Users With Sign-in: SELECT COUNT(*) WHERE last_sign_in_at IS NOT NULL\n\nStep 5: Aggregate results\n  â”œâ”€â–º Combine all query results\n  â”œâ”€â–º Structure data into overview object\n  â””â”€â–º Format new_users as nested object\n\nStep 6: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include overview statistics in data.overview\n  â””â”€â–º Return response with user's language preference\n\nStep 7: Error handling\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Error Responses:**\n\n```json\n// 401 - Unauthorized\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Authentication required\",\n  \"error\": {\n    \"code\": \"UNAUTHORIZED\",\n    \"details\": {\n      \"message\": \"Invalid or missing token\"\n    }\n  }\n}\n\n// 403 - Forbidden\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_dashboard\"\n    }\n  }\n}\n\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Dashboard error\",\n  \"error\": {\n    \"code\": \"DASHBOARD_ERROR\",\n    \"details\": {\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n### Users by Status\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-status`\n\n**Description:** Returns count of users grouped by status (ACTIVE, INACTIVE, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by status retrieved successfully\",\n  \"data\": {\n    \"users_by_status\": [\n      { \"status\": \"ACTIVE\", \"count\": 850 },\n      { \"status\": \"INACTIVE\", \"count\": 150 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Status\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['status'] })\n   â”‚\n   â”œâ”€â–º Count Users per Status\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Status Statistics\n```\n\n**Status Values:**\n- `ACTIVE`: Active users\n- `INACTIVE`: Inactive users\n- Other custom statuses as defined in the system\n\n---\n\n### Users by Type\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-type`\n\n**Description:** Returns count of users grouped by user_type (customer, business, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by type retrieved successfully\",\n  \"data\": {\n    \"users_by_type\": [\n      { \"user_type\": \"customer\", \"count\": 800 },\n      { \"user_type\": \"business\", \"count\": 200 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Type\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['user_type'] })\n   â”‚\n   â”œâ”€â–º Count Users per Type\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Type Statistics\n```\n\n**User Types:**\n- `customer`: Regular customers\n- `business`: Business accounts\n- Other custom types as defined in the system\n\n---\n\n### Users by Auth Type\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-auth-type`\n\n**Description:** Returns count of users grouped by authentication type (email, phone, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by auth type retrieved successfully\",\n  \"data\": {\n    \"users_by_auth_type\": [\n      { \"auth_type\": \"email\", \"count\": 600 },\n      { \"auth_type\": \"phone\", \"count\": 400 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Auth Type\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['auth_type'] })\n   â”‚\n   â”œâ”€â–º Count Users per Auth Type\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Auth Type Statistics\n```\n\n**Auth Types:**\n- `email`: Email-based authentication\n- `phone`: Phone-based authentication\n\n---\n\n### Users by Country\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-country`\n\n**Description:** Returns count of users grouped by country (top 20 countries).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by country retrieved successfully\",\n  \"data\": {\n    \"users_by_country\": [\n      { \"country\": \"US\", \"count\": 300 },\n      { \"country\": \"UK\", \"count\": 200 },\n      { \"country\": \"CA\", \"count\": 150 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Country\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['country'], take: 20 })\n   â”‚\n   â”œâ”€â–º Count Users per Country\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Top 20 Countries\n```\n\n**Note:** Returns top 20 countries by user count.\n\n---\n\n### Users by Language\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-language`\n\n**Description:** Returns count of users grouped by language preference.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by language retrieved successfully\",\n  \"data\": {\n    \"users_by_language\": [\n      { \"language\": \"en\", \"count\": 700 },\n      { \"language\": \"ar\", \"count\": 300 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Language\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['language'] })\n   â”‚\n   â”œâ”€â–º Count Users per Language\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Language Statistics\n```\n\n**Language Codes:** ISO 639-1 codes (en, ar, etc.)\n\n---\n\n### User Growth\n\n**Endpoint:** `GET /{MODE}/dashboard/user-growth`\n\n**Description:** Returns user sign-up statistics over time (daily, weekly, monthly).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_dashboard`\n\n**Query Parameters:**\n- `period` (optional): Time period for growth statistics\n  - `daily` (default): Daily growth\n  - `weekly`: Weekly growth\n  - `monthly`: Monthly growth\n- `days` (optional): Number of days to look back (for daily period, default: 30, max: 365)\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Example:**\n```http\nGET /dev/v1/dashboard/user-growth?period=daily&days=30 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User growth statistics retrieved successfully\",\n  \"data\": {\n    \"period\": \"daily\",\n    \"growth\": [\n      { \"period\": \"2025-01-01\", \"count\": 10 },\n      { \"period\": \"2025-01-02\", \"count\": 15 },\n      { \"period\": \"2025-01-03\", \"count\": 12 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º period: daily/weekly/monthly (default: daily)\n   â”‚   â””â”€â–º days: number (default: 30, max: 365)\n   â”‚\n   â”œâ”€â–º Execute Raw SQL Query\n   â”‚   â”œâ”€â–º Daily: DATE(created_at) with last N days\n   â”‚   â”œâ”€â–º Weekly: DATE_TRUNC('week', created_at) with last 12 weeks\n   â”‚   â””â”€â–º Monthly: DATE_TRUNC('month', created_at) with last 12 months\n   â”‚\n   â”œâ”€â–º Format Results\n   â”‚   â””â”€â–º Map to period and count\n   â”‚\n   â””â”€â–º Return Growth Statistics\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º User selects time period (daily/weekly/monthly)\n  â”œâ”€â–º User selects number of days (for daily period)\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Build query string with parameters\n  â””â”€â–º Prepare GET request to /{MODE}/dashboard/user-growth\n\nStep 2: Client sends request\n  GET /{MODE}/dashboard/user-growth?period=daily&days=30\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Process growth data\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract growth array from response.data.growth\n  â”œâ”€â–º Format dates for display\n  â”œâ”€â–º Render line chart or bar chart\n  â””â”€â–º Update UI with growth statistics\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract query parameters (period, days)\n  â””â”€â–º Validate parameters (period: daily/weekly/monthly, days: 1-365)\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_dashboard\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Build SQL query based on period\n  â”œâ”€â–º If period = \"daily\":\n  â”‚   â”œâ”€â–º Limit days to 1-365 range\n  â”‚   â””â”€â–º Query: SELECT DATE(created_at) as date, COUNT(*) \n  â”‚       WHERE created_at >= CURRENT_DATE - INTERVAL '{days} days'\n  â”‚       GROUP BY DATE(created_at) ORDER BY date ASC\n  â”‚\n  â”œâ”€â–º If period = \"weekly\":\n  â”‚   â””â”€â–º Query: SELECT DATE_TRUNC('week', created_at) as week, COUNT(*)\n  â”‚       WHERE created_at >= CURRENT_DATE - INTERVAL '12 weeks'\n  â”‚       GROUP BY DATE_TRUNC('week', created_at) ORDER BY week ASC\n  â”‚\n  â””â”€â–º If period = \"monthly\":\n      â””â”€â–º Query: SELECT DATE_TRUNC('month', created_at) as month, COUNT(*)\n          WHERE created_at >= CURRENT_DATE - INTERVAL '12 months'\n          GROUP BY DATE_TRUNC('month', created_at) ORDER BY month ASC\n\nStep 4: Execute database query\n  â”œâ”€â–º Execute SQL query\n  â”œâ”€â–º Fetch all rows\n  â””â”€â–º Process results\n\nStep 5: Format results\n  â”œâ”€â–º Convert dates to ISO format\n  â”œâ”€â–º Structure as array of {period, count} objects\n  â””â”€â–º Ensure count is integer\n\nStep 6: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include period type and growth array\n  â””â”€â–º Return response with user's language preference\n\nStep 7: Error handling\n  â”œâ”€â–º Invalid parameters: Return 400\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Use Cases:**\n- Growth trend analysis\n- User acquisition metrics\n- Time-series visualization\n- Reporting\n\n---\n\n### Role Statistics\n\n**Endpoint:** `GET /{MODE}/dashboard/role-statistics`\n\n**Description:** Returns count of users by role (admin, business, developer, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Role statistics retrieved successfully\",\n  \"data\": {\n    \"role_statistics\": {\n      \"superusers\": 5,\n      \"admins\": 10,\n      \"business\": 50,\n      \"developers\": 20,\n      \"accountants\": 15,\n      \"regular_users\": 900\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Get All Users\n   â”‚   â””â”€â–º prisma.user.findMany({ select: { user_id: true } })\n   â”‚\n   â”œâ”€â–º For Each User\n   â”‚   â”œâ”€â–º Get User Groups\n   â”‚   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚   â”‚\n   â”‚   â””â”€â–º Count by Group Codename\n   â”‚       â”œâ”€â–º super_admin\n   â”‚       â”œâ”€â–º admin\n   â”‚       â”œâ”€â–º business\n   â”‚       â”œâ”€â–º developer\n   â”‚       â”œâ”€â–º accountant\n   â”‚       â””â”€â–º user\n   â”‚\n   â””â”€â–º Return Role Statistics\n```\n\n**Note:** This endpoint iterates through all users to count roles. For large user bases, consider caching or optimization.\n\n**Roles:**\n- `superusers`: Users with super_admin group\n- `admins`: Users with admin group\n- `business`: Users with business group\n- `developers`: Users with developer group\n- `accountants`: Users with accountant group\n- `regular_users`: Users with user group\n\n---\n\n### Recent Sign-ins\n\n**Endpoint:** `GET /{MODE}/dashboard/recent-sign-ins`\n\n**Description:** Returns users who signed in recently within specified hours.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Query Parameters:**\n- `hours` (optional): Number of hours to look back (default: 24, max: 168)\n\n**Request:**\n```http\nGET /dev/v1/dashboard/recent-sign-ins?hours=24 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Recent sign-in statistics retrieved successfully\",\n  \"data\": {\n    \"recent_sign_ins\": {\n      \"total_with_sign_in\": 600,\n      \"last_hour\": 10,\n      \"last_24_hours\": 100,\n      \"today\": 150\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º hours: number (default: 24, max: 168)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º One Hour Ago\n   â”‚   â”œâ”€â–º N Hours Ago (from query)\n   â”‚   â””â”€â–º Today (00:00:00)\n   â”‚\n   â”œâ”€â–º Execute Parallel Queries\n   â”‚   â”œâ”€â–º Total Users With Sign-in (last_sign_in_at not null)\n   â”‚   â”œâ”€â–º Sign-ins Last Hour\n   â”‚   â”œâ”€â–º Sign-ins Last N Hours\n   â”‚   â””â”€â–º Sign-ins Today\n   â”‚\n   â””â”€â–º Return Sign-in Statistics\n```\n\n**Metrics:**\n- `total_with_sign_in`: Total users who have signed in at least once\n- `last_hour`: Users who signed in within last hour\n- `last_{N}_hours`: Users who signed in within last N hours\n- `today`: Users who signed in today\n\n---\n\n### All Statistics\n\n**Endpoint:** `GET /{MODE}/dashboard/all-statistics`\n\n**Description:** Returns comprehensive dashboard statistics including all metrics from other endpoints.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"All dashboard statistics retrieved successfully\",\n  \"data\": {\n    \"overview\": {\n      \"total_users\": 1000,\n      \"active_users\": 850,\n      \"verified_users\": 800,\n      \"email_verified\": 750,\n      \"phone_verified\": 700,\n      \"new_users\": {\n        \"today\": 10,\n        \"this_week\": 50,\n        \"this_month\": 200\n      }\n    },\n    \"by_status\": [\n      { \"status\": \"ACTIVE\", \"count\": 850 },\n      { \"status\": \"INACTIVE\", \"count\": 150 }\n    ],\n    \"by_type\": [\n      { \"user_type\": \"customer\", \"count\": 800 },\n      { \"user_type\": \"business\", \"count\": 200 }\n    ],\n    \"by_auth_type\": [\n      { \"auth_type\": \"email\", \"count\": 600 },\n      { \"auth_type\": \"phone\", \"count\": 400 }\n    ],\n    \"roles\": {\n      \"superusers\": 5,\n      \"admins\": 10,\n      \"business\": 50,\n      \"developers\": 20,\n      \"accountants\": 15,\n      \"regular_users\": 900\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º Today, Tomorrow, Week Ago, Month Start\n   â”‚\n   â”œâ”€â–º Execute All Queries in Parallel\n   â”‚   â”œâ”€â–º Overview Statistics (9 queries)\n   â”‚   â”œâ”€â–º Users by Status (groupBy)\n   â”‚   â”œâ”€â–º Users by Type (groupBy)\n   â”‚   â”œâ”€â–º Users by Auth Type (groupBy)\n   â”‚   â””â”€â–º Role Statistics (iterate users)\n   â”‚\n   â”œâ”€â–º Aggregate All Results\n   â”‚\n   â””â”€â–º Return Comprehensive Statistics\n```\n\n**Use Cases:**\n- Dashboard initialization\n- Comprehensive reporting\n- Single API call for all metrics\n- Admin panel data loading\n\n---\n\n## Workflows\n\n### Complete Dashboard Data Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Dashboard Statistics Request                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Validate Auth  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Check Permission â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Single Metric â”‚         â”‚ All Metrics   â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Execute Query â”‚         â”‚ Parallel Queriesâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Format Results  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Return Response â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**401 Unauthorized:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Authentication required\",\n  \"error\": \"Invalid or missing token\",\n  \"statusCode\": 401\n}\n```\n\n**403 Forbidden:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires view_dashboard permission\",\n  \"statusCode\": 403\n}\n```\n\n**500 Internal Server Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Dashboard error\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n```\n\n### Error Handling Workflow\n\n```\n1. Error Occurs\n   â”‚\n   â”œâ”€â–º Log Error\n   â”‚   â””â”€â–º Winston Logger with module: 'Dashboard'\n   â”‚\n   â”œâ”€â–º Format Error Response\n   â”‚   â””â”€â–º ERROR.fromMap('DASHBOARD_ERROR')\n   â”‚\n   â””â”€â–º Return Error Response\n       â””â”€â–º Appropriate Status Code\n```\n\n---\n\n## Best Practices\n\n1. **Caching**: Consider caching dashboard statistics for better performance\n2. **Pagination**: For large datasets, implement pagination\n3. **Optimization**: Role statistics endpoint may be slow for large user bases - consider optimization\n4. **Rate Limiting**: Implement rate limiting for dashboard endpoints\n5. **Data Aggregation**: Use database aggregation functions for better performance\n6. **Date Boundaries**: Always use proper date boundaries for time-based queries\n7. **Parallel Queries**: Use Promise.all() for parallel queries when possible\n8. **Error Handling**: Handle database errors gracefully\n\n---\n\n## Performance Considerations\n\n1. **Role Statistics**: This endpoint iterates through all users - consider caching or background jobs\n2. **User Growth**: Raw SQL queries are used for date aggregations - ensure proper indexing\n3. **All Statistics**: Combines multiple queries - may be slower, consider caching\n4. **Database Indexing**: Ensure proper indexes on:\n   - `created_at` (for growth queries)\n   - `last_sign_in_at` (for sign-in queries)\n   - `status`, `user_type`, `auth_type`, `country`, `language` (for groupBy queries)\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for dashboard endpoints\nasync function dashboardRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to view dashboard');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success) {\n    throw new Error(data.error?.message || 'Dashboard request failed');\n  }\n  \n  return data;\n}\n```\n\n### Dashboard Overview\n\n```javascript\n// Get dashboard overview statistics\nasync function getDashboardOverview() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/overview', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const overview = response.data.overview;\n      \n      // Update UI with metrics\n      updateMetricCard('total-users', overview.total_users);\n      updateMetricCard('active-users', overview.active_users);\n      updateMetricCard('verified-users', overview.verified_users);\n      updateMetricCard('email-verified', overview.email_verified);\n      updateMetricCard('phone-verified', overview.phone_verified);\n      updateMetricCard('new-users-today', overview.new_users.today);\n      updateMetricCard('new-users-week', overview.new_users.this_week);\n      updateMetricCard('new-users-month', overview.new_users.this_month);\n      updateMetricCard('users-with-signin', overview.users_with_sign_in);\n      \n      return overview;\n    }\n  } catch (error) {\n    console.error('Error fetching dashboard overview:', error);\n    showError('Failed to load dashboard overview');\n    throw error;\n  }\n}\n\n// Helper function to update metric cards\nfunction updateMetricCard(elementId, value) {\n  const element = document.getElementById(elementId);\n  if (element) {\n    element.textContent = formatNumber(value);\n  }\n}\n\n// Format numbers with commas\nfunction formatNumber(num) {\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n```\n\n### Users by Status\n\n```javascript\n// Get users grouped by status\nasync function getUsersByStatus() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/users-by-status', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const stats = response.data.users_by_status;\n      \n      // Update chart or table\n      renderStatusChart(stats);\n      \n      return stats;\n    }\n  } catch (error) {\n    console.error('Error fetching users by status:', error);\n    showError('Failed to load user status statistics');\n    throw error;\n  }\n}\n\n// Render status chart (example using Chart.js)\nfunction renderStatusChart(stats) {\n  const ctx = document.getElementById('status-chart').getContext('2d');\n  new Chart(ctx, {\n    type: 'pie',\n    data: {\n      labels: stats.map(s => s.status),\n      datasets: [{\n        data: stats.map(s => s.count),\n        backgroundColor: ['#4CAF50', '#F44336', '#FF9800', '#2196F3']\n      }]\n    }\n  });\n}\n```\n\n### User Growth\n\n```javascript\n// Get user growth statistics\nasync function getUserGrowth(period = 'daily', days = 30) {\n  try {\n    const url = `/api/v1/dashboard/user-growth?period=${period}&days=${days}`;\n    const response = await dashboardRequest(url, {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const growth = response.data.growth;\n      \n      // Render growth chart\n      renderGrowthChart(growth, period);\n      \n      return growth;\n    }\n  } catch (error) {\n    console.error('Error fetching user growth:', error);\n    showError('Failed to load user growth statistics');\n    throw error;\n  }\n}\n\n// Render growth line chart\nfunction renderGrowthChart(growth, period) {\n  const ctx = document.getElementById('growth-chart').getContext('2d');\n  new Chart(ctx, {\n    type: 'line',\n    data: {\n      labels: growth.map(g => formatPeriod(g.period, period)),\n      datasets: [{\n        label: 'New Users',\n        data: growth.map(g => g.count),\n        borderColor: '#2196F3',\n        tension: 0.1\n      }]\n    },\n    options: {\n      responsive: true,\n      scales: {\n        y: {\n          beginAtZero: true\n        }\n      }\n    }\n  });\n}\n\n// Format period label based on type\nfunction formatPeriod(period, type) {\n  const date = new Date(period);\n  if (type === 'daily') {\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  } else if (type === 'weekly') {\n    return `Week of ${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;\n  } else {\n    return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n  }\n}\n```\n\n### All Statistics\n\n```javascript\n// Get all dashboard statistics at once\nasync function getAllDashboardStatistics() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/all-statistics', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const stats = response.data;\n      \n      // Update all dashboard sections\n      updateOverviewSection(stats.overview);\n      updateStatusSection(stats.by_status);\n      updateTypeSection(stats.by_type);\n      updateAuthTypeSection(stats.by_auth_type);\n      updateRolesSection(stats.roles);\n      \n      return stats;\n    }\n  } catch (error) {\n    console.error('Error fetching all statistics:', error);\n    showError('Failed to load dashboard statistics');\n    throw error;\n  }\n}\n```\n\n### Complete Dashboard Component\n\n```javascript\n// Complete Dashboard Manager Class\nclass DashboardManager {\n  constructor() {\n    this.stats = null;\n    this.refreshInterval = null;\n  }\n  \n  async init() {\n    try {\n      // Load all statistics on initialization\n      await this.loadAllStatistics();\n      \n      // Set up auto-refresh (every 5 minutes)\n      this.startAutoRefresh(5 * 60 * 1000);\n      \n      // Set up manual refresh button\n      document.getElementById('refresh-dashboard').addEventListener('click', () => {\n        this.loadAllStatistics();\n      });\n    } catch (error) {\n      console.error('Failed to initialize dashboard:', error);\n      showError('Failed to load dashboard');\n    }\n  }\n  \n  async loadAllStatistics() {\n    try {\n      showLoading('Loading dashboard...');\n      \n      const stats = await getAllDashboardStatistics();\n      this.stats = stats;\n      \n      this.renderDashboard();\n      hideLoading();\n    } catch (error) {\n      hideLoading();\n      showError('Failed to load dashboard statistics');\n    }\n  }\n  \n  renderDashboard() {\n    if (!this.stats) return;\n    \n    // Render overview cards\n    this.renderOverviewCards();\n    \n    // Render charts\n    this.renderCharts();\n    \n    // Render tables\n    this.renderTables();\n  }\n  \n  renderOverviewCards() {\n    const overview = this.stats.overview;\n    \n    // Update metric cards\n    document.getElementById('total-users').textContent = formatNumber(overview.total_users);\n    document.getElementById('active-users').textContent = formatNumber(overview.active_users);\n    document.getElementById('verified-users').textContent = formatNumber(overview.verified_users);\n    document.getElementById('new-users-today').textContent = formatNumber(overview.new_users.today);\n  }\n  \n  renderCharts() {\n    // Render status pie chart\n    renderStatusChart(this.stats.by_status);\n    \n    // Render type bar chart\n    renderTypeChart(this.stats.by_type);\n    \n    // Render growth line chart\n    getUserGrowth('daily', 30).then(growth => {\n      renderGrowthChart(growth, 'daily');\n    });\n  }\n  \n  renderTables() {\n    // Render status table\n    renderTable('status-table', this.stats.by_status, ['status', 'count']);\n    \n    // Render type table\n    renderTable('type-table', this.stats.by_type, ['user_type', 'count']);\n  }\n  \n  startAutoRefresh(interval) {\n    this.refreshInterval = setInterval(() => {\n      this.loadAllStatistics();\n    }, interval);\n  }\n  \n  stopAutoRefresh() {\n    if (this.refreshInterval) {\n      clearInterval(this.refreshInterval);\n      this.refreshInterval = null;\n    }\n  }\n}\n\n// Initialize dashboard when page loads\ndocument.addEventListener('DOMContentLoaded', () => {\n  const dashboard = new DashboardManager();\n  dashboard.init();\n});\n```\n\n### Error Handling\n\n```javascript\n// Enhanced error handling for dashboard requests\nasync function dashboardRequestWithRetry(url, options = {}, maxRetries = 3) {\n  let lastError;\n  \n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await dashboardRequest(url, options);\n    } catch (error) {\n      lastError = error;\n      \n      // Don't retry on 401 or 403 errors\n      if (error.message.includes('401') || error.message.includes('403')) {\n        throw error;\n      }\n      \n      // Wait before retry (exponential backoff)\n      await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));\n    }\n  }\n  \n  throw lastError;\n}\n```\n\n### Loading States\n\n```javascript\n// Show loading indicator\nfunction showLoading(message = 'Loading...') {\n  const loader = document.getElementById('dashboard-loader');\n  if (loader) {\n    loader.textContent = message;\n    loader.style.display = 'block';\n  }\n}\n\n// Hide loading indicator\nfunction hideLoading() {\n  const loader = document.getElementById('dashboard-loader');\n  if (loader) {\n    loader.style.display = 'none';\n  }\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('dashboard-error');\n  if (errorDiv) {\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n    \n    // Auto-hide after 5 seconds\n    setTimeout(() => {\n      errorDiv.style.display = 'none';\n    }, 5000);\n  }\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all dashboard analytics endpoints:\n\n### Endpoints Covered:\n1. âœ… **Dashboard Overview** - Comprehensive user statistics\n2. âœ… **Users by Status** - Group users by account status\n3. âœ… **Users by Type** - Group users by user type\n4. âœ… **Users by Auth Type** - Group users by authentication method\n5. âœ… **Users by Country** - Geographic distribution (top 20)\n6. âœ… **Users by Language** - Language preference distribution\n7. âœ… **User Growth** - Time-series growth statistics\n8. âœ… **Recent Sign-ins** - Sign-in activity metrics\n9. âœ… **All Statistics** - Comprehensive dashboard data\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices and performance considerations\n- âœ… Complete client-side implementation examples\n- âœ… Dashboard component examples\n\n### Key Features:\n- **Permission-based access** - All endpoints require `view_dashboard` permission\n- **Comprehensive metrics** - User counts, growth, demographics, and activity\n- **Flexible queries** - Support for different time periods and filters\n- **Performance optimized** - Efficient database queries with proper indexing\n- **Client-side examples** - Ready-to-use JavaScript code for dashboard implementation\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Health",
			"item": [
				{
					"name": "health",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "health & system",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "test-sentry",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/test-sentry",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"test-sentry"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Health & Monitoring Router\n\n> **Complete Documentation for Health Check and System Monitoring Endpoints**\n\nThis router provides endpoints for checking API health status, system information, and testing error tracking integration.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Health Check](#health-check)\n  - [System Health Check](#system-health-check)\n  - [Database Health Check](#database-health-check)\n  - [Storage Health Check](#storage-health-check)\n  - [Test Sentry](#test-sentry)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Client-Side Implementation](#client-side-implementation)\n- [Summary](#summary)\n\n## Overview\n\nThe Health router provides monitoring and diagnostic endpoints that help track the API's operational status. These endpoints are essential for:\n- **Load Balancer Health Checks**: Verify service availability\n- **System Monitoring**: Track resource usage and system metrics\n- **Error Tracking Testing**: Validate Sentry integration\n\n**Base Path:** `/{MODE}/health` or `/health` (for basic health check)\n\n**Authentication:** Most endpoints do not require authentication (except `/test-sentry`)\n\n## Endpoints\n\n### Health Check\n\n**Endpoint:** `GET /health` or `GET /{MODE}/health`\n\n**Description:** Returns the health status of the API service with environment information. This endpoint is typically used by load balancers and monitoring systems.\n\n**Authentication:** Not required\n\n**Request Headers:**\n```\n(No authentication required)\n```\n\n**Request Example:**\n```http\nGET /health HTTP/1.1\nHost: api.example.com\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Service is healthy\",\n  \"data\": {\n    \"status\": \"ok\"\n  },\n  \"meta\": {\n    \"service\": \"fastapi-backend-with-postgresql-api\",\n    \"status\": \"ok\",\n    \"env\": {\n      \"API_VERSION\": \"1.0.0\",\n      \"API_MODE\": \"development\",\n      \"MODE\": \"dev/v1\",\n      \"UTC\": \"UTC\",\n      \"DEBUG_MODE\": \"false\",\n      \"TIMEZONE\": \"UTC\",\n      \"LOG_LEVEL\": \"info\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Extract Environment Variables\n   â”‚   â”œâ”€â–º API_VERSION\n   â”‚   â”œâ”€â–º API_MODE\n   â”‚   â”œâ”€â–º MODE\n   â”‚   â”œâ”€â–º UTC\n   â”‚   â”œâ”€â–º DEBUG_MODE\n   â”‚   â”œâ”€â–º TIMEZONE\n   â”‚   â””â”€â–º LOG_LEVEL\n   â”‚\n   â”œâ”€â–º Build Response\n   â”‚   â”œâ”€â–º Status: \"ok\"\n   â”‚   â””â”€â–º Meta Information\n   â”‚\n   â””â”€â–º Return 200 OK\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Load balancer/monitoring system initiates health check\n  â”œâ”€â–º No authentication required\n  â””â”€â–º Prepare GET request to /health or /{MODE}/health\n\nStep 2: Client sends request\n  GET /health\n  Headers:\n    (No special headers required)\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Service is healthy, continue routing traffic\n  â”œâ”€â–º Error (500): Service unhealthy, remove from load balancer\n  â””â”€â–º Timeout: Service unavailable, mark as down\n\nStep 4: Client processes response\n  â”œâ”€â–º Check response.status === \"ok\"\n  â”œâ”€â–º Verify response time < threshold (e.g., 100ms)\n  â””â”€â–º Update service status in monitoring system\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request received\n  â”œâ”€â–º No authentication validation needed\n  â””â”€â–º Process request immediately\n\nStep 2: Gather environment information\n  â”œâ”€â–º Extract environment variables:\n  â”‚   â”œâ”€â–º API_VERSION\n  â”‚   â”œâ”€â–º API_MODE\n  â”‚   â”œâ”€â–º MODE\n  â”‚   â”œâ”€â–º UTC\n  â”‚   â”œâ”€â–º DEBUG_MODE\n  â”‚   â”œâ”€â–º TIMEZONE\n  â”‚   â””â”€â–º LOG_LEVEL\n  â””â”€â–º Build environment info object\n\nStep 3: Build response\n  â”œâ”€â–º Set status: \"ok\"\n  â”œâ”€â–º Include service name\n  â”œâ”€â–º Include environment information\n  â””â”€â–º Return 200 OK\n\nStep 4: Error handling\n  â”œâ”€â–º If environment variables not accessible: Return 500\n  â””â”€â–º Log any errors for debugging\n```\n\n**Use Cases:**\n- Load balancer health checks\n- Container orchestration health probes\n- Service discovery\n- Monitoring dashboards\n\n---\n\n### System Health Check\n\n**Endpoint:** `GET /{MODE}/health/system`\n\n**Description:** Returns detailed system information including CPU, memory, platform details, and environment configuration. Useful for system administrators and monitoring tools.\n\n**Authentication:** Not required\n\n**Request Headers:**\n```\n(No authentication required)\n```\n\n**Request Example:**\n```http\nGET /dev/v1/health/system HTTP/1.1\nHost: api.example.com\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"System health check completed\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"system_info\": {\n      \"platform\": \"linux\",\n      \"nodeVersion\": \"v18.0.0\",\n      \"cpuCount\": 4,\n      \"memoryTotal\": 8589934592,\n      \"memoryFree\": 4294967296,\n      \"memoryUsed\": 4294967296,\n      \"uptime\": 3600\n    },\n    \"environment\": {\n      \"API_VERSION\": \"1.0.0\",\n      \"API_MODE\": \"development\",\n      \"MODE\": \"dev/v1\",\n      \"DEBUG_MODE\": \"false\",\n      \"LOG_LEVEL\": \"info\"\n    },\n    \"timestamp\": 1704067200000\n  }\n}\n```\n\n**Response Fields:**\n- `system_info.platform`: Operating system platform (Linux, Windows, macOS)\n- `system_info.python_version`: Python version\n- `system_info.cpu_count`: Number of CPU cores\n- `system_info.memory_total`: Total system memory in bytes\n- `system_info.memory_available`: Available memory in bytes\n- `system_info.memory_percent`: Memory usage percentage\n- `system_info.disk_usage`: Disk usage percentage\n- `environment`: Environment configuration variables\n- `timestamp`: Unix timestamp of the check\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Monitoring system or admin dashboard initiates check\n  â”œâ”€â–º No authentication required\n  â””â”€â–º Prepare GET request to /{MODE}/health/system\n\nStep 2: Client sends request\n  GET /{MODE}/health/system\n  Headers:\n    (No special headers required)\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Process system information\n  â”œâ”€â–º Error (500): Log error, show error message\n  â””â”€â–º Timeout: Mark service as unavailable\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract system_info from response.data\n  â”œâ”€â–º Format memory values (bytes â†’ MB/GB)\n  â”œâ”€â–º Display CPU, memory, disk usage\n  â”œâ”€â–º Update monitoring dashboard\n  â””â”€â–º Alert if thresholds exceeded\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request received\n  â”œâ”€â–º No authentication validation needed\n  â””â”€â–º Process request immediately\n\nStep 2: Gather system information\n  â”œâ”€â–º Import psutil and platform modules\n  â”œâ”€â–º Get platform information:\n  â”‚   â”œâ”€â–º platform.platform() - OS platform\n  â”‚   â””â”€â–º platform.python_version() - Python version\n  â”œâ”€â–º Get CPU information:\n  â”‚   â””â”€â–º psutil.cpu_count() - Number of CPU cores\n  â”œâ”€â–º Get memory information:\n  â”‚   â”œâ”€â–º psutil.virtual_memory().total - Total memory\n  â”‚   â”œâ”€â–º psutil.virtual_memory().available - Available memory\n  â”‚   â””â”€â–º psutil.virtual_memory().percent - Memory usage %\n  â””â”€â–º Get disk information:\n      â””â”€â–º psutil.disk_usage('/').percent - Disk usage %\n\nStep 3: Gather environment information\n  â”œâ”€â–º Extract environment variables:\n  â”‚   â”œâ”€â–º API_VERSION\n  â”‚   â”œâ”€â–º API_MODE\n  â”‚   â”œâ”€â–º MODE\n  â”‚   â”œâ”€â–º DEBUG_MODE\n  â”‚   â””â”€â–º LOG_LEVEL\n  â””â”€â–º Build environment info object\n\nStep 4: Build response\n  â”œâ”€â–º Set status: \"healthy\"\n  â”œâ”€â–º Include system_info object\n  â”œâ”€â–º Include environment information\n  â”œâ”€â–º Add timestamp\n  â””â”€â–º Return 200 OK\n\nStep 5: Error handling\n  â”œâ”€â–º If psutil not available: Return error\n  â”œâ”€â–º If system info gathering fails: Return 500\n  â””â”€â–º Log errors for debugging\n```\n\n**Workflow:**\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Gather System Information\n   â”‚   â”œâ”€â–º Platform (process.platform)\n   â”‚   â”œâ”€â–º Node.js Version (process.version)\n   â”‚   â”œâ”€â–º CPU Count (os.cpus().length)\n   â”‚   â”œâ”€â–º Memory Stats (os.totalmem(), os.freemem())\n   â”‚   â””â”€â–º System Uptime (os.uptime())\n   â”‚\n   â”œâ”€â–º Gather Environment Info\n   â”‚   â”œâ”€â–º API_VERSION\n   â”‚   â”œâ”€â–º API_MODE\n   â”‚   â”œâ”€â–º MODE\n   â”‚   â”œâ”€â–º DEBUG_MODE\n   â”‚   â””â”€â–º LOG_LEVEL\n   â”‚\n   â”œâ”€â–º Calculate Memory Usage\n   â”‚   â””â”€â–º memoryUsed = totalmem - freemem\n   â”‚\n   â”œâ”€â–º Build Response\n   â”‚   â”œâ”€â–º Status: \"healthy\"\n   â”‚   â”œâ”€â–º System Information\n   â”‚   â”œâ”€â–º Environment Information\n   â”‚   â””â”€â–º Timestamp\n   â”‚\n   â””â”€â–º Return 200 OK\n```\n\n**Use Cases:**\n- System resource monitoring\n- Performance analysis\n- Capacity planning\n- Troubleshooting system issues\n\n---\n\n### Test Sentry\n\n**Endpoint:** `GET /{MODE}/health/test-sentry`\n\n**Description:** Intentionally triggers different types of errors to test Sentry error tracking integration. Useful for validating error monitoring setup.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `test_sentry`\n\n**Query Parameters:**\n- `type` (optional): Type of error to test\n  - `exception` (default): Manual exception capture\n  - `message`: Manual message capture\n  - `unhandled`: Unhandled error (caught by error handler)\n  - `async`: Async error\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Example:**\n```http\nGET /dev/v1/health/test-sentry?type=exception HTTP/1.1\nHost: api.example.com\nAuthorization: Bearer <token>\n```\n\n**Response (Exception Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test exception sent to Sentry\",\n  \"data\": {\n    \"type\": \"exception\",\n    \"environment\": \"development\",\n    \"message\": \"Check your Sentry dashboard for the error\",\n    \"error\": \"Test Sentry Exception - This is a test error\"\n  }\n}\n```\n\n**Response (Message Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test message sent to Sentry\",\n  \"data\": {\n    \"type\": \"message\",\n    \"environment\": \"development\",\n    \"message\": \"Check your Sentry dashboard for the message\"\n  }\n}\n```\n\n**Response (Async Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test async error scheduled\",\n  \"data\": {\n    \"type\": \"async\",\n    \"environment\": \"development\",\n    \"message\": \"Async error will be sent to Sentry in 100ms\"\n  }\n}\n```\n\n**Workflow (Exception Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"exception\" (default)\n   â”‚\n   â”œâ”€â–º Set Sentry User Context\n   â”‚   â””â”€â–º If user available, set user info\n   â”‚\n   â”œâ”€â–º Add Breadcrumb\n   â”‚   â””â”€â–º Log test initiation\n   â”‚\n   â”œâ”€â–º Create Test Error\n   â”‚   â”œâ”€â–º Error Name: \"SentryTestError\"\n   â”‚   â””â”€â–º Error Message: \"Test Sentry Exception...\"\n   â”‚\n   â”œâ”€â–º Capture Exception in Sentry\n   â”‚   â”œâ”€â–º Add Tags (test_type, environment, endpoint)\n   â”‚   â””â”€â–º Add Extra Data (query, userAgent, IP)\n   â”‚\n   â””â”€â–º Return 200 OK with Success Message\n```\n\n**Workflow (Unhandled Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"unhandled\"\n   â”‚\n   â”œâ”€â–º Throw Error\n   â”‚   â””â”€â–º \"Test Unhandled Error...\"\n   â”‚\n   â”œâ”€â–º Error Handler Catches\n   â”‚   â”œâ”€â–º Log Error\n   â”‚   â”œâ”€â–º Capture in Sentry\n   â”‚   â””â”€â–º Format Error Response\n   â”‚\n   â””â”€â–º Return 500 with Error Details\n```\n\n**Workflow (Async Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"async\"\n   â”‚\n   â”œâ”€â–º Schedule Async Error\n   â”‚   â””â”€â–º setTimeout(() => {\n   â”‚       â””â”€â–º Capture Exception in Sentry\n   â”‚   }, 100)\n   â”‚\n   â””â”€â–º Return 200 OK Immediately\n       â””â”€â–º Error sent to Sentry after 100ms\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Admin/developer wants to test Sentry integration\n  â”œâ”€â–º Select error type (exception, message, unhandled, async)\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare GET request with query parameter\n\nStep 2: Client sends request\n  GET /{MODE}/health/test-sentry?type=exception\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Check Sentry dashboard for error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Error was captured (for unhandled type)\n\nStep 4: Client processes response\n  â”œâ”€â–º Display success message\n  â”œâ”€â–º Show link to Sentry dashboard\n  â””â”€â–º Verify error appears in Sentry\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract query parameter (type)\n  â””â”€â–º Validate type parameter (exception, message, unhandled, async)\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"test_sentry\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Set Sentry context\n  â”œâ”€â–º Set user context (user_id, email)\n  â”œâ”€â–º Add breadcrumb with test initiation info\n  â””â”€â–º Set environment from API_MODE\n\nStep 4: Execute test based on type\n  â”œâ”€â–º If type = \"exception\":\n  â”‚   â”œâ”€â–º Create test exception\n  â”‚   â”œâ”€â–º Capture exception in Sentry with tags and extra data\n  â”‚   â””â”€â–º Return success response\n  â”‚\n  â”œâ”€â–º If type = \"message\":\n  â”‚   â”œâ”€â–º Capture warning message in Sentry\n  â”‚   â””â”€â–º Return success response\n  â”‚\n  â”œâ”€â–º If type = \"unhandled\":\n  â”‚   â”œâ”€â–º Throw exception (will be caught by error handler)\n  â”‚   â””â”€â–º Error handler captures in Sentry and returns 500\n  â”‚\n  â””â”€â–º If type = \"async\":\n      â”œâ”€â–º Schedule async task to capture error after 100ms\n      â””â”€â–º Return success response immediately\n\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include test type and environment\n  â”œâ”€â–º Include message to check Sentry dashboard\n  â””â”€â–º Return response\n\nStep 6: Error handling\n  â”œâ”€â–º Invalid type: Return 400\n  â”œâ”€â–º Permission denied: Return 403\n  â”œâ”€â–º Token invalid: Return 401\n  â””â”€â–º Other errors: Log and return 500\n```\n\n**Error Types:**\n\n1. **Exception**: Manually captures an exception with context\n2. **Message**: Sends a warning message to Sentry\n3. **Unhandled**: Throws an error that gets caught by the global error handler\n4. **Async**: Schedules an async error to test async error tracking\n\n**Use Cases:**\n- Testing Sentry integration\n- Validating error tracking setup\n- Debugging error monitoring\n- Verifying error context capture\n\n---\n\n### Database Health Check\n\n**Endpoint:** `GET /{MODE}/health/database`\n\n**Description:** Checks database connectivity and response time. Returns database status and connection metrics.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_system_health`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Database is healthy\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"message\": \"Database connection is working\",\n    \"response_time\": 2.45,\n    \"database_type\": \"PostgreSQL\"\n  }\n}\n```\n\n**Error Response (503 Service Unavailable):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Database is unhealthy\",\n  \"error\": {\n    \"code\": \"DATABASE_UNHEALTHY\",\n    \"details\": {\n      \"status\": \"error\",\n      \"message\": \"Database check failed: Connection refused\",\n      \"error\": \"Connection refused\"\n    }\n  }\n}\n```\n\n---\n\n### Storage Health Check\n\n**Endpoint:** `GET /{MODE}/health/storage`\n\n**Description:** Checks Google Cloud Storage connectivity and status. Returns storage service metrics.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_system_health`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Storage is healthy\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"message\": \"Google Cloud Storage is working\",\n    \"response_time\": 150.23,\n    \"bucket_name\": \"my-bucket\",\n    \"blob_count\": 1,\n    \"storage_class\": \"ProfessionalMediaStorage\"\n  }\n}\n```\n\n**Error Response (503 Service Unavailable):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Storage is unhealthy\",\n  \"error\": {\n    \"code\": \"STORAGE_UNHEALTHY\",\n    \"details\": {\n      \"status\": \"error\",\n      \"message\": \"GCS connection failed\",\n      \"error\": \"Bucket not found\"\n    }\n  }\n}\n```\n\n---\n\n## Workflows\n\n### Complete Health Check Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Health Check Request                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Determine Endpoint Type                        â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚\nâ”‚  â”‚ Basic Health â”‚  â”‚ System Info  â”‚  â”‚ Test Sentry  â”‚       â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â”‚                  â”‚                  â”‚\n          â–¼                  â–¼                  â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Gather Env Vars â”‚ â”‚ Gather Sys Info â”‚ â”‚ Validate Auth   â”‚\nâ”‚ Return Status   â”‚ â”‚ Calculate Memoryâ”‚ â”‚ Test Error Type â”‚\nâ”‚                 â”‚ â”‚ Return Metrics  â”‚ â”‚ Capture Sentry  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â”‚                  â”‚                  â”‚\n          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Return Response                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Error Handling\n\n### Health Check Errors\n\n**500 Internal Server Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Health check failed\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n```\n\n**Common Error Scenarios:**\n- Environment variables not accessible\n- System information gathering fails\n- Sentry configuration issues (for test-sentry endpoint)\n\n### Error Handling Workflow\n\n```\n1. Error Occurs\n   â”‚\n   â”œâ”€â–º Log Error\n   â”‚   â””â”€â–º Winston Logger\n   â”‚\n   â”œâ”€â–º Capture in Sentry (if applicable)\n   â”‚   â””â”€â–º captureException()\n   â”‚\n   â”œâ”€â–º Format Error Response\n   â”‚   â””â”€â–º ERROR.fromMap()\n   â”‚\n   â””â”€â–º Return Error Response\n       â””â”€â–º Appropriate Status Code\n```\n\n---\n\n## Best Practices\n\n1. **Use Basic Health Check for Load Balancers**: The `/health` endpoint is lightweight and perfect for frequent health checks\n2. **Use System Health for Monitoring**: The `/health/system` endpoint provides detailed metrics for monitoring dashboards\n3. **Test Sentry Regularly**: Use `/test-sentry` to validate error tracking is working correctly\n4. **Monitor Response Times**: Health checks should respond quickly (< 100ms)\n5. **Cache System Info**: Consider caching system information if called frequently\n6. **Secure Test Endpoint**: The test-sentry endpoint requires authentication to prevent abuse\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for health endpoints\nasync function healthRequest(url, options = {}) {\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Add token if endpoint requires authentication\n  const token = getAuthToken();\n  if (token && url.includes('/test-sentry') || url.includes('/database') || url.includes('/storage')) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to access this endpoint');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success && response.status >= 400) {\n    throw new Error(data.error?.message || 'Health check failed');\n  }\n  \n  return data;\n}\n```\n\n### Basic Health Check\n\n```javascript\n// Check basic API health (no authentication required)\nasync function checkHealth() {\n  try {\n    const response = await fetch('/health', {\n      method: 'GET'\n    });\n    \n    const data = await response.json();\n    \n    if (data.success && data.data.status === 'ok') {\n      console.log('Service is healthy');\n      return {\n        healthy: true,\n        status: data.data.status,\n        environment: data.meta.env\n      };\n    } else {\n      console.error('Service is unhealthy');\n      return {\n        healthy: false,\n        status: 'error'\n      };\n    }\n  } catch (error) {\n    console.error('Health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Use in load balancer or monitoring\nsetInterval(async () => {\n  const health = await checkHealth();\n  if (!health.healthy) {\n    console.error('Service is down!');\n    // Alert monitoring system\n  }\n}, 30000); // Check every 30 seconds\n```\n\n### System Health Check\n\n```javascript\n// Get detailed system information\nasync function getSystemHealth() {\n  try {\n    const response = await fetch('/api/v1/health/system', {\n      method: 'GET'\n    });\n    \n    const data = await response.json();\n    \n    if (data.success && data.data) {\n      const systemInfo = data.data.system_info;\n      \n      // Format memory values\n      const formatBytes = (bytes) => {\n        if (bytes === 0) return '0 Bytes';\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n      };\n      \n      return {\n        healthy: true,\n        platform: systemInfo.platform,\n        pythonVersion: systemInfo.python_version,\n        cpuCount: systemInfo.cpu_count,\n        memory: {\n          total: formatBytes(systemInfo.memory_total),\n          available: formatBytes(systemInfo.memory_available),\n          percent: systemInfo.memory_percent\n        },\n        diskUsage: systemInfo.disk_usage,\n        environment: data.data.environment\n      };\n    }\n  } catch (error) {\n    console.error('System health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Display system health in dashboard\nasync function displaySystemHealth() {\n  const health = await getSystemHealth();\n  \n  if (health.healthy) {\n    document.getElementById('cpu-count').textContent = health.cpuCount;\n    document.getElementById('memory-total').textContent = health.memory.total;\n    document.getElementById('memory-available').textContent = health.memory.available;\n    document.getElementById('memory-percent').textContent = `${health.memory.percent}%`;\n    document.getElementById('disk-usage').textContent = `${health.diskUsage}%`;\n    \n    // Alert if memory or disk usage is high\n    if (health.memory.percent > 80) {\n      showWarning('Memory usage is high: ' + health.memory.percent + '%');\n    }\n    if (health.diskUsage > 80) {\n      showWarning('Disk usage is high: ' + health.diskUsage + '%');\n    }\n  }\n}\n```\n\n### Database Health Check\n\n```javascript\n// Check database connectivity\nasync function checkDatabaseHealth() {\n  try {\n    const response = await healthRequest('/api/v1/health/database', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const dbHealth = response.data;\n      \n      return {\n        healthy: dbHealth.status === 'healthy',\n        status: dbHealth.status,\n        message: dbHealth.message,\n        responseTime: dbHealth.response_time,\n        databaseType: dbHealth.database_type\n      };\n    }\n  } catch (error) {\n    console.error('Database health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Display database health status\nasync function displayDatabaseHealth() {\n  const health = await checkDatabaseHealth();\n  \n  const statusElement = document.getElementById('db-status');\n  if (statusElement) {\n    statusElement.textContent = health.healthy ? 'Healthy' : 'Unhealthy';\n    statusElement.className = health.healthy ? 'status-healthy' : 'status-unhealthy';\n    \n    if (health.responseTime) {\n      document.getElementById('db-response-time').textContent = \n        `${health.responseTime}ms`;\n    }\n  }\n}\n```\n\n### Storage Health Check\n\n```javascript\n// Check storage connectivity\nasync function checkStorageHealth() {\n  try {\n    const response = await healthRequest('/api/v1/health/storage', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const storageHealth = response.data;\n      \n      return {\n        healthy: storageHealth.status === 'healthy',\n        status: storageHealth.status,\n        message: storageHealth.message,\n        responseTime: storageHealth.response_time,\n        bucketName: storageHealth.bucket_name,\n        blobCount: storageHealth.blob_count\n      };\n    }\n  } catch (error) {\n    console.error('Storage health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n```\n\n### Test Sentry\n\n```javascript\n// Test Sentry error tracking\nasync function testSentry(type = 'exception') {\n  try {\n    const response = await healthRequest(\n      `/api/v1/health/test-sentry?type=${type}`,\n      {\n        method: 'GET'\n      }\n    );\n    \n    if (response && response.data) {\n      const testResult = response.data;\n      \n      showNotification(\n        `Test ${testResult.type} sent to Sentry. Check your Sentry dashboard.`\n      );\n      \n      // Open Sentry dashboard in new tab\n      const sentryUrl = 'https://sentry.io/organizations/your-org/issues/';\n      window.open(sentryUrl, '_blank');\n      \n      return testResult;\n    }\n  } catch (error) {\n    console.error('Sentry test failed:', error);\n    showError('Failed to test Sentry: ' + error.message);\n    throw error;\n  }\n}\n\n// Test different error types\nasync function testAllSentryTypes() {\n  const types = ['exception', 'message', 'unhandled', 'async'];\n  \n  for (const type of types) {\n    console.log(`Testing Sentry type: ${type}`);\n    try {\n      await testSentry(type);\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second\n    } catch (error) {\n      console.error(`Failed to test ${type}:`, error);\n    }\n  }\n}\n```\n\n### Complete Health Monitor Component\n\n```javascript\n// Complete Health Monitor Class\nclass HealthMonitor {\n  constructor() {\n    this.healthStatus = {\n      api: null,\n      system: null,\n      database: null,\n      storage: null\n    };\n    this.monitoringInterval = null;\n  }\n  \n  async init() {\n    try {\n      // Initial health check\n      await this.checkAll();\n      \n      // Set up auto-refresh (every 60 seconds)\n      this.startMonitoring(60 * 1000);\n    } catch (error) {\n      console.error('Failed to initialize health monitor:', error);\n    }\n  }\n  \n  async checkAll() {\n    try {\n      showLoading('Checking system health...');\n      \n      // Check all health endpoints in parallel\n      const [apiHealth, systemHealth, dbHealth, storageHealth] = await Promise.allSettled([\n        checkHealth(),\n        getSystemHealth(),\n        checkDatabaseHealth(),\n        checkStorageHealth()\n      ]);\n      \n      this.healthStatus.api = apiHealth.status === 'fulfilled' ? apiHealth.value : null;\n      this.healthStatus.system = systemHealth.status === 'fulfilled' ? systemHealth.value : null;\n      this.healthStatus.database = dbHealth.status === 'fulfilled' ? dbHealth.value : null;\n      this.healthStatus.storage = storageHealth.status === 'fulfilled' ? storageHealth.value : null;\n      \n      this.renderHealthStatus();\n      hideLoading();\n    } catch (error) {\n      hideLoading();\n      console.error('Health check failed:', error);\n      showError('Failed to check system health');\n    }\n  }\n  \n  renderHealthStatus() {\n    // Render API health\n    this.renderStatus('api-status', this.healthStatus.api);\n    \n    // Render system health\n    if (this.healthStatus.system) {\n      this.renderSystemMetrics(this.healthStatus.system);\n    }\n    \n    // Render database health\n    this.renderStatus('db-status', this.healthStatus.database);\n    \n    // Render storage health\n    this.renderStatus('storage-status', this.healthStatus.storage);\n  }\n  \n  renderStatus(elementId, health) {\n    const element = document.getElementById(elementId);\n    if (element && health) {\n      element.textContent = health.healthy ? 'Healthy' : 'Unhealthy';\n      element.className = health.healthy ? 'status-healthy' : 'status-unhealthy';\n    }\n  }\n  \n  renderSystemMetrics(system) {\n    if (system.healthy) {\n      document.getElementById('cpu-count').textContent = system.cpuCount;\n      document.getElementById('memory-percent').textContent = `${system.memory.percent}%`;\n      document.getElementById('disk-usage').textContent = `${system.diskUsage}%`;\n      \n      // Update progress bars\n      this.updateProgressBar('memory-bar', system.memory.percent);\n      this.updateProgressBar('disk-bar', system.diskUsage);\n    }\n  }\n  \n  updateProgressBar(elementId, percent) {\n    const bar = document.getElementById(elementId);\n    if (bar) {\n      bar.style.width = `${percent}%`;\n      bar.className = percent > 80 ? 'progress-bar-danger' : \n                     percent > 60 ? 'progress-bar-warning' : \n                     'progress-bar-success';\n    }\n  }\n  \n  startMonitoring(interval) {\n    this.monitoringInterval = setInterval(() => {\n      this.checkAll();\n    }, interval);\n  }\n  \n  stopMonitoring() {\n    if (this.monitoringInterval) {\n      clearInterval(this.monitoringInterval);\n      this.monitoringInterval = null;\n    }\n  }\n}\n\n// Initialize health monitor\ndocument.addEventListener('DOMContentLoaded', () => {\n  const healthMonitor = new HealthMonitor();\n  healthMonitor.init();\n});\n```\n\n### Error Handling\n\n```javascript\n// Enhanced error handling for health checks\nasync function healthCheckWithRetry(url, maxRetries = 3) {\n  let lastError;\n  \n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await healthRequest(url, { method: 'GET' });\n    } catch (error) {\n      lastError = error;\n      \n      // Don't retry on 401 or 403 errors\n      if (error.message.includes('401') || error.message.includes('403')) {\n        throw error;\n      }\n      \n      // Wait before retry (exponential backoff)\n      await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));\n    }\n  }\n  \n  throw lastError;\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all health and monitoring endpoints:\n\n### Endpoints Covered:\n1. âœ… **Health Check** - Basic API health status (public)\n2. âœ… **System Health Check** - Detailed system information (public)\n3. âœ… **Database Health Check** - Database connectivity check (authenticated)\n4. âœ… **Storage Health Check** - Google Cloud Storage check (authenticated)\n5. âœ… **Test Sentry** - Sentry error tracking test (authenticated)\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices\n- âœ… Complete client-side implementation examples\n- âœ… Health monitoring component examples\n\n### Key Features:\n- **Public endpoints** - Basic and system health checks don't require authentication\n- **Authenticated endpoints** - Database, storage, and Sentry test require permissions\n- **Comprehensive monitoring** - System metrics, database status, storage connectivity\n- **Error tracking** - Sentry integration testing\n- **Client-side examples** - Ready-to-use JavaScript code for health monitoring\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Upload Media",
			"item": [
				{
					"name": "upload-media",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
								},
								{
									"key": "url",
									"value": "",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/upload-media",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"upload-media"
							]
						}
					},
					"response": []
				},
				{
					"name": "delete-media",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": []
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/delete-media?url=https://storage.googleapis.com/klikyai-v3-bucket/UserProfile/mrdasdeveloper-d7232df3-cffd-4f9c-b8a8-6f5a3de5d304-%7C-d56522e9-5596-431f-876d-3d34f1e8293d.jpeg",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"delete-media"
							],
							"query": [
								{
									"key": "url",
									"value": "https://storage.googleapis.com/klikyai-v3-bucket/UserProfile/mrdasdeveloper-d7232df3-cffd-4f9c-b8a8-6f5a3de5d304-%7C-d56522e9-5596-431f-876d-3d34f1e8293d.jpeg"
								}
							]
						}
					},
					"response": []
				}
			],
			"description": "# File Upload Router\n\n> **Complete Documentation for Media File Upload and Management Endpoints** \n  \n\nThis router handles file upload operations including uploading files from URLs or direct file uploads to Google Cloud Storage, and deleting uploaded files.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    - [Upload Media](#upload-media)\n        \n    - [Delete Media](#delete-media)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n- [Client-Side Implementation](#client-side-implementation)\n    \n- [Summary](#summary)\n    \n\n## Overview\n\nThe File Upload router provides comprehensive media file management functionality including:\n\n- **File Upload**: Upload files directly or from URLs to Google Cloud Storage\n    \n- **File Deletion**: Delete files from Google Cloud Storage\n    \n- **Multiple Formats**: Support for images, documents, videos, and other file types\n    \n- **Size Limits**: 15MB maximum file size\n    \n- **Automatic Processing**: Automatic file type detection and content type handling\n    \n\n**Base Path:** `/{MODE}/upload-media`, `/{MODE}/delete-media`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:**\n\n- Upload: `add_upload` permission\n    \n- Delete: `delete_upload` permission\n    \n\n## Endpoints\n\n### Upload Media\n\n**Endpoint:** `POST /{MODE}/upload-media`\n\n**Description:** Upload a media file either from URL or direct file upload to Google Cloud Storage.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `add_upload`\n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\nContent-Type: multipart/form-data (for file upload)\n# OR\nContent-Type: application/x-www-form-urlencoded (for URL upload)\n# OR\nX-Session-Token: <session_token>\n\n ```\n\n**Request Options:**\n\n**Option 1: Direct File Upload (Multipart Form Data)**\n\n``` http\nPOST /dev/v1/upload-media HTTP/1.1\nAuthorization: Bearer <token>\nContent-Type: multipart/form-data\nfile: [binary file data]\n\n ```\n\n**Option 2: Upload from URL (Form Data)**\n\n``` http\nPOST /dev/v1/upload-media HTTP/1.1\nAuthorization: Bearer <token>\nContent-Type: application/x-www-form-urlencoded\nurl: https://example.com/image.jpg\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"File uploaded successfully\",\n  \"data\": {\n    \"url\": \"https://storage.googleapis.com/bucket-name/media/users/user-uuid-file.jpg\"\n  }\n}\n\n ```\n\n**Workflow (Direct File Upload):**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check file or url exists\n   â”‚\n   â”œâ”€â–º Process File Upload\n   â”‚   â”œâ”€â–º Extract file buffer\n   â”‚   â”œâ”€â–º Get file extension from filename\n   â”‚   â””â”€â–º Get content type from mimetype\n   â”‚\n   â”œâ”€â–º Generate Object Key\n   â”‚   â””â”€â–º {userId}-|-{uuid}.{extension}\n   â”‚\n   â”œâ”€â–º Upload to Google Cloud Storage\n   â”‚   â”œâ”€â–º Folder: media/users\n   â”‚   â”œâ”€â–º Object Key: generated key\n   â”‚   â””â”€â–º uploadToGoogleStorageFromString()\n   â”‚\n   â””â”€â–º Return Public URL\n\n ```\n\n**Workflow (Upload from URL):**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check url exists\n   â”‚\n   â”œâ”€â–º Download File from URL\n   â”‚   â”œâ”€â–º axios.get(url, { responseType: 'arraybuffer' })\n   â”‚   â”œâ”€â–º Max size: 15MB\n   â”‚   â””â”€â–º Convert to Buffer\n   â”‚\n   â”œâ”€â–º Extract File Information\n   â”‚   â”œâ”€â–º Extension from URL or Content-Type header\n   â”‚   â””â”€â–º Content type from response headers\n   â”‚\n   â”œâ”€â–º Generate Object Key\n   â”‚   â””â”€â–º {userId}-|-{uuid}.{extension}\n   â”‚\n   â”œâ”€â–º Upload to Google Cloud Storage\n   â”‚   â””â”€â–º uploadToGoogleStorageFromString()\n   â”‚\n   â””â”€â–º Return Public URL\n\n ```\n\n**Supported File Types:**\n\n- Images: jpg, jpeg, png, gif, webp, svg\n    \n- Documents: pdf, doc, docx, txt\n    \n- Videos: mp4, avi, mov, webm\n    \n- Other: Based on content type\n    \n\n**File Size Limit:** 15MB maximum\n\n**Storage Location:**\n\n- Folder: `media/users`\n    \n- Object Key Format: `{userId}-|-{uuid}.{extension}`\n    \n- Public URL: `https://storage.googleapis.com/{bucket-name}/media/users/{object-key}`\n    \n\n**Client-Server Communication Flow (Direct File Upload):**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User selects file\n  â”œâ”€â–º User clicks \"Choose File\" button\n  â”œâ”€â–º File picker opens\n  â””â”€â–º User selects file (image, document, video, etc.)\nStep 2: Client validates file\n  â”œâ”€â–º Check file size (must be < 15MB)\n  â”œâ”€â–º Check file type (optional validation)\n  â”œâ”€â–º Optionally: Preview file before upload\n  â””â”€â–º Show upload progress indicator\nStep 3: Client prepares request\n  â”œâ”€â–º Create FormData object\n  â”œâ”€â–º Append file to FormData with key \"file\"\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with multipart/form-data\nStep 4: Client sends request\n  POST /{MODE}/upload-media\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: multipart/form-data\n  Body:\n    file: <File object>\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Display uploaded file URL, show success message\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â”œâ”€â–º Payload Too Large (413): Show file size error\n  â””â”€â–º Error (500): Show error message\nStep 6: Client processes response\n  â”œâ”€â–º Extract public URL from response.data.url\n  â”œâ”€â–º Store URL for later use\n  â”œâ”€â–º Display uploaded file (if image, show preview)\n  â””â”€â–º Update UI with uploaded file information\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Check permission: \"add_upload\"\n  â””â”€â–º Validate request has either file or url\nStep 2: File processing (if file provided)\n  â”œâ”€â–º Read file data from request\n  â”œâ”€â–º Extract file extension from filename\n  â”œâ”€â–º Get content type from file.content_type\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\nStep 3: URL processing (if url provided)\n  â”œâ”€â–º Download file from URL using httpx\n  â”œâ”€â–º Check response status (raise_for_status)\n  â”œâ”€â–º Get file data from response.content\n  â”œâ”€â–º Extract extension from URL or Content-Type header\n  â”œâ”€â–º Get content type from response headers\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\nStep 4: Upload to Google Cloud Storage\n  â”œâ”€â–º Set folder: \"media/users\"\n  â”œâ”€â–º Upload file using upload_to_google_storage_from_string()\n  â”œâ”€â–º Set content type\n  â”œâ”€â–º Make file publicly accessible\n  â””â”€â–º Get public URL\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include public URL in data.url\n  â””â”€â–º Return response with user's language preference\nStep 6: Error handling\n  â”œâ”€â–º No file or URL: Return 400\n  â”œâ”€â–º File too large: Return 413\n  â”œâ”€â–º Download error: Return 500\n  â”œâ”€â–º Upload error: Return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n\n ```\n\n**Client-Server Communication Flow (Upload from URL):**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User enters URL\n  â”œâ”€â–º User enters file URL in input field\n  â”œâ”€â–º User clicks \"Upload from URL\" button\n  â””â”€â–º Client validates URL format\nStep 2: Client validates URL\n  â”œâ”€â–º Check URL format (http:// or https://)\n  â”œâ”€â–º Optionally: Preview file from URL\n  â””â”€â–º Show loading indicator\nStep 3: Client sends request\n  POST /{MODE}/upload-media\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/x-www-form-urlencoded\n  Body:\n    url: https://example.com/image.jpg\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Display uploaded file URL\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Check permission: \"add_upload\"\n  â””â”€â–º Validate url parameter exists\nStep 2: Download file from URL\n  â”œâ”€â–º Create httpx AsyncClient\n  â”œâ”€â–º GET request to URL with responseType: 'arraybuffer'\n  â”œâ”€â–º Check response status\n  â”œâ”€â–º Get file data from response.content\n  â””â”€â–º Handle download errors\nStep 3: Extract file information\n  â”œâ”€â–º Get extension from URL (split by '.')\n  â”œâ”€â–º If no extension, get from Content-Type header\n  â”œâ”€â–º Get content type from response headers\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\nStep 4: Upload to Google Cloud Storage\n  â”œâ”€â–º Set folder: \"media/users\"\n  â”œâ”€â–º Upload file using upload_to_google_storage_from_string()\n  â””â”€â–º Get public URL\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include public URL in data.url\n  â””â”€â–º Return response\nStep 6: Error handling\n  â”œâ”€â–º Invalid URL: Return 400\n  â”œâ”€â–º Download failed: Return 500\n  â”œâ”€â–º Upload error: Return 500\n  â””â”€â–º Permission denied: Return 403\n\n ```\n\n**Error Responses:**\n\n``` json\n// 400 - No File or URL\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"File or URL required\",\n  \"error\": {\n    \"code\": \"MEDIA_FILE_OR_URL\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"message\": \"Either file or url must be provided\"\n    }\n  }\n}\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"add_upload\"\n    }\n  }\n}\n// 500 - Upload Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Upload processing error\",\n  \"error\": {\n    \"code\": \"MEDIA_UPLOADING_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"exception\": \"Error details\"\n    }\n  }\n}\n\n ```\n\n---\n\n### Delete Media\n\n**Endpoint:** `DELETE /{MODE}/delete-media`\n\n**Description:** Delete a media file from Google Cloud Storage.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `delete_upload`\n\n**Query Parameters:**\n\n- `url` (required): GCS URL of the file to delete\n    \n\n**Request Headers:**\n\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n\n ```\n\n**Request Example:**\n\n``` http\nDELETE /dev/v1/delete-media?url=https://storage.googleapis.com/bucket-name/media/users/user-uuid-file.jpg HTTP/1.1\nAuthorization: Bearer <token>\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"File deleted successfully from bucket 'bucket-name'\",\n  \"data\": {\n    \"bucket\": \"bucket-name\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check url parameter exists\n   â”‚\n   â”œâ”€â–º Validate Bucket Configuration\n   â”‚   â””â”€â–º Check GOOGLE_STORAGE_BUCKET_NAME exists\n   â”‚\n   â”œâ”€â–º Parse GCS URL\n   â”‚   â”œâ”€â–º Decode URL\n   â”‚   â”œâ”€â–º Validate domain (storage.googleapis.com)\n   â”‚   â””â”€â–º Extract bucket and object path\n   â”‚\n   â”œâ”€â–º Validate Bucket Match\n   â”‚   â””â”€â–º Ensure URL bucket matches configured bucket\n   â”‚\n   â”œâ”€â–º Extract Object Path\n   â”‚   â”œâ”€â–º Folder: media/users (or other)\n   â”‚   â””â”€â–º Object Key: file name\n   â”‚\n   â”œâ”€â–º Delete from Google Cloud Storage\n   â”‚   â””â”€â–º deleteFromGoogleStorage(folder, objectKey)\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**URL Format:**\n\n```\nhttps://storage.googleapis.com/{bucket-name}/{folder}/{object-key}\n\n ```\n\n**Example:**\n\n```\nhttps://storage.googleapis.com/my-bucket/media/users/user-123-file.jpg\n\n ```\n\n**Validation:**\n\n- URL must be from `storage.googleapis.com`\n    \n- Bucket in URL must match configured bucket\n    \n- URL must have valid path structure\n    \n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: User initiates deletion\n  â”œâ”€â–º User clicks \"Delete\" button on file\n  â”œâ”€â–º Client shows confirmation dialog\n  â””â”€â–º User confirms deletion\nStep 2: Client prepares request\n  â”œâ”€â–º Get GCS URL of file to delete\n  â”œâ”€â–º URL encode the URL parameter\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare DELETE request with query parameter\nStep 3: Client sends request\n  DELETE /{MODE}/delete-media?url={encoded_url}\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Remove file from UI, show success message\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission/bucket error\n  â”œâ”€â–º Not Found (404): Show file not found error\n  â””â”€â–º Error (500): Show error message\nStep 5: Client processes response\n  â”œâ”€â–º Remove file from display\n  â”œâ”€â–º Update file list\n  â””â”€â–º Clear file URL from storage\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract url query parameter\n  â”œâ”€â–º Check permission: \"delete_upload\"\n  â””â”€â–º Validate url parameter exists\nStep 2: Validate bucket configuration\n  â”œâ”€â–º Get GOOGLE_STORAGE_BUCKET_NAME from environment\n  â””â”€â–º If not configured: Return 500\nStep 3: Parse and validate GCS URL\n  â”œâ”€â–º Decode URL (unquote)\n  â”œâ”€â–º Parse URL using urlparse\n  â”œâ”€â–º Validate domain contains \"storage.googleapis.com\"\n  â”œâ”€â–º Extract bucket and object path from URL\n  â”œâ”€â–º Validate URL format (bucket/path structure)\n  â””â”€â–º Check if URL bucket matches configured bucket\nStep 4: Validate bucket match\n  â”œâ”€â–º Compare URL bucket with configured bucket\n  â””â”€â–º If mismatch: Return 403 Forbidden\nStep 5: Check file existence\n  â”œâ”€â–º Get blob from Google Cloud Storage\n  â”œâ”€â–º Check if blob.exists()\n  â””â”€â–º If not exists: Return 404 Not Found\nStep 6: Delete file\n  â”œâ”€â–º Delete blob from Google Cloud Storage\n  â””â”€â–º Verify deletion succeeded\nStep 7: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include bucket name in data.bucket\n  â””â”€â–º Return response with user's language preference\nStep 8: Error handling\n  â”œâ”€â–º No URL: Return 400\n  â”œâ”€â–º Invalid URL format: Return 400\n  â”œâ”€â–º Bucket mismatch: Return 403\n  â”œâ”€â–º File not found: Return 404\n  â”œâ”€â–º Delete error: Return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n\n ```\n\n**Error Responses:**\n\n``` json\n// 400 - No URL Provided\n{\n  \"success\": false,\n  \"message\": \"No URL provided\",\n  \"statusCode\": 400\n}\n// 400 - Invalid GCS URL\n{\n  \"success\": false,\n  \"message\": \"Invalid GCS URL\",\n  \"statusCode\": 400\n}\n// 403 - Bucket Mismatch\n{\n  \"success\": false,\n  \"message\": \"URL bucket does not match configured bucket\",\n  \"statusCode\": 403\n}\n// 404 - File Not Found\n{\n  \"success\": false,\n  \"message\": \"File not found in GCS\",\n  \"statusCode\": 404\n}\n// 500 - Delete Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Delete processing error\",\n  \"error\": {\n    \"code\": \"MEDIA_DELETING_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"exception\": \"Error details\"\n    }\n  }\n}\n\n ```\n\n---\n\n## Workflows\n\n### Complete File Upload Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              File Upload Flow                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Direct Upload â”‚         â”‚  Upload from â”‚\n        â”‚   (Multipart)  â”‚         â”‚     URL      â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Extract File  â”‚         â”‚ Download File â”‚\n        â”‚   Buffer      â”‚         â”‚   from URL    â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Get File Info   â”‚\n                    â”‚ (ext, type)     â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Generate Key    â”‚\n                    â”‚ {userId}-uuid.extâ”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Upload to GCS   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Return Public   â”‚\n                    â”‚      URL        â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### File Deletion Flow\n\n```\n1. User Requests File Deletion\n   â”‚\n   â”œâ”€â–º Validate Authentication\n   â”‚   â””â”€â–º Check JWT token\n   â”‚\n   â”œâ”€â–º Check Permission\n   â”‚   â””â”€â–º delete_upload permission\n   â”‚\n   â”œâ”€â–º Validate URL Parameter\n   â”‚   â””â”€â–º URL must be provided\n   â”‚\n   â”œâ”€â–º Parse GCS URL\n   â”‚   â”œâ”€â–º Decode URL\n   â”‚   â”œâ”€â–º Validate domain\n   â”‚   â””â”€â–º Extract bucket and path\n   â”‚\n   â”œâ”€â–º Validate Bucket\n   â”‚   â””â”€â–º URL bucket must match config\n   â”‚\n   â”œâ”€â–º Extract Object Path\n   â”‚   â”œâ”€â–º Folder name\n   â”‚   â””â”€â–º Object key\n   â”‚\n   â”œâ”€â–º Delete from GCS\n   â”‚   â””â”€â–º deleteFromGoogleStorage()\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - No File or URL:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"File or URL required\",\n  \"error\": \"Either file or url must be provided\",\n  \"statusCode\": 400\n}\n\n ```\n\n**400 Bad Request - Invalid URL:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid URL\",\n  \"error\": \"URL must be from storage.googleapis.com\",\n  \"statusCode\": 400\n}\n\n ```\n\n**401 Unauthorized:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Authentication required\",\n  \"error\": \"Invalid or missing token\",\n  \"statusCode\": 401\n}\n\n ```\n\n**403 Forbidden:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires add_upload permission\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found - File Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"File not found\",\n  \"error\": \"File not found in Google Cloud Storage\",\n  \"statusCode\": 404\n}\n\n ```\n\n**413 Payload Too Large:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"File too large\",\n  \"error\": \"File size exceeds 15MB limit\",\n  \"statusCode\": 413\n}\n\n ```\n\n**500 Internal Server Error - Download Error:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Download error\",\n  \"error\": \"Failed to download file from URL\",\n  \"statusCode\": 500\n}\n\n ```\n\n**500 Internal Server Error - Upload Error:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Upload processing error\",\n  \"error\": \"Failed to upload file to Google Cloud Storage\",\n  \"statusCode\": 500\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **File Size**: Always validate file size before upload (max 15MB)\n    \n2. **File Types**: Validate file types based on your application requirements\n    \n3. **Content Type**: Set appropriate content type for proper file handling\n    \n4. **URL Validation**: Validate URLs before downloading\n    \n5. **Error Handling**: Handle download and upload errors gracefully\n    \n6. **Security**: Only allow deletion of files from your configured bucket\n    \n7. **Object Keys**: Use unique object keys to prevent overwrites\n    \n8. **Cleanup**: Implement cleanup for failed uploads\n    \n9. **CORS**: Configure CORS on GCS bucket for web uploads\n    \n10. **Permissions**: Use IAM roles for GCS access, not service account keys in code\n    \n\n---\n\n## Google Cloud Storage Configuration\n\n**Required Environment Variables:**\n\n- `GOOGLE_STORAGE_BUCKET_NAME`: Name of the GCS bucket\n    \n\n**Required Credentials:**\n\n- Google Cloud Service Account JSON file\n    \n- Proper IAM permissions for bucket access\n    \n\n**Storage Structure:**\n\n```\nbucket-name/\n  â””â”€â”€ media/\n      â””â”€â”€ users/\n          â”œâ”€â”€ user-123-uuid1.jpg\n          â”œâ”€â”€ user-123-uuid2.png\n          â””â”€â”€ user-456-uuid3.pdf\n\n ```\n\n**Public URL Format:**\n\n```\nhttps://storage.googleapis.com/{bucket-name}/media/users/{object-key}\n\n ```\n\n---\n\n## Security Considerations\n\n1. **Authentication**: All endpoints require authentication\n    \n2. **Authorization**: Check permissions before allowing upload/delete\n    \n3. **Bucket Validation**: Ensure files are only deleted from your bucket\n    \n4. **URL Validation**: Validate URLs to prevent SSRF attacks\n    \n5. **File Type Validation**: Validate file types to prevent malicious uploads\n    \n6. **Size Limits**: Enforce size limits to prevent DoS attacks\n    \n7. **Content Scanning**: Consider scanning uploaded files for malware\n    \n8. **Access Control**: Use GCS IAM for fine-grained access control\n    \n\n---\n\n## Performance Considerations\n\n1. **File Size**: Large files may take time to upload/download\n    \n2. **Concurrent Uploads**: Handle multiple concurrent uploads efficiently\n    \n3. **Streaming**: For large files, consider streaming uploads\n    \n4. **Caching**: Cache public URLs if files don't change\n    \n5. **CDN**: Consider using CDN for frequently accessed files\n    \n6. **Compression**: Compress images before upload for better performance\n    \n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n``` javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n// API request helper for upload endpoints\nasync function uploadRequest(url, options = {}) {\n  const token = getAuthToken();\n  const headers = {\n    ...options.headers\n  };\n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to upload files');\n  }\n  const data = await response.json();\n  if (!data.success) {\n    throw new Error(data.error?.message || 'Upload failed');\n  }\n  return data;\n}\n\n ```\n\n### Direct File Upload\n\n``` javascript\n// Upload file directly\nasync function uploadFile(file) {\n  try {\n    // Validate file size (15MB limit)\n    const maxSize = 15 * 1024 * 1024; // 15MB in bytes\n    if (file.size > maxSize) {\n      throw new Error('File size exceeds 15MB limit');\n    }\n    // Validate file type (optional)\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];\n    if (!allowedTypes.includes(file.type)) {\n      throw new Error('File type not allowed');\n    }\n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    // Show upload progress\n    showUploadProgress(0);\n    // Upload file\n    const response = await uploadRequest('/api/v1/upload-media', {\n      method: 'POST',\n      body: formData\n    });\n    if (response && response.data) {\n      showUploadProgress(100);\n      showNotification('File uploaded successfully');\n      return response.data.url;\n    }\n  } catch (error) {\n    console.error('Error uploading file:', error);\n    showError(error.message || 'Failed to upload file');\n    throw error;\n  }\n}\n// Upload with progress tracking\nasync function uploadFileWithProgress(file, onProgress) {\n  try {\n    const formData = new FormData();\n    formData.append('file', file);\n    const token = getAuthToken();\n    const xhr = new XMLHttpRequest();\n    // Track upload progress\n    xhr.upload.addEventListener('progress', (e) => {\n      if (e.lengthComputable) {\n        const percentComplete = (e.loaded / e.total) * 100;\n        if (onProgress) {\n          onProgress(percentComplete);\n        }\n      }\n    });\n    return new Promise((resolve, reject) => {\n      xhr.addEventListener('load', () => {\n        if (xhr.status === 200) {\n          const response = JSON.parse(xhr.responseText);\n          if (response.success) {\n            resolve(response.data.url);\n          } else {\n            reject(new Error(response.error?.message || 'Upload failed'));\n          }\n        } else {\n          reject(new Error(`Upload failed with status ${xhr.status}`));\n        }\n      });\n      xhr.addEventListener('error', () => {\n        reject(new Error('Upload failed'));\n      });\n      xhr.open('POST', '/api/v1/upload-media');\n      xhr.setRequestHeader('X-Session-Token', token);\n      xhr.send(formData);\n    });\n  } catch (error) {\n    console.error('Error uploading file:', error);\n    throw error;\n  }\n}\n\n ```\n\n### Upload from URL\n\n``` javascript\n// Upload file from URL\nasync function uploadFromURL(fileUrl) {\n  try {\n    // Validate URL format\n    if (!fileUrl || !fileUrl.startsWith('http://') && !fileUrl.startsWith('https://')) {\n      throw new Error('Invalid URL');\n    }\n    // Create form data\n    const formData = new FormData();\n    formData.append('url', fileUrl);\n    // Show loading\n    showLoading('Downloading file from URL...');\n    // Upload from URL\n    const response = await uploadRequest('/api/v1/upload-media', {\n      method: 'POST',\n      body: formData\n    });\n    hideLoading();\n    if (response && response.data) {\n      showNotification('File uploaded successfully from URL');\n      return response.data.url;\n    }\n  } catch (error) {\n    hideLoading();\n    console.error('Error uploading from URL:', error);\n    showError(error.message || 'Failed to upload from URL');\n    throw error;\n  }\n}\n\n ```\n\n### Delete File\n\n``` javascript\n// Delete file from Google Cloud Storage\nasync function deleteFile(gcsUrl) {\n  try {\n    if (!gcsUrl) {\n      throw new Error('File URL is required');\n    }\n    // Confirm deletion\n    const confirmed = confirm('Are you sure you want to delete this file?');\n    if (!confirmed) {\n      return;\n    }\n    // Encode URL for query parameter\n    const encodedUrl = encodeURIComponent(gcsUrl);\n    const token = getAuthToken();\n    const response = await fetch(\n      `/api/v1/delete-media?url=${encodedUrl}`,\n      {\n        method: 'DELETE',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    const data = await response.json();\n    if (response.status === 200 && data.success) {\n      showNotification('File deleted successfully');\n      return true;\n    } else {\n      throw new Error(data.error?.message || 'Failed to delete file');\n    }\n  } catch (error) {\n    console.error('Error deleting file:', error);\n    showError(error.message || 'Failed to delete file');\n    throw error;\n  }\n}\n\n ```\n\n### Complete File Upload Component\n\n``` javascript\n// Complete File Upload Manager Class\nclass FileUploadManager {\n  constructor() {\n    this.uploadedFiles = [];\n    this.maxFileSize = 15 * 1024 * 1024; // 15MB\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'application/pdf'];\n  }\n  async init() {\n    // Set up file input listeners\n    const fileInput = document.getElementById('file-input');\n    if (fileInput) {\n      fileInput.addEventListener('change', (e) => {\n        this.handleFileSelect(e.target.files[0]);\n      });\n    }\n    // Set up URL upload form\n    const urlForm = document.getElementById('url-upload-form');\n    if (urlForm) {\n      urlForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const url = document.getElementById('file-url').value;\n        this.uploadFromURL(url);\n      });\n    }\n  }\n  async handleFileSelect(file) {\n    try {\n      // Validate file\n      if (!this.validateFile(file)) {\n        return;\n      }\n      // Show preview if image\n      if (file.type.startsWith('image/')) {\n        this.showImagePreview(file);\n      }\n      // Upload file\n      const url = await this.uploadFile(file);\n      // Add to uploaded files list\n      this.uploadedFiles.push({\n        name: file.name,\n        url: url,\n        size: file.size,\n        type: file.type\n      });\n      // Update UI\n      this.renderUploadedFiles();\n    } catch (error) {\n      console.error('Error handling file:', error);\n      showError(error.message);\n    }\n  }\n  validateFile(file) {\n    // Check file size\n    if (file.size > this.maxFileSize) {\n      showError(`File size exceeds ${this.maxFileSize / 1024 / 1024}MB limit`);\n      return false;\n    }\n    // Check file type\n    if (this.allowedTypes.length > 0 && !this.allowedTypes.includes(file.type)) {\n      showError('File type not allowed');\n      return false;\n    }\n    return true;\n  }\n  showImagePreview(file) {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      const preview = document.getElementById('image-preview');\n      if (preview) {\n        preview.src = e.target.result;\n        preview.style.display = 'block';\n      }\n    };\n    reader.readAsDataURL(file);\n  }\n  async uploadFile(file) {\n    try {\n      showLoading('Uploading file...');\n      const url = await uploadFileWithProgress(file, (progress) => {\n        this.updateUploadProgress(progress);\n      });\n      hideLoading();\n      showNotification('File uploaded successfully');\n      return url;\n    } catch (error) {\n      hideLoading();\n      throw error;\n    }\n  }\n  async uploadFromURL(fileUrl) {\n    try {\n      showLoading('Uploading from URL...');\n      const url = await uploadFromURL(fileUrl);\n      hideLoading();\n      showNotification('File uploaded successfully from URL');\n      // Add to uploaded files\n      this.uploadedFiles.push({\n        name: fileUrl.split('/').pop(),\n        url: url,\n        type: 'url'\n      });\n      this.renderUploadedFiles();\n      return url;\n    } catch (error) {\n      hideLoading();\n      throw error;\n    }\n  }\n  async deleteFile(gcsUrl) {\n    try {\n      await deleteFile(gcsUrl);\n      // Remove from uploaded files list\n      this.uploadedFiles = this.uploadedFiles.filter(f => f.url !== gcsUrl);\n      // Update UI\n      this.renderUploadedFiles();\n    } catch (error) {\n      console.error('Error deleting file:', error);\n      throw error;\n    }\n  }\n  updateUploadProgress(percent) {\n    const progressBar = document.getElementById('upload-progress');\n    if (progressBar) {\n      progressBar.style.width = `${percent}%`;\n      progressBar.textContent = `${Math.round(percent)}%`;\n    }\n  }\n  renderUploadedFiles() {\n    const container = document.getElementById('uploaded-files');\n    if (!container) return;\n    if (this.uploadedFiles.length === 0) {\n      container.innerHTML = &#x27;<p class=&#x27;preserveHtml&#x27; class=&#x27;preserveHtml&#x27;>No files uploaded yet</p>&#x27;;\n      return;\n    }\n    container.innerHTML = this.uploadedFiles.map((file, index) => `\n      <div class=&#x27;preserveHtml&#x27; class=\"uploaded-file-item\">\n        <div class=&#x27;preserveHtml&#x27; class=\"file-info\">\n          <h4 class=&#x27;preserveHtml&#x27; class=&#x27;preserveHtml&#x27;>${file.name}</h4>\n          <p class=&#x27;preserveHtml&#x27; class=&#x27;preserveHtml&#x27;>${file.type}</p>\n          <p class=&#x27;preserveHtml&#x27; class=&#x27;preserveHtml&#x27;>${(file.size / 1024).toFixed(2)} KB</p>\n        </div>\n        <div class=&#x27;preserveHtml&#x27; class=\"file-actions\">\n          <a class=&#x27;preserveHtml&#x27; href=\"${file.url}\" target=\"_blank\" class=\"btn-view\">View</a>\n          <button onclick=\"fileUploadManager.deleteFile(&#x27;${file.url}&#x27;)\" class=\"btn-delete\">Delete</button>\n        </div>\n      </div>\n    `).join('');\n  }\n}\n// Initialize file upload manager\ndocument.addEventListener('DOMContentLoaded', () => {\n  window.fileUploadManager = new FileUploadManager();\n  fileUploadManager.init();\n});\n\n ```\n\n### Drag and Drop Upload\n\n``` javascript\n// Drag and drop file upload\nfunction setupDragAndDrop() {\n  const dropZone = document.getElementById('drop-zone');\n  if (!dropZone) return;\n  // Prevent default drag behaviors\n  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n    dropZone.addEventListener(eventName, preventDefaults, false);\n    document.body.addEventListener(eventName, preventDefaults, false);\n  });\n  function preventDefaults(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n  // Highlight drop zone when item is dragged over it\n  ['dragenter', 'dragover'].forEach(eventName => {\n    dropZone.addEventListener(eventName, highlight, false);\n  });\n  ['dragleave', 'drop'].forEach(eventName => {\n    dropZone.addEventListener(eventName, unhighlight, false);\n  });\n  function highlight(e) {\n    dropZone.classList.add('drag-over');\n  }\n  function unhighlight(e) {\n    dropZone.classList.remove('drag-over');\n  }\n  // Handle dropped files\n  dropZone.addEventListener('drop', handleDrop, false);\n  function handleDrop(e) {\n    const dt = e.dataTransfer;\n    const files = dt.files;\n    if (files.length > 0) {\n      fileUploadManager.handleFileSelect(files[0]);\n    }\n  }\n}\n// Initialize drag and drop\nsetupDragAndDrop();\n\n ```\n\n### Image Preview and Cropping\n\n``` javascript\n// Image preview with cropping option\nasync function uploadImageWithPreview(file) {\n  try {\n    // Show image preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      const preview = document.getElementById('image-preview');\n      if (preview) {\n        preview.src = e.target.result;\n        preview.style.display = 'block';\n        // Optionally integrate with image cropping library\n        // Example: Cropper.js\n        const cropper = new Cropper(preview, {\n          aspectRatio: 1,\n          viewMode: 1\n        });\n        // Get cropped image on upload\n        document.getElementById('upload-btn').addEventListener('click', () => {\n          cropper.getCroppedCanvas().toBlob((blob) => {\n            uploadFile(blob);\n          });\n        });\n      }\n    };\n    reader.readAsDataURL(file);\n  } catch (error) {\n    console.error('Error previewing image:', error);\n    showError('Failed to preview image');\n  }\n}\n\n ```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all file upload and management endpoints:\n\n### Endpoints Covered:\n\n1. âœ… **Upload Media** - Upload files directly or from URL\n    \n2. âœ… **Delete Media** - Delete files from Google Cloud Storage\n    \n\n### Documentation Sections:\n\n- âœ… Overview and system architecture\n    \n- âœ… Detailed endpoint documentation with examples\n    \n- âœ… Client-server communication flows\n    \n- âœ… Complete workflows and diagrams\n    \n- âœ… Error handling guide\n    \n- âœ… Best practices and security considerations\n    \n- âœ… Complete client-side implementation examples\n    \n- âœ… File Upload Manager component\n    \n- âœ… Drag and drop upload examples\n    \n- âœ… Image preview and cropping examples\n    \n\n### Key Features:\n\n- **Multiple Upload Methods** - Direct file upload or upload from URL\n    \n- **File Validation** - Size limits (15MB) and type validation\n    \n- **Progress Tracking** - Upload progress indicators\n    \n- **Google Cloud Storage** - Integration with GCS for file storage\n    \n- **Security** - Authentication, permissions, and bucket validation\n    \n- **Client-side examples** - Ready-to-use JavaScript code\n    \n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025"
		},
		{
			"name": "health-checkup",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{session_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{domain.com}}/{{mode}}/health",
					"host": [
						"{{domain.com}}"
					],
					"path": [
						"{{mode}}",
						"health"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"requests": {},
				"exec": [
					"const response = pm.response.json();",
					"",
					"// Check if the response succeeded",
					"if (response.success && response.data) {",
					"    // Access Token",
					"    if (response.data.access_token) {",
					"        pm.environment.set(\"access_token\", response.data.access_token);",
					"        console.log(\"Access token updated:\", response.data.access_token);",
					"    }",
					"",
					"    // Refresh Token",
					"    if (response.data.refresh_token) {",
					"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
					"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
					"    }",
					"",
					"    // Session ID",
					"    if (response.data.session_id) {",
					"        pm.environment.set(\"session_id\", response.data.session_id);",
					"        console.log(\"Session ID updated:\", response.data.session_id);",
					"    }",
					"",
					"    // Session Token",
					"    if (response.data.session_token) {",
					"        pm.environment.set(\"session_token\", response.data.session_token);",
					"        console.log(\"Session token updated:\", response.data.session_token);",
					"    }",
					"",
					"    // Token Type",
					"    if (response.data.token_type) {",
					"        pm.environment.set(\"token_type\", response.data.token_type);",
					"        console.log(\"Token type updated:\", response.data.token_type);",
					"    }",
					"",
					"} else {",
					"    console.log(\"No token found in response:\", response);",
					"}",
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "access_token",
			"value": ""
		},
		{
			"key": "refresh_token",
			"value": ""
		},
		{
			"key": "mode",
			"value": ""
		},
		{
			"key": "domain.com",
			"value": ""
		},
		{
			"key": "session_id",
			"value": ""
		},
		{
			"key": "session_token",
			"value": ""
		},
		{
			"key": "token_type",
			"value": ""
		}
	]
}